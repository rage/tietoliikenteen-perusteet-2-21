{"componentChunkName":"component---src-templates-course-content-template-js","path":"/osa-2/4-sahkoposti","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Oppimistavoitteet"},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat kuvata sähköpostipalvelun."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat kuvata SMTP protokollan toimintaa ja sen käyttöä sähköpostipalvelussa."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat perustella miksi lähettäjällä ja vastaanottajalla on käytössään eri protokollat."}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"sahkopostipalvelu","style":"position:relative;"},"children":[{"type":"text","value":"Sähköpostipalvelu"},{"type":"element","tagName":"a","properties":{"href":"#sahkopostipalvelu","ariaLabel":"sahkopostipalvelu permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kaikki me käytämme sähköpostipalvelua, mutta kuinka moni meistä osaa kertoa, mitä sähköpostinjärjestelmässä oikeasti tapahtuu. Toki myös lähetämme tavallisia kirjeitä ja postikortteja, emmekä silloinkaan osa tarkasti kertoa, miten kortti kulkee lähetyspaikasta vastaanottajalle. Tulevina tietotekniikka-alan osaajina tämän kurssin osallistujien pitää kuitenkin tietää edes yleisperiaatteet sähköpostipalvelun toiminnasta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostipalvelu, kuten useimmat muutkin internetin palvelut, perustuu erillisten sähköpostipalvelimien käyttöön. Nykyään käyttäjät käyttävät näitä palvelimia erityisten asiakasohjelmistojen kautta. Käyttäjän omalla koneella (tai kännykällä) voi olla erillinen sähköpostiohjelma (kuten Thunderbird, Outlook) tai www-selaimessa toimiva sähköpostipalvelu (kuten gmail, operaattorien sähköpostipalvelut). Tällä kurssille oletetaan, että käytetään erillistä sähköpostiohjelmaa. WWW-palvelimen voi ajatella vastaavaan rooliin sähköpostipalvelimien suhteen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostipalvelimet välittävät viestejä keskenään käyttäen yksinkertaista sähköpostin välitysprotokollaa (Simple Mail Transfer Protocol, SMTP) tai siitä edelleen kehitettyä laajempaa protokollaa (Extended SMTP, ESMTP)."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Asiakasohjelma lähettää viestit sähköpostipalvelimelle käyttäen samaa SMTP protokolla kuin sähköpostipalvelin, kun se lähettää sähköpostin toiselle sähköpostipalvelimelle. SMTP-protokolla käytetään siis vain viestin lähettämiseen. Siinä lähettäjä ottaa yhteyden vastaanottajaan ja siirtää sähköpostin vastaanottajalle. Tällaisia protokollia, joissa yhteyden muodostanut lähettäjä 'työntää' viestin vastaanottajalle, kutsutaan englanninkielisen nimen mukaan PUSH-protokolliksi. Valtaosa tällä kurssilla käsiteltävistä protokollista on kuitenkin PULL-protokollia. Niissä yhteyden muodostaja 'vetää' tietoa itselleen. Myös asiakasohjelman saapuneiden viestien lukemiseen ja hallinnointiin käyttämät protokollat POP3 ja IMAP ovat PULL-tyyppisiä protokollia. Niiden avulla asiakasohjelma noutaa käyttäjän sähköpostilaatikon sisällön luettavaksi käyttäjän koneelle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttäjällä on siis sähköpostiosoite, kuten tiina.niklander@helsinki.fi, jota muut käyttäjät voivat käyttää vastaanottajan osoitteena, kun he haluavat lähettää sähköpostia kyseiselle käyttäjälle. Sähköpostiosoitteessa on kolme elementtiä: käyttäjän tunniste (tiina.niklander), ät-merkki ja postipalvelimen tunniste (helsinki.fi). Ät-merkin käytöstä voit lukea lisää "},{"type":"element","tagName":"a","properties":{"href":"http://www.kielitoimistonohjepankki.fi/ohje/20","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"kielitoimiston ohjepankin ohjeesta"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttäjän tunnisteet yksilöivät käyttäjät vain yhden sähköpostipalvelimen sisällä. Sama käyttäjätunniste voi olla käytössä useammassa eri sähköpostipalvelimessa. Niitä voi hallinnoida yksi ja sama henkilö tai ne voivat kuulua useammalle eri henkilölle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostipalvelimen tunniste helsinki.fi ei ole sähköpostipalvelimen oma verkkonimi, vaan sähköpostijärjestelmässä käytettävä tunniste. Sähköpostipalvelimen verkkonimen voi selvittää nimipalvelun avulla. Nimipalvelun resurssitietueessa MX on tieto siitä, mikä sähköpostipalvelin vastaa tietyn verkkoalueen (kuten helsinki.fi) sähköpostipalvelusta. Sähköpostiosoitteet sitoutuvat siis verkkonimiin siten, että tuo sähköpostipalvelimen tunniste on yleensä samalla verkkoalueen nimi. Siksi voimme käyttää aluenimeä sähköpostiosoitteessa varsinaisen palvelimen nimen sijaan."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"b0a8acaf-7dda-5498-815f-7023646fd899"},"children":[]}]},{"type":"element","tagName":"h2","properties":{"id":"sahkopostin-lahetys-ja-valitys","style":"position:relative;"},"children":[{"type":"text","value":"Sähköpostin lähetys ja välitys"},{"type":"element","tagName":"a","properties":{"href":"#sahkopostin-lahetys-ja-valitys","ariaLabel":"sahkopostin lahetys ja valitys permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttäjän oma sähköpostipalvelin säilyttää käyttäjälle saapuneita viestejä yhdessä tiedostossa, jota kutsutaan käyttäjän postilaatikoksi. Kaikki käyttäjälle tälle palvelimelle saapuvat viestit laitetaan tähän käyttäjän omaan postilaatikkoon. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Koska sähköposti on vanhimpia internetin palveluja, niin se on suunniteltu aikana, jolloin internetissä oli vain palvelimia, eikä käyttäjillä ollut omia erillisiä verkkoon liitettyjä laitteita. Silloin käyttäjät käyttivät omia sähköpostilaatikoitaan suoraan palvelimilla komentotulkkien avulla. Nykyisin käyttäjät käyttävät omia sähköpostilaatikoitaan muilta laitteilta ja käyttäjien laitteiden (=asiakas) ja sähköpostipalvelimien välille on kehitetty uusia protokollia. Palataan tähän sähköpostien lukemiseen myöhemmin."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Keskitytään nyt ensiksi sähköpostien lähettämiseen ja sähköpostipalvelimien toimintaan viestien välityksessä vastaanottajalle asti.\nSähköpostipalvelimet voivat nimipalvelun avulla selvittää viestin vastaanottajan sähköpostipalvelimen nimen ja IP-numeron. Näin maailman kaikki sähköpostipalvelimet muodostavat sähköpostipalvelimien verkoston ja voivat välittää lähettäjän asiakasohjelmalta saamansa sähköpostin vastaanottajan sähköpostilaatikkoon. "}]},{"type":"element","tagName":"img","properties":{"src":"/cdd29727dd5cacebb67006d343cf19c5/2-4-postipalvelimet.svg","alt":"Kuvassa on kolme sähköpostipalvelinta helsinki.fi, google.com ja rutgers.edu. Jokaisella palvelimelle on joukko nimeämättömiä postilaatikoita. Palvelimet on liitetty internettiin, joka välityksessä ne voivat kommunikoida keskenään. Yhteyksiä ei ole tarkemmin kuvattu. "},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"KUVA: Kuvassa on muutama sähköpostipalvelin ja niillä joitakin postilaatikoita."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostipalvelimet välittävät käyttäjien toisille käyttäjille lähettämiä viestejä SMTP (Simple Mail Transfer Protocol) protokollalla. Esimerkiksi, jos helsinki.fi:n sähköpostipalvelimen käyttäjä on laatinut viestin rutgers.edu:n käyttäjälle ja antanut tämän viestin helsinki.fi sähköpostipalvelimen välitettäväksi, niin helsinki.fi:n palvelin ottaa SMTP-yhteyden rutgers.edu:n palvelimelle ja siirtää käyttäjän lähettämän viestin sinne."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttäjän oma asiakasohjelma toimittaa käyttäjän lähettämät viestit käyttäjän omalle sähköpostipalvelimelle käyttäen samaa SMTP-protokollaa kuin sähköpostipalvelimet käyttävät välittäessään viestejä toisille sähköpostipalvelimille. "}]},{"type":"element","tagName":"h3","properties":{"id":"smtp","style":"position:relative;"},"children":[{"type":"text","value":"SMTP"},{"type":"element","tagName":"a","properties":{"href":"#smtp","ariaLabel":"smtp permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SMTP (Simple Mail Transfer Protocol) on sähköpostijärjestelmässä käytetty siirtoprotokolla, jolla sähköposti siirretään vastaanottajan sähköpostipalvelimelle. Sitä voidaan käyttää myös sähköpostiviestin siirtämiseen viestiä lähettävän käyttäjän sähköpostiohjelmasta lähettäjän omalle sähköpostipalvelimelle viestin edelleenlähetystä varten. SMTP-protokolla on suunniteltu vain viestin siirtämiseen lähettäjältä vastaanottajalle. Siksi sitä ei voida käyttää viestin vastaanottavan käyttäjän sähköpostiohjelmassa viestin noutamiseen lukemista varten."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nykyisin käytössä on lähinnä SMTP:stä edellen kehitetty ESMTP (Extended SMTP).  Tällä kurssilla ei paneuduta tähän laajennukseen, vaan opiskellaan sähköpostijärjestelmän toimintaperiaate tuon alkuperäisen SMTP:n kanssa, vaikka nykyään postipavelimien suositellaan käyttävän aina tuota laajennosta. Jos jotakuta laajennus kuitenkin kiinnostaa, niin "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/ESMTP","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"suomenkielinen wikipedian sivu"}]},{"type":"text","value":" on hyvä lähtökohta asian itsenäiselle tutkimiselle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SMTP-protokollassa on määritelty monivaiheinen viestien vaihto lähettäjän ja vastaanottajan välillä. Niiden täytyy ylläpitää tilatietoa, jotta ne pysyvät kärryillä, missä vaiheessa viestien vaihto on menossa. Tässä SMTP poikkeaa HTTP-protokollasta. HTTP-protokolla, kuten muistamme, oli tilaton, jolloin lähettäjän ja vastaanottajan ei tarvinnut ylläpitää tilatietoa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oheinen yhteysesimerkki, eli yhden sähköpostiviestin (tässä merkitty DATA) siirto lähettävältä palvelimelta vastaanottavalla postipalvelimelle, on mukaeltu Visa Hännisen insinöörityössä "},{"type":"element","tagName":"a","properties":{"href":"https://www.theseus.fi/bitstream/handle/10024/23284/Hanninen_Visa.pdf?sequence=1&isAllowed=y","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"\"SMTP-releointipalvelun valvonta ja raportointi\""}]},{"type":"text","value":", Metropolia 2010, olleesta esimerkistä. Jokainen rivi on oma viestinsä. Rivin alussa on A (lähettää palvelin, eli tämän yhteyden asiakas) tai B (vastaanottava palvelin, eli tämän yhteyden palvelin), kertomassa kumpi kyseisen viestin lähettää."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A (lahettava.palvelin.com) avaa TCP-yhteyden B:lle (email.vastaanottaja.com)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   HELO lahettava.palvelin.com"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"B:   250 email.vastaanottaja.com Helo lahettava.palvelin.com, nice to interact with you"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   MAIL FROM: <joku123@ lahettava.palvelin.com>"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"B:   250 sender <joku123@ lahettava.palvelin > OK"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   RCPT TO: "},{"type":"element","tagName":"a","properties":{"href":"mailto:kuka123@postipalvelin.com","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"kuka123@postipalvelin.com"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"B:   250 recipient <kuka123@ postipalvelin.com > OK"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   DATA"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"B:   250 OK; enter text, end with ."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   Tämä on viestin sisältö."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   ."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"B:   250 postipalvelin.com OK; message accepted for delivery"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A:   QUIT"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tästä esimerkistä käy hyvin ilmi monivaiheinen viestien vaihto tilanteessa, kun sähköpostin siirto onnistuu. Protokollassa on määritelty tarkasti myös erilaiset virhetilanteet ja niihin liittyvät viestit. SMTP on HTTP-protokollan tavoin tekstipohjainen, jolloin ihmisen on mahdollista itsekin ottaa TELNET-yhteys palvelimeen ja kirjoittaa nuo lähettävän palvelimen viestit ihan suoraan näppäimistöltä. Tällaisessa yhteydessä on toki noudatettava myös niitä sääntöjä, jotka liittyvät itse viestin rakenteeseen. Esimerkissä näistä säännöistä on yksinkertaisuuden vuoksi oikaistu ja varsinainen sähköpostiviesti on korvattu vain yhdellä rivillä 'Tämä on viestin sisältö.'."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Aiemmin kurssilla käsitellyt prokollat, HTTP ja DNS, olivat tilattomia, koska niissä asiakas A lähetti vain yhden viestin ja palvelin B vastasi siihen. SMTP protokollassa tämän asiakkaan ja palvelimen välinen viestintä on monivaiheista, ne lähettävät toisilleen useita viestejä. Niillä on tarve seurata, missä vaiheessa viestien vaihto on nyt menossa. Tästä muodostuu tilatieto. Molempien on tärkeää tietää yhteyden sen hetkinen tila, jotta ne osaavat lähettää seuraavat viestit protokollan mukaisesti. Vain noudattamalla protokollan sääntöjä ne voivat toimia yhdessä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Monivaiheinen viestien vaihto on suhteellisen tyypillistä erilaisille sovelluksille, mutta myös haastavaa, kun tietoliikenne on epäluotettavaa. Usein erilaisista virhetilanteista, kuten yksittäisen viestein katoamisesta, toipuminen olisi helpompaa, jos viestienvaihto onnistuu ilman tietoa aiemmista viesteistä, eli tilattomasti. Tlattomassa ratkaisussa ei tarvitse tietää historiaa, vaan jokainen viesti käsitellään sellaisenaan. SMTP-protokollan kanssa näin ei voida toimia, vaan aiempien viestien sisällöt määräävät toimintaa seuraavien viestien osalta. "}]},{"type":"element","tagName":"h2","properties":{"id":"sahkopostin-lukeminen","style":"position:relative;"},"children":[{"type":"text","value":"Sähköpostin lukeminen"},{"type":"element","tagName":"a","properties":{"href":"#sahkopostin-lukeminen","ariaLabel":"sahkopostin lukeminen permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttäjän sähköpostilaatikko on palvelimella ja käyttäjälle saapuneet sähköpostiviestit ovat siellä. Sähköpostipalvelin vain säilyttää näitä viestejä ja odottaa, että käyttäjä (tai oikeastaan asiakasohjelma) ottaa yhteyttä. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos käyttäjällä on omalla koneellaan joku erillinen sähköpostiohjelma kuten outlook, thunderbird tai vastaava, niin nämä ohjelmat tyypillisesti käyttävät joko "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/IMAP","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"IMAP"}]},{"type":"text","value":" (Internet Message  Access Protocol) tai "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/POP3","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"POP3"}]},{"type":"text","value":" prokollia käyttäjän palvelimella sijaitsevan sähköpostilaatikon käsittelyyn.  Huomaa, että näillä protokollilla käsitellään vain jo sähköpostilaatikossa olevia viestejä. Näillä siis luetaan saapuneita viestejä. Viestien lähettämiseen sähköpostiohjelmat käyttävät samaa SMTP protokollaa kuin sähköpostipalvelimetkin."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Näillä sähköpostiprotokollilla on hyvä havainnollistaa protokollien yleisempääkin piirrettä eli sitä kumpi osapuoli on aktiivinen toimija ja mihin suuntaan tietoa siirretään (PUSH vs PULL). PUSH-tyyppisissä protokollissa asiakas työntää tietoa palvelimelle, kun taas PULL-tyyppisissä protokollissa asiakas 'vetää' tietoa palvelimelta itselleen. Muistathan, että asiakas-palvelija-mallissa asiakas on aina yhteyttä ottava osapuoli. Näin sähköpostipalvelinkin on asiakas silloin, kun se ottaa yhteyttä toiseen sähköpostipalvelimeen ja antaa sille uuden sähköpostin sijoitettavaksi käyttäjän postilaatikkoon. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SMTP-protokollaa käytettäessä asiakas (lähettävä sähköpostipalvelimen) työntää (engl. PUSH) uuden sähköpostiviestin vastaanottavalla sähköpostipalvelimelle, joka voi vain ottaa sen vastaan.  Vastaanottavalla palvelimella ei juurikaan ole sanavaltaa. Tähän sähköpostijärjestelmän ominaisuuteen perustuu suuri osa roskapostin toiminnasta. Palvelimille vain työnnetään roskapostia, joka on menossa käyttäjien postilaatikoihin. PULL-tyyppisissä protokollissa, kuten IMAP ja POP3, viestin tai datan vastaanottaja päättäää mitä ja milloin se haluaa vastaanottaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nykyään on yhä tyypillisempää, että käyttäjät hyödyntävät www-selaimia omien postilaatikoidensa käsittelyssä. Tällöin käyttäjän selaimen ja www-palvelimen välinen liikennöinti tapahtuu HTTP-protokollalla. WWW-palvelin pääsee käsiksi käyttäjän postilaatikkoon joko samoilla protokollilla (IMAP, POP3) kuin käyttäjän koneen sähköpostiohjelma tai se voi olla samassa järjestelmässä postipalvelimen kanssa, jolloin se voi lukea käyttäjän postilaatikon sisällön suoraan tiedostojärjestelmästä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Huomaa, että sähköpostijärjestelmässä protokollia käytetään epäsymmetrisesti, koska SMTP on vain postien lähettämistä ja IMAP/POP3 sähköpostien lukemista varten. Aiemmin käytössä oli vain yksi protokolla, jotka käytettiin viestien välittämisen molempiin suuntiin.  Sähköpostijärjestelmässäkin kaikki protokollat oman yhteytensä aikana välittävät viestejä molempiin suuntiin, vaikka protokollan data eli itse sähköposti siirtyykin vain yhteen suuntaan. Epäsymmetrisyys tässä johtuu toisaalta historiasta ja toisaalta näiden tapahtumien ajallisesta etäisyydestä. Sähköpostin saapuminen postilaatikkoon voi tapahtua ajallisesti paljon ennen kuin käyttäjän asiakasohjelma käy sen postilaatikosta lukemasta.  "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Huomasithan, että mikään näistä protokollista, SMTP, IMAP tai POP3, ei ota kantaa itse sähköpostiin tai sen rakenteeseen / sisältöön. Ne kuvaavat vain asiakkaan ja palvelijan välisen protokollan, jolla sähköpostiviesti voidaan sellaisenaan siirtää asiakkaalta palvelijalle (SMTP) tai palvelijalta asiakkaalle (IMAP, POP3)."}]},{"type":"element","tagName":"h2","properties":{"id":"viestin-rakenne","style":"position:relative;"},"children":[{"type":"text","value":"Viestin rakenne"},{"type":"element","tagName":"a","properties":{"href":"#viestin-rakenne","ariaLabel":"viestin rakenne permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostiviestit eivät yleensä ole ihan noin lyhyitä kuin aiemmassa esimerkissä, jossa viesti on vain yhden rivin mittainen \"Tämä on viestin sisältö.\".  Yleensä viestit ovat pidempiä. Itseasiassa tämä ei edes vastaa sähköpostiviestiltä vaadittavaa rakennetta.\nSähköpostiviestin rakenteesta on hyvä kuvaus "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/S%C3%A4hk%C3%B6posti","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"wikipedian sivulla"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Useimmat sähköpostiohjelmat käyttävät erillisiä kenttiä sähköpostin otsaketiedoille, kuten vastaanottaja(t) ja viestin otsikko. Näin ne tukevat käyttäjää siinä, että lähtevän sähköpostiviestin otsaketiedot noudattavat sovittuja käytänteitä. Sähköposti on kuitenkin vanha protokolla, jota voisi ihan yhtä hyvin käyttää suoraan komentoriviltä toimivilla tekstipohjaisilla ohjelmilla."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"28ee28b0-df6b-5de5-af55-bcb1cd4e0e14"},"children":[]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Katso jonkun saamasi sähköpostiviestin täydet otsaketiedot ja etsi sieltä rivit, jotka alkavat \"Received:\". Huomaa, että jos viesti on tullut saman postipalvelimen joltain toiselta käyttäjältä, niin tuota received-riviä ei välttämättä ole lainkaan, koska postipalvelin ei ole lähettänyt sitä toiselle postipalvelimelle vaan on vain laittanut viestin kyseisen käyttäjän postilaatikkoon. Valitse siis tarkasteltavaksi viesti, joka on tullut jonkun toisen postipalvelimen käyttäjältä. Miten näet viestin otsaketiedot, riippuu käyttämästäsi sähköpostiohjelmasta. Toiminto voi olla 'view full header', 'view source', 'view original'. Joillakin, erityisesti mobiililaitteiden, sähköpostiohjelmilla tämän tiedon katselu ei välttämättä edes ole mahdollista, kun ohjelmassa ei kyseistä toiminnallisuutta ole. Vaihda silloin käyttöösi sellainen käyttöliittymä tai ohjelma, jolla nämä tiedot näet."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"f733c37e-ef14-5175-bebe-53e57afecaf3"},"children":[]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostiviestiin voi nykyään liittää myös muuta materiaalia kuin vain varsinaisen viestin pelkkänä tekstinä. Koska sähköpostiprotokolla on tekstimuotoinen ja koska viestin on sovittu päättyvän riviin, jossa on vain yksi merkki, piste, on kaikki sähköpostiin liitettävä muu materiaali kuin ASCII-muotoinen teksti koodattava ASCII-merkistölle sopivaksi."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostiviestin laajennukset on määritelty MIME-standardissa (ks "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/MIME","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"standardin wikipedia-sivu"}]},{"type":"text","value":" ja "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/S%C3%A4hk%C3%B6posti#MIME","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"sähköpostin koodausohjeistus"}]},{"type":"text","value":"). MIME-muotoisessa sähköpostissa on useita osia ja jokainen osa voidaan koodata eri tavalla. Viestin liitteeksi voi laittaa minkä tahansa tiedoston, jonka tyyppi kerrotaan MIME-standardin mukaisissa tiedoissa.  Koska SMTP-protokolla siirtää varmasti vain 7-bittisiä ASCII-merkkejä, on tyypillistä, että erityisesti liitetiedostot ja kuvat koodataan 7-bittiseksi ASCII-koodiksi. Tunnetuin koodaustapa on base64, jossa kolme 8-bittistä tavua (tai merkkiä) koodataan 4:ksi, jotka eivät voi rikkoa sähköpostin siirtoa. Esimerkiksi merkkiyhdistelmä 'rivinvaihto' 'piste' 'rivinvaihto' ei ole sallittu, koska se on sovittu SMTP-protokollassa sähköpostiviestin päättäväksi merkiksi."}]},{"type":"element","tagName":"h2","properties":{"id":"sahkopostin-ongelmia","style":"position:relative;"},"children":[{"type":"text","value":"Sähköpostin ongelmia"},{"type":"element","tagName":"a","properties":{"href":"#sahkopostin-ongelmia","ariaLabel":"sahkopostin ongelmia permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Huomasithan, että lähettäjän ja vastaanottajan tiedot toimitettiin kahteen kertaan. Toisaalta ne olivat SMTP-protokollan viestien vaihdossa mukana ja toisaalta ne tulivat sitten varsinaisen sähköpostin alussa otsaketietoina kentissä From: ja To:."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sähköpostin vastaanottava sähköpostipalvelin ei tarkasta, että protokollassa annetut osoitteet ja viestin mukaan tulleet osoitteet ovat samat.  Mieti hetki, että miksi ei! Jos tarkastaisi, niin mitä tapahtuisi, kun viestiä lähetetään postilistalle esim. meidanjoukko@osoite.com."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Valitettavasti tämä tietojen kirjaaminen kahteen kertaan antaa mahdollisuuden piilottaa todellinen lähettäjä. SMTP-protokollan mukainen lähettäjän tunniste voi siis olla eri kuin viestin mukana olevaan From: kenttään kirjoitettu tunniste. Tietenkään normaalisti toimiva sähköpostiohjelma ei anna käyttäjälle mahdollisuutta näiden erilaisuuteen. Aikoinaan, kun käytettiin yksinkertaista SMTP-protokollaa ja luotettiin viestien lähettäjiin ei ollut mitenkään vaikeaa väärentää viestejä. Nykyisin se on jo hiukan hankalampaa, kun luotettavat sähköpostipalvelimet vaativat tunnistautumista. Sähköpostipalvelin voikin kieltäytyä vastaanottamasta yhteyspyyntöjä ja viestejä epäluotettavilta palvelimilta. Sähköpostipalvelimet voivat itse ylläpitää tällaista "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Musta_lista_(s%C3%A4hk%C3%B6posti)","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"mustaa listaa"}]},{"type":"text","value":" tai ne voivat käyttää jonkun toisen organisaation ylläpitämää mustaa listaa epäluotettavista palvelimista."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kaikkea "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Roskaposti","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"roskapostia"}]},{"type":"text","value":" tai "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Haittaohjelma","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"haittaohjelmien"}]},{"type":"text","value":" lähettämistä mustien listojen käytöllä ei voi estää. Sähköpostipalvelimien ylläpitäjät ottavat koko ajan käyttöön uusia suojautumiskeinoja. Valitettavasti mikään suojautuminen ei tepsi järjestelmän todellisten käyttäjätunnusten väärinkäyttöön. Aina on mahdollista, että luvattomasti käyttöön saatua tunnusta käytetään tällaisten haitallisten sähköpostien lähettämiseen luotettavan sähköpostipalvelimen kautta. Siksi käyttäjien pitää pitää hyvää huolta tunnuksistaan. Vaikka itsellä ei olisikaan arvokasta tietoa, niin tunnuksen luvaton käyttö voi aiheuttaa merkittävää haittaa muille internet-verkon käyttäjille."}]},{"type":"element","tagName":"h2","properties":{"id":"viestien-suojaus-ja-allekirjoitus-salaus","style":"position:relative;"},"children":[{"type":"text","value":"Viestien suojaus ja allekirjoitus (salaus)"},{"type":"element","tagName":"a","properties":{"href":"#viestien-suojaus-ja-allekirjoitus-salaus","ariaLabel":"viestien suojaus ja allekirjoitus salaus permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos viestin lähettäjä haluaa varmistua, että vain viestin vastaanottaja voi lukea viestin, täytyy lähettäjän salakirjoittaa viesti jotain salausmenetelmää käyttäen. Vastaanottajan täytyy tietää, miten viesti on salattu, jotta hän voi sen purkaa ja lukea alkuperäisen sisällön. Sähköpostijärjestelmässä viesti kulkee sellaisenaan, joten ilman salausta kuka tahansa, joka viestin saa käsiinsä, voi sen lukea."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Viestien salaus ei sinänsä ole sidoksissa sähköpostijärjestelmään, mutta usein sähköpostia käytetään näiden viestien siirtoon lähettäjältä vastaanottajalle. Tässä kuitenkin tarkastellaan asiaa sähköpostipalvelun kautta. Asioiden yleispätevyys on lukijan kuitenkin hyvä huomata."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/PGP","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"PGP"}]},{"type":"text","value":" oli pitkään suosituin viestien salaukseen käytetty menetelmä sähköpostien kanssa. Sähköpostijärjestelmän MIME-laajennus ja "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Julkisen_avaimen_salaus","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"julkisen avaimen salausmenetelmät"}]},{"type":"text","value":" antoivat riittävän teknisen pohjan PGP-järjestelmälle. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sittemmin MIME:ä laajennettiin myös käsittelemään salattuja viestejä. "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/S/MIME","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"S/MIMEn"}]},{"type":"text","value":" versio 3.1 on kuvattu "},{"type":"element","tagName":"a","properties":{"href":"https://tools.ietf.org/html/rfc3851","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"RFC:ssä 3851"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Julkisen avaimen salauksen avulla voidaan varmistua joko vastaanottajasta tai lähettäjästä seuraavasti:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Viestin voi lukea vain oikea vastaanottaja!  Viesti salataan vastaanottajan julkisella avaimella."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Viestin lähettäjä on varmasti oikea!  Viesti salataan lähettäjän salaisella avaimella. Tämä on digitaalinen allekirjoitus."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Digitaalinen_allekirjoitus","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Digitaalisessa allekirjoituksessa"}]},{"type":"text","value":" ei aina ole välttämätöntä suojata koko sisältöä ja siksi usein varsinaisesta sisällöstä lasketaan ns. tiiviste ja sitten salataan (eli allekirjoitetaan) vain tämä tiiviste."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos halutaan samaan aikaa varmistaa sekä lähettäjä että vastaanottaja, on viesti salattava useampaan kertaan."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kiinnostuneille tiedoksi, että vuonna 2019 määriteltiin myös postipalvelimien käyttämä autentikointien ketjutus (engl. "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Authenticated_Received_Chain","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Authenticated Received Chain"}]},{"type":"text","value":", ARC), jolla pyritään tukemaan postilistojen toimintaa silloin, kun postilistan käsittelee joku muu postipalvelin kuin alkuperäisen viestin lähettäjän oman palvelin."}]}]},"html":"<div><text-box variant='learningObjectives' name='Oppimistavoitteet'><ul>\n<li>Osaat kuvata sähköpostipalvelun.</li>\n<li>Osaat kuvata SMTP protokollan toimintaa ja sen käyttöä sähköpostipalvelussa.</li>\n<li>Osaat perustella miksi lähettäjällä ja vastaanottajalla on käytössään eri protokollat.</li>\n</ul></text-box><h2 id=\"sahkopostipalvelu\" style=\"position:relative;\">Sähköpostipalvelu<a href=\"#sahkopostipalvelu\" aria-label=\"sahkopostipalvelu permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Kaikki me käytämme sähköpostipalvelua, mutta kuinka moni meistä osaa kertoa, mitä sähköpostinjärjestelmässä oikeasti tapahtuu. Toki myös lähetämme tavallisia kirjeitä ja postikortteja, emmekä silloinkaan osa tarkasti kertoa, miten kortti kulkee lähetyspaikasta vastaanottajalle. Tulevina tietotekniikka-alan osaajina tämän kurssin osallistujien pitää kuitenkin tietää edes yleisperiaatteet sähköpostipalvelun toiminnasta.</p><p>Sähköpostipalvelu, kuten useimmat muutkin internetin palvelut, perustuu erillisten sähköpostipalvelimien käyttöön. Nykyään käyttäjät käyttävät näitä palvelimia erityisten asiakasohjelmistojen kautta. Käyttäjän omalla koneella (tai kännykällä) voi olla erillinen sähköpostiohjelma (kuten Thunderbird, Outlook) tai www-selaimessa toimiva sähköpostipalvelu (kuten gmail, operaattorien sähköpostipalvelut). Tällä kurssille oletetaan, että käytetään erillistä sähköpostiohjelmaa. WWW-palvelimen voi ajatella vastaavaan rooliin sähköpostipalvelimien suhteen.</p><p>Sähköpostipalvelimet välittävät viestejä keskenään käyttäen yksinkertaista sähköpostin välitysprotokollaa (Simple Mail Transfer Protocol, SMTP) tai siitä edelleen kehitettyä laajempaa protokollaa (Extended SMTP, ESMTP).</p><p>Asiakasohjelma lähettää viestit sähköpostipalvelimelle käyttäen samaa SMTP protokolla kuin sähköpostipalvelin, kun se lähettää sähköpostin toiselle sähköpostipalvelimelle. SMTP-protokolla käytetään siis vain viestin lähettämiseen. Siinä lähettäjä ottaa yhteyden vastaanottajaan ja siirtää sähköpostin vastaanottajalle. Tällaisia protokollia, joissa yhteyden muodostanut lähettäjä 'työntää' viestin vastaanottajalle, kutsutaan englanninkielisen nimen mukaan PUSH-protokolliksi. Valtaosa tällä kurssilla käsiteltävistä protokollista on kuitenkin PULL-protokollia. Niissä yhteyden muodostaja 'vetää' tietoa itselleen. Myös asiakasohjelman saapuneiden viestien lukemiseen ja hallinnointiin käyttämät protokollat POP3 ja IMAP ovat PULL-tyyppisiä protokollia. Niiden avulla asiakasohjelma noutaa käyttäjän sähköpostilaatikon sisällön luettavaksi käyttäjän koneelle.</p><p>Käyttäjällä on siis sähköpostiosoite, kuten tiina.niklander@helsinki.fi, jota muut käyttäjät voivat käyttää vastaanottajan osoitteena, kun he haluavat lähettää sähköpostia kyseiselle käyttäjälle. Sähköpostiosoitteessa on kolme elementtiä: käyttäjän tunniste (tiina.niklander), ät-merkki ja postipalvelimen tunniste (helsinki.fi). Ät-merkin käytöstä voit lukea lisää <a href=\"http://www.kielitoimistonohjepankki.fi/ohje/20\" target=\"_blank\" rel=\"noopener noreferrer\">kielitoimiston ohjepankin ohjeesta</a>.</p><p>Käyttäjän tunnisteet yksilöivät käyttäjät vain yhden sähköpostipalvelimen sisällä. Sama käyttäjätunniste voi olla käytössä useammassa eri sähköpostipalvelimessa. Niitä voi hallinnoida yksi ja sama henkilö tai ne voivat kuulua useammalle eri henkilölle.</p><p>Sähköpostipalvelimen tunniste helsinki.fi ei ole sähköpostipalvelimen oma verkkonimi, vaan sähköpostijärjestelmässä käytettävä tunniste. Sähköpostipalvelimen verkkonimen voi selvittää nimipalvelun avulla. Nimipalvelun resurssitietueessa MX on tieto siitä, mikä sähköpostipalvelin vastaa tietyn verkkoalueen (kuten helsinki.fi) sähköpostipalvelusta. Sähköpostiosoitteet sitoutuvat siis verkkonimiin siten, että tuo sähköpostipalvelimen tunniste on yleensä samalla verkkoalueen nimi. Siksi voimme käyttää aluenimeä sähköpostiosoitteessa varsinaisen palvelimen nimen sijaan.</p><div><quiz id=\"b0a8acaf-7dda-5498-815f-7023646fd899\"></quiz></div><h2 id=\"sahkopostin-lahetys-ja-valitys\" style=\"position:relative;\">Sähköpostin lähetys ja välitys<a href=\"#sahkopostin-lahetys-ja-valitys\" aria-label=\"sahkopostin lahetys ja valitys permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Käyttäjän oma sähköpostipalvelin säilyttää käyttäjälle saapuneita viestejä yhdessä tiedostossa, jota kutsutaan käyttäjän postilaatikoksi. Kaikki käyttäjälle tälle palvelimelle saapuvat viestit laitetaan tähän käyttäjän omaan postilaatikkoon. </p><p>Koska sähköposti on vanhimpia internetin palveluja, niin se on suunniteltu aikana, jolloin internetissä oli vain palvelimia, eikä käyttäjillä ollut omia erillisiä verkkoon liitettyjä laitteita. Silloin käyttäjät käyttivät omia sähköpostilaatikoitaan suoraan palvelimilla komentotulkkien avulla. Nykyisin käyttäjät käyttävät omia sähköpostilaatikoitaan muilta laitteilta ja käyttäjien laitteiden (=asiakas) ja sähköpostipalvelimien välille on kehitetty uusia protokollia. Palataan tähän sähköpostien lukemiseen myöhemmin.</p><p>Keskitytään nyt ensiksi sähköpostien lähettämiseen ja sähköpostipalvelimien toimintaan viestien välityksessä vastaanottajalle asti.\nSähköpostipalvelimet voivat nimipalvelun avulla selvittää viestin vastaanottajan sähköpostipalvelimen nimen ja IP-numeron. Näin maailman kaikki sähköpostipalvelimet muodostavat sähköpostipalvelimien verkoston ja voivat välittää lähettäjän asiakasohjelmalta saamansa sähköpostin vastaanottajan sähköpostilaatikkoon. </p><img src=\"/cdd29727dd5cacebb67006d343cf19c5/2-4-postipalvelimet.svg\" alt=\"Kuvassa on kolme sähköpostipalvelinta helsinki.fi, google.com ja rutgers.edu. Jokaisella palvelimelle on joukko nimeämättömiä postilaatikoita. Palvelimet on liitetty internettiin, joka välityksessä ne voivat kommunikoida keskenään. Yhteyksiä ei ole tarkemmin kuvattu. \"><p>KUVA: Kuvassa on muutama sähköpostipalvelin ja niillä joitakin postilaatikoita.</p><p>Sähköpostipalvelimet välittävät käyttäjien toisille käyttäjille lähettämiä viestejä SMTP (Simple Mail Transfer Protocol) protokollalla. Esimerkiksi, jos helsinki.fi:n sähköpostipalvelimen käyttäjä on laatinut viestin rutgers.edu:n käyttäjälle ja antanut tämän viestin helsinki.fi sähköpostipalvelimen välitettäväksi, niin helsinki.fi:n palvelin ottaa SMTP-yhteyden rutgers.edu:n palvelimelle ja siirtää käyttäjän lähettämän viestin sinne.</p><p>Käyttäjän oma asiakasohjelma toimittaa käyttäjän lähettämät viestit käyttäjän omalle sähköpostipalvelimelle käyttäen samaa SMTP-protokollaa kuin sähköpostipalvelimet käyttävät välittäessään viestejä toisille sähköpostipalvelimille. </p><h3 id=\"smtp\" style=\"position:relative;\">SMTP<a href=\"#smtp\" aria-label=\"smtp permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>SMTP (Simple Mail Transfer Protocol) on sähköpostijärjestelmässä käytetty siirtoprotokolla, jolla sähköposti siirretään vastaanottajan sähköpostipalvelimelle. Sitä voidaan käyttää myös sähköpostiviestin siirtämiseen viestiä lähettävän käyttäjän sähköpostiohjelmasta lähettäjän omalle sähköpostipalvelimelle viestin edelleenlähetystä varten. SMTP-protokolla on suunniteltu vain viestin siirtämiseen lähettäjältä vastaanottajalle. Siksi sitä ei voida käyttää viestin vastaanottavan käyttäjän sähköpostiohjelmassa viestin noutamiseen lukemista varten.</p><p>Nykyisin käytössä on lähinnä SMTP:stä edellen kehitetty ESMTP (Extended SMTP).  Tällä kurssilla ei paneuduta tähän laajennukseen, vaan opiskellaan sähköpostijärjestelmän toimintaperiaate tuon alkuperäisen SMTP:n kanssa, vaikka nykyään postipavelimien suositellaan käyttävän aina tuota laajennosta. Jos jotakuta laajennus kuitenkin kiinnostaa, niin <a href=\"https://fi.wikipedia.org/wiki/ESMTP\" target=\"_blank\" rel=\"noopener noreferrer\">suomenkielinen wikipedian sivu</a> on hyvä lähtökohta asian itsenäiselle tutkimiselle.</p><p>SMTP-protokollassa on määritelty monivaiheinen viestien vaihto lähettäjän ja vastaanottajan välillä. Niiden täytyy ylläpitää tilatietoa, jotta ne pysyvät kärryillä, missä vaiheessa viestien vaihto on menossa. Tässä SMTP poikkeaa HTTP-protokollasta. HTTP-protokolla, kuten muistamme, oli tilaton, jolloin lähettäjän ja vastaanottajan ei tarvinnut ylläpitää tilatietoa.</p><p>Oheinen yhteysesimerkki, eli yhden sähköpostiviestin (tässä merkitty DATA) siirto lähettävältä palvelimelta vastaanottavalla postipalvelimelle, on mukaeltu Visa Hännisen insinöörityössä <a href=\"https://www.theseus.fi/bitstream/handle/10024/23284/Hanninen_Visa.pdf?sequence=1&#x26;isAllowed=y\" target=\"_blank\" rel=\"noopener noreferrer\">\"SMTP-releointipalvelun valvonta ja raportointi\"</a>, Metropolia 2010, olleesta esimerkistä. Jokainen rivi on oma viestinsä. Rivin alussa on A (lähettää palvelin, eli tämän yhteyden asiakas) tai B (vastaanottava palvelin, eli tämän yhteyden palvelin), kertomassa kumpi kyseisen viestin lähettää.</p><ul>\n<li>A (lahettava.palvelin.com) avaa TCP-yhteyden B:lle (email.vastaanottaja.com)</li>\n<li>A:   HELO lahettava.palvelin.com</li>\n<li>B:   250 email.vastaanottaja.com Helo lahettava.palvelin.com, nice to interact with you</li>\n<li>A:   MAIL FROM: &#x3C;joku123@ lahettava.palvelin.com></li>\n<li>B:   250 sender &#x3C;joku123@ lahettava.palvelin > OK</li>\n<li>A:   RCPT TO: <a href=\"mailto:kuka123@postipalvelin.com\" target=\"_blank\" rel=\"noopener noreferrer\">kuka123@postipalvelin.com</a></li>\n<li>B:   250 recipient &#x3C;kuka123@ postipalvelin.com > OK</li>\n<li>A:   DATA</li>\n<li>B:   250 OK; enter text, end with .</li>\n<li>A:   Tämä on viestin sisältö.</li>\n<li>A:   .</li>\n<li>B:   250 postipalvelin.com OK; message accepted for delivery</li>\n<li>A:   QUIT</li>\n</ul><p>Tästä esimerkistä käy hyvin ilmi monivaiheinen viestien vaihto tilanteessa, kun sähköpostin siirto onnistuu. Protokollassa on määritelty tarkasti myös erilaiset virhetilanteet ja niihin liittyvät viestit. SMTP on HTTP-protokollan tavoin tekstipohjainen, jolloin ihmisen on mahdollista itsekin ottaa TELNET-yhteys palvelimeen ja kirjoittaa nuo lähettävän palvelimen viestit ihan suoraan näppäimistöltä. Tällaisessa yhteydessä on toki noudatettava myös niitä sääntöjä, jotka liittyvät itse viestin rakenteeseen. Esimerkissä näistä säännöistä on yksinkertaisuuden vuoksi oikaistu ja varsinainen sähköpostiviesti on korvattu vain yhdellä rivillä 'Tämä on viestin sisältö.'.</p><p>Aiemmin kurssilla käsitellyt prokollat, HTTP ja DNS, olivat tilattomia, koska niissä asiakas A lähetti vain yhden viestin ja palvelin B vastasi siihen. SMTP protokollassa tämän asiakkaan ja palvelimen välinen viestintä on monivaiheista, ne lähettävät toisilleen useita viestejä. Niillä on tarve seurata, missä vaiheessa viestien vaihto on nyt menossa. Tästä muodostuu tilatieto. Molempien on tärkeää tietää yhteyden sen hetkinen tila, jotta ne osaavat lähettää seuraavat viestit protokollan mukaisesti. Vain noudattamalla protokollan sääntöjä ne voivat toimia yhdessä.</p><p>Monivaiheinen viestien vaihto on suhteellisen tyypillistä erilaisille sovelluksille, mutta myös haastavaa, kun tietoliikenne on epäluotettavaa. Usein erilaisista virhetilanteista, kuten yksittäisen viestein katoamisesta, toipuminen olisi helpompaa, jos viestienvaihto onnistuu ilman tietoa aiemmista viesteistä, eli tilattomasti. Tlattomassa ratkaisussa ei tarvitse tietää historiaa, vaan jokainen viesti käsitellään sellaisenaan. SMTP-protokollan kanssa näin ei voida toimia, vaan aiempien viestien sisällöt määräävät toimintaa seuraavien viestien osalta. </p><h2 id=\"sahkopostin-lukeminen\" style=\"position:relative;\">Sähköpostin lukeminen<a href=\"#sahkopostin-lukeminen\" aria-label=\"sahkopostin lukeminen permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Käyttäjän sähköpostilaatikko on palvelimella ja käyttäjälle saapuneet sähköpostiviestit ovat siellä. Sähköpostipalvelin vain säilyttää näitä viestejä ja odottaa, että käyttäjä (tai oikeastaan asiakasohjelma) ottaa yhteyttä. </p><p>Jos käyttäjällä on omalla koneellaan joku erillinen sähköpostiohjelma kuten outlook, thunderbird tai vastaava, niin nämä ohjelmat tyypillisesti käyttävät joko <a href=\"https://fi.wikipedia.org/wiki/IMAP\" target=\"_blank\" rel=\"noopener noreferrer\">IMAP</a> (Internet Message  Access Protocol) tai <a href=\"https://fi.wikipedia.org/wiki/POP3\" target=\"_blank\" rel=\"noopener noreferrer\">POP3</a> prokollia käyttäjän palvelimella sijaitsevan sähköpostilaatikon käsittelyyn.  Huomaa, että näillä protokollilla käsitellään vain jo sähköpostilaatikossa olevia viestejä. Näillä siis luetaan saapuneita viestejä. Viestien lähettämiseen sähköpostiohjelmat käyttävät samaa SMTP protokollaa kuin sähköpostipalvelimetkin.</p><p>Näillä sähköpostiprotokollilla on hyvä havainnollistaa protokollien yleisempääkin piirrettä eli sitä kumpi osapuoli on aktiivinen toimija ja mihin suuntaan tietoa siirretään (PUSH vs PULL). PUSH-tyyppisissä protokollissa asiakas työntää tietoa palvelimelle, kun taas PULL-tyyppisissä protokollissa asiakas 'vetää' tietoa palvelimelta itselleen. Muistathan, että asiakas-palvelija-mallissa asiakas on aina yhteyttä ottava osapuoli. Näin sähköpostipalvelinkin on asiakas silloin, kun se ottaa yhteyttä toiseen sähköpostipalvelimeen ja antaa sille uuden sähköpostin sijoitettavaksi käyttäjän postilaatikkoon. </p><p>SMTP-protokollaa käytettäessä asiakas (lähettävä sähköpostipalvelimen) työntää (engl. PUSH) uuden sähköpostiviestin vastaanottavalla sähköpostipalvelimelle, joka voi vain ottaa sen vastaan.  Vastaanottavalla palvelimella ei juurikaan ole sanavaltaa. Tähän sähköpostijärjestelmän ominaisuuteen perustuu suuri osa roskapostin toiminnasta. Palvelimille vain työnnetään roskapostia, joka on menossa käyttäjien postilaatikoihin. PULL-tyyppisissä protokollissa, kuten IMAP ja POP3, viestin tai datan vastaanottaja päättäää mitä ja milloin se haluaa vastaanottaa.</p><p>Nykyään on yhä tyypillisempää, että käyttäjät hyödyntävät www-selaimia omien postilaatikoidensa käsittelyssä. Tällöin käyttäjän selaimen ja www-palvelimen välinen liikennöinti tapahtuu HTTP-protokollalla. WWW-palvelin pääsee käsiksi käyttäjän postilaatikkoon joko samoilla protokollilla (IMAP, POP3) kuin käyttäjän koneen sähköpostiohjelma tai se voi olla samassa järjestelmässä postipalvelimen kanssa, jolloin se voi lukea käyttäjän postilaatikon sisällön suoraan tiedostojärjestelmästä.</p><p>Huomaa, että sähköpostijärjestelmässä protokollia käytetään epäsymmetrisesti, koska SMTP on vain postien lähettämistä ja IMAP/POP3 sähköpostien lukemista varten. Aiemmin käytössä oli vain yksi protokolla, jotka käytettiin viestien välittämisen molempiin suuntiin.  Sähköpostijärjestelmässäkin kaikki protokollat oman yhteytensä aikana välittävät viestejä molempiin suuntiin, vaikka protokollan data eli itse sähköposti siirtyykin vain yhteen suuntaan. Epäsymmetrisyys tässä johtuu toisaalta historiasta ja toisaalta näiden tapahtumien ajallisesta etäisyydestä. Sähköpostin saapuminen postilaatikkoon voi tapahtua ajallisesti paljon ennen kuin käyttäjän asiakasohjelma käy sen postilaatikosta lukemasta.  </p><p>Huomasithan, että mikään näistä protokollista, SMTP, IMAP tai POP3, ei ota kantaa itse sähköpostiin tai sen rakenteeseen / sisältöön. Ne kuvaavat vain asiakkaan ja palvelijan välisen protokollan, jolla sähköpostiviesti voidaan sellaisenaan siirtää asiakkaalta palvelijalle (SMTP) tai palvelijalta asiakkaalle (IMAP, POP3).</p><h2 id=\"viestin-rakenne\" style=\"position:relative;\">Viestin rakenne<a href=\"#viestin-rakenne\" aria-label=\"viestin rakenne permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Sähköpostiviestit eivät yleensä ole ihan noin lyhyitä kuin aiemmassa esimerkissä, jossa viesti on vain yhden rivin mittainen \"Tämä on viestin sisältö.\".  Yleensä viestit ovat pidempiä. Itseasiassa tämä ei edes vastaa sähköpostiviestiltä vaadittavaa rakennetta.\nSähköpostiviestin rakenteesta on hyvä kuvaus <a href=\"https://fi.wikipedia.org/wiki/S%C3%A4hk%C3%B6posti\" target=\"_blank\" rel=\"noopener noreferrer\">wikipedian sivulla</a>.</p><p>Useimmat sähköpostiohjelmat käyttävät erillisiä kenttiä sähköpostin otsaketiedoille, kuten vastaanottaja(t) ja viestin otsikko. Näin ne tukevat käyttäjää siinä, että lähtevän sähköpostiviestin otsaketiedot noudattavat sovittuja käytänteitä. Sähköposti on kuitenkin vanha protokolla, jota voisi ihan yhtä hyvin käyttää suoraan komentoriviltä toimivilla tekstipohjaisilla ohjelmilla.</p><div><quiz id=\"28ee28b0-df6b-5de5-af55-bcb1cd4e0e14\"></quiz></div><p>Katso jonkun saamasi sähköpostiviestin täydet otsaketiedot ja etsi sieltä rivit, jotka alkavat \"Received:\". Huomaa, että jos viesti on tullut saman postipalvelimen joltain toiselta käyttäjältä, niin tuota received-riviä ei välttämättä ole lainkaan, koska postipalvelin ei ole lähettänyt sitä toiselle postipalvelimelle vaan on vain laittanut viestin kyseisen käyttäjän postilaatikkoon. Valitse siis tarkasteltavaksi viesti, joka on tullut jonkun toisen postipalvelimen käyttäjältä. Miten näet viestin otsaketiedot, riippuu käyttämästäsi sähköpostiohjelmasta. Toiminto voi olla 'view full header', 'view source', 'view original'. Joillakin, erityisesti mobiililaitteiden, sähköpostiohjelmilla tämän tiedon katselu ei välttämättä edes ole mahdollista, kun ohjelmassa ei kyseistä toiminnallisuutta ole. Vaihda silloin käyttöösi sellainen käyttöliittymä tai ohjelma, jolla nämä tiedot näet.</p><div><quiz id=\"f733c37e-ef14-5175-bebe-53e57afecaf3\"></quiz></div><p>Sähköpostiviestiin voi nykyään liittää myös muuta materiaalia kuin vain varsinaisen viestin pelkkänä tekstinä. Koska sähköpostiprotokolla on tekstimuotoinen ja koska viestin on sovittu päättyvän riviin, jossa on vain yksi merkki, piste, on kaikki sähköpostiin liitettävä muu materiaali kuin ASCII-muotoinen teksti koodattava ASCII-merkistölle sopivaksi.</p><p>Sähköpostiviestin laajennukset on määritelty MIME-standardissa (ks <a href=\"https://fi.wikipedia.org/wiki/MIME\" target=\"_blank\" rel=\"noopener noreferrer\">standardin wikipedia-sivu</a> ja <a href=\"https://fi.wikipedia.org/wiki/S%C3%A4hk%C3%B6posti#MIME\" target=\"_blank\" rel=\"noopener noreferrer\">sähköpostin koodausohjeistus</a>). MIME-muotoisessa sähköpostissa on useita osia ja jokainen osa voidaan koodata eri tavalla. Viestin liitteeksi voi laittaa minkä tahansa tiedoston, jonka tyyppi kerrotaan MIME-standardin mukaisissa tiedoissa.  Koska SMTP-protokolla siirtää varmasti vain 7-bittisiä ASCII-merkkejä, on tyypillistä, että erityisesti liitetiedostot ja kuvat koodataan 7-bittiseksi ASCII-koodiksi. Tunnetuin koodaustapa on base64, jossa kolme 8-bittistä tavua (tai merkkiä) koodataan 4:ksi, jotka eivät voi rikkoa sähköpostin siirtoa. Esimerkiksi merkkiyhdistelmä 'rivinvaihto' 'piste' 'rivinvaihto' ei ole sallittu, koska se on sovittu SMTP-protokollassa sähköpostiviestin päättäväksi merkiksi.</p><h2 id=\"sahkopostin-ongelmia\" style=\"position:relative;\">Sähköpostin ongelmia<a href=\"#sahkopostin-ongelmia\" aria-label=\"sahkopostin ongelmia permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Huomasithan, että lähettäjän ja vastaanottajan tiedot toimitettiin kahteen kertaan. Toisaalta ne olivat SMTP-protokollan viestien vaihdossa mukana ja toisaalta ne tulivat sitten varsinaisen sähköpostin alussa otsaketietoina kentissä From: ja To:.</p><p>Sähköpostin vastaanottava sähköpostipalvelin ei tarkasta, että protokollassa annetut osoitteet ja viestin mukaan tulleet osoitteet ovat samat.  Mieti hetki, että miksi ei! Jos tarkastaisi, niin mitä tapahtuisi, kun viestiä lähetetään postilistalle esim. meidanjoukko@osoite.com.</p><p>Valitettavasti tämä tietojen kirjaaminen kahteen kertaan antaa mahdollisuuden piilottaa todellinen lähettäjä. SMTP-protokollan mukainen lähettäjän tunniste voi siis olla eri kuin viestin mukana olevaan From: kenttään kirjoitettu tunniste. Tietenkään normaalisti toimiva sähköpostiohjelma ei anna käyttäjälle mahdollisuutta näiden erilaisuuteen. Aikoinaan, kun käytettiin yksinkertaista SMTP-protokollaa ja luotettiin viestien lähettäjiin ei ollut mitenkään vaikeaa väärentää viestejä. Nykyisin se on jo hiukan hankalampaa, kun luotettavat sähköpostipalvelimet vaativat tunnistautumista. Sähköpostipalvelin voikin kieltäytyä vastaanottamasta yhteyspyyntöjä ja viestejä epäluotettavilta palvelimilta. Sähköpostipalvelimet voivat itse ylläpitää tällaista <a href=\"https://fi.wikipedia.org/wiki/Musta_lista_(s%C3%A4hk%C3%B6posti)\" target=\"_blank\" rel=\"noopener noreferrer\">mustaa listaa</a> tai ne voivat käyttää jonkun toisen organisaation ylläpitämää mustaa listaa epäluotettavista palvelimista.</p><p>Kaikkea <a href=\"https://fi.wikipedia.org/wiki/Roskaposti\" target=\"_blank\" rel=\"noopener noreferrer\">roskapostia</a> tai <a href=\"https://fi.wikipedia.org/wiki/Haittaohjelma\" target=\"_blank\" rel=\"noopener noreferrer\">haittaohjelmien</a> lähettämistä mustien listojen käytöllä ei voi estää. Sähköpostipalvelimien ylläpitäjät ottavat koko ajan käyttöön uusia suojautumiskeinoja. Valitettavasti mikään suojautuminen ei tepsi järjestelmän todellisten käyttäjätunnusten väärinkäyttöön. Aina on mahdollista, että luvattomasti käyttöön saatua tunnusta käytetään tällaisten haitallisten sähköpostien lähettämiseen luotettavan sähköpostipalvelimen kautta. Siksi käyttäjien pitää pitää hyvää huolta tunnuksistaan. Vaikka itsellä ei olisikaan arvokasta tietoa, niin tunnuksen luvaton käyttö voi aiheuttaa merkittävää haittaa muille internet-verkon käyttäjille.</p><h2 id=\"viestien-suojaus-ja-allekirjoitus-salaus\" style=\"position:relative;\">Viestien suojaus ja allekirjoitus (salaus)<a href=\"#viestien-suojaus-ja-allekirjoitus-salaus\" aria-label=\"viestien suojaus ja allekirjoitus salaus permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Jos viestin lähettäjä haluaa varmistua, että vain viestin vastaanottaja voi lukea viestin, täytyy lähettäjän salakirjoittaa viesti jotain salausmenetelmää käyttäen. Vastaanottajan täytyy tietää, miten viesti on salattu, jotta hän voi sen purkaa ja lukea alkuperäisen sisällön. Sähköpostijärjestelmässä viesti kulkee sellaisenaan, joten ilman salausta kuka tahansa, joka viestin saa käsiinsä, voi sen lukea.</p><p>Viestien salaus ei sinänsä ole sidoksissa sähköpostijärjestelmään, mutta usein sähköpostia käytetään näiden viestien siirtoon lähettäjältä vastaanottajalle. Tässä kuitenkin tarkastellaan asiaa sähköpostipalvelun kautta. Asioiden yleispätevyys on lukijan kuitenkin hyvä huomata.</p><p><a href=\"https://fi.wikipedia.org/wiki/PGP\" target=\"_blank\" rel=\"noopener noreferrer\">PGP</a> oli pitkään suosituin viestien salaukseen käytetty menetelmä sähköpostien kanssa. Sähköpostijärjestelmän MIME-laajennus ja <a href=\"https://fi.wikipedia.org/wiki/Julkisen_avaimen_salaus\" target=\"_blank\" rel=\"noopener noreferrer\">julkisen avaimen salausmenetelmät</a> antoivat riittävän teknisen pohjan PGP-järjestelmälle. </p><p>Sittemmin MIME:ä laajennettiin myös käsittelemään salattuja viestejä. <a href=\"https://fi.wikipedia.org/wiki/S/MIME\" target=\"_blank\" rel=\"noopener noreferrer\">S/MIMEn</a> versio 3.1 on kuvattu <a href=\"https://tools.ietf.org/html/rfc3851\" target=\"_blank\" rel=\"noopener noreferrer\">RFC:ssä 3851</a>.</p><p>Julkisen avaimen salauksen avulla voidaan varmistua joko vastaanottajasta tai lähettäjästä seuraavasti:</p><ol>\n<li>Viestin voi lukea vain oikea vastaanottaja!  Viesti salataan vastaanottajan julkisella avaimella.</li>\n<li>Viestin lähettäjä on varmasti oikea!  Viesti salataan lähettäjän salaisella avaimella. Tämä on digitaalinen allekirjoitus.</li>\n</ol><p><a href=\"https://fi.wikipedia.org/wiki/Digitaalinen_allekirjoitus\" target=\"_blank\" rel=\"noopener noreferrer\">Digitaalisessa allekirjoituksessa</a> ei aina ole välttämätöntä suojata koko sisältöä ja siksi usein varsinaisesta sisällöstä lasketaan ns. tiiviste ja sitten salataan (eli allekirjoitetaan) vain tämä tiiviste.</p><p>Jos halutaan samaan aikaa varmistaa sekä lähettäjä että vastaanottaja, on viesti salattava useampaan kertaan.</p><p>Kiinnostuneille tiedoksi, että vuonna 2019 määriteltiin myös postipalvelimien käyttämä autentikointien ketjutus (engl. <a href=\"https://en.wikipedia.org/wiki/Authenticated_Received_Chain\" target=\"_blank\" rel=\"noopener noreferrer\">Authenticated Received Chain</a>, ARC), jolla pyritään tukemaan postilistojen toimintaa silloin, kun postilistan käsittelee joku muu postipalvelin kuin alkuperäisen viestin lähettäjän oman palvelin.</p></div>","frontmatter":{"path":"/osa-2/4-sahkoposti","title":"Sähköposti"},"fileAbsolutePath":"/home/runner/work/tietoliikenteen-perusteet-2-21/tietoliikenteen-perusteet-2-21/data/osa-2/4-sahkoposti.md"},"allPages":{"edges":[{"node":{"id":"f94770ac-b87c-5b6d-aea7-87e3206ebc1a","frontmatter":{"path":"/","title":"Tietoa kurssista"}}},{"node":{"id":"07fbca84-2996-5ef5-91f4-80c8d67b1f6d","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"72f0d3aa-a615-5485-927a-1d9efa922a6d","frontmatter":{"path":"/kurssin-suorittaminen","title":"Kurssin suorittaminen"}}},{"node":{"id":"5dc284ce-33b0-5641-92d3-f3cbd298ae3e","frontmatter":{"path":"/opettajille","title":"Opettajille ja opinto-ohjaajille"}}},{"node":{"id":"71ffb689-39cd-54e4-afb1-10639d37b540","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"92902113-bd4d-54cb-8e4c-2d914a94a43b","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"73d38dec-d739-5d94-b391-abef8e5373b6","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"18912f50-4c07-571f-9704-91752a0bc432","frontmatter":{"path":"/osa-1/1-johdanto","title":"Johdanto"}}},{"node":{"id":"451f39f3-eecd-5fe0-a231-f701dbb224ea","frontmatter":{"path":"/osa-1/2-kertausta","title":"Kertausta"}}},{"node":{"id":"0148ecbb-fcfc-575a-ad8c-63788d56b585","frontmatter":{"path":"/osa-1/3-viipeet-ja-läpäisy","title":"Viipeet ja läpäisy"}}},{"node":{"id":"caab8edd-cf17-5b21-bfcd-4f30373615af","frontmatter":{"path":"/osa-1/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"2edd2121-da28-5faa-a44c-8f2d579fdc83","frontmatter":{"path":"/osa-1","title":"Osa 1: Yleistä"}}},{"node":{"id":"dbfac743-cc99-5393-83ad-23546879a4ff","frontmatter":{"path":"/osa-1/4-piirikytkentä","title":"Pakettikytkentä vs piirikytkentä"}}},{"node":{"id":"6a6f50c9-6751-5805-b191-0dc5ea90c487","frontmatter":{"path":"/osa-2/1-periaatteita","title":"Verkkosovelluksen toimintaperiaatteita"}}},{"node":{"id":"ccab9cf4-3881-552b-a03c-8cc97041dc82","frontmatter":{"path":"/osa-2/2-laki-ja-kuuntelu","title":"Verkon kuuntelu ja lainsäädäntö"}}},{"node":{"id":"4d9b998c-1b33-541d-a142-0f0cad57da54","frontmatter":{"path":"/osa-2/3-nimipalvelu","title":"Nimipalvelu"}}},{"node":{"id":"54075fab-cf7e-59f3-aad5-1a2fbfbc549a","frontmatter":{"path":"/osa-2/5-verkko-ohjelmointi-rajapinta","title":"Verkko-ohjelmointi ja sovelluksen rajapinta"}}},{"node":{"id":"6309357c-886a-5e4d-88c1-399099c965ab","frontmatter":{"path":"/osa-2/4-sahkoposti","title":"Sähköposti"}}},{"node":{"id":"c18adde4-4460-569a-819b-fc93ea16b497","frontmatter":{"path":"/osa-2/6-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"38f09292-8ebb-55a2-aeb0-9efba1ccc739","frontmatter":{"path":"/osa-2","title":"Osa 2: Sovelluskerros"}}},{"node":{"id":"13a24d8f-bc56-5d8a-8aa4-1e6f602af95e","frontmatter":{"path":"/osa-3/1-kuljetuspalvelu","title":"Kuljetuspalvelun toiminta"}}},{"node":{"id":"ef3093c1-baa2-56e7-a495-6cf6fcafdda7","frontmatter":{"path":"/osa-3/2-periaatteet","title":"Luotettavan kuljetuspalvelun periaatteet"}}},{"node":{"id":"4da3b549-a94d-5a7a-91dd-71b2d6a1e4d1","frontmatter":{"path":"/osa-3/3-liukuvaikkuna","title":"Liukuva ikkuna"}}},{"node":{"id":"b955b25c-822f-56a2-a571-d0ed4227e4ef","frontmatter":{"path":"/osa-3/4-suunnitteluperiaatteita","title":"Suunnitteluperiaatteita"}}},{"node":{"id":"a9f3b554-3a38-5f0f-99a9-8375816fd4cb","frontmatter":{"path":"/osa-3/6-udp","title":"UDP"}}},{"node":{"id":"0be5b703-d205-501e-b174-e8d33e95c832","frontmatter":{"path":"/osa-3/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"7b424c06-2601-5402-bc43-c2959d121643","frontmatter":{"path":"/osa-3","title":"Osa 3: Kuljetuskerros"}}},{"node":{"id":"724b3cc2-dd79-5872-a0e6-706fece0415a","frontmatter":{"path":"/osa-3/5-tcp","title":"TCP"}}},{"node":{"id":"b20703a9-2d0a-5467-a824-c86ac6579e1d","frontmatter":{"path":"/osa-4/1-IPv4-IPv6","title":"IPv4 ja IPv6 osoitteet"}}},{"node":{"id":"80365dff-896c-5368-896e-eec79b5129b0","frontmatter":{"path":"/osa-4/2-IP-protokolla","title":"IP-protokolla"}}},{"node":{"id":"55d42f0f-65fe-5038-8b60-67f6fc4bff83","frontmatter":{"path":"/osa-4/3-reititys","title":"Reititys"}}},{"node":{"id":"77442160-5292-5d91-b03f-c12f326017ca","frontmatter":{"path":"/osa-4/5-muita-verkkokerroksen-protokollia.md","title":"Muita verkkokerroksen protokollia"}}},{"node":{"id":"0c4f9075-9058-5109-8b3e-33cf37e05e05","frontmatter":{"path":"/osa-4/4-reititin","title":"Reititin"}}},{"node":{"id":"bb679c1b-fa88-5f1a-bcb5-5c7e4e0fb566","frontmatter":{"path":"/osa-4/6-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"a251821d-10ca-5d3c-8e2e-486145b750bb","frontmatter":{"path":"/osa-4","title":"Osa 4: Verkkokerros"}}},{"node":{"id":"4006d9b8-5c45-5f82-84c4-ec932ff6cca4","frontmatter":{"path":"/osa-5/2-virheidenhavaitseminen","title":"Virheiden havaitseminen ja korjaaminen"}}},{"node":{"id":"5e45a11a-8de3-5284-a686-5fbd5828cc39","frontmatter":{"path":"/osa-5/1-linkki-toiminta","title":"Yleistä linkkikerroksen toiminnasta"}}},{"node":{"id":"ccba763f-0ffa-5398-a9c2-6f9e23b97270","frontmatter":{"path":"/osa-5/4-kytkin","title":"Kytkin"}}},{"node":{"id":"116b10b0-2f44-5011-a169-593eecfe6d50","frontmatter":{"path":"/osa-5/5-toiseen-verkkoon","title":"Lähettäminen toiseen verkkoon"}}},{"node":{"id":"54ca89a6-0d64-515e-8101-498fdcee037f","frontmatter":{"path":"/osa-5/3-vuorojen-jakelu","title":"Lähetysvuorojen jakelu"}}},{"node":{"id":"ba6c210e-c87f-5f21-95af-f5e66c293f36","frontmatter":{"path":"/osa-5/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"830def90-4428-575f-99a5-c9231b692dcd","frontmatter":{"path":"/osa-5","title":"Osa 5: Linkkikerros"}}},{"node":{"id":"a7407bc4-70d0-5174-9953-3860b86f2863","frontmatter":{"path":"/osa-6/1-kaikki-yhteen","title":"Kaikki yhteen"}}},{"node":{"id":"8e65b949-f5a9-5dd4-926d-2a678606218d","frontmatter":{"path":"/osa-6/2-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"f9c4a320-75ad-58cf-a44a-6f76b761e08f","frontmatter":{"path":"/osa-5/6-langaton","title":"Langaton verkko"}}},{"node":{"id":"5daae54a-eb34-5ed0-b5a7-93b1d4ba1a68","frontmatter":{"path":"/osa-6","title":"Osa 6: Kaikki yhteen"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}