{"componentChunkName":"component---src-templates-course-content-template-js","path":"/osa-3/3-liukuvaikkuna","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Oppimistavoitteet"},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat yleisellä tasolla kuvata liukuvan ikkunan periaatteen."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat perustella miksi liukuvan ikkunan käyttäminen tiedon siirrossa nopeuttaa sitä yksinkertaiseen pysähdy-ja-odota -malliin verrattuna."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat kuvata miten liukuvan ikkunan kanssa voidaan toipua viestien katoamisesta."}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"viestien-liukuhihnoitus","style":"position:relative;"},"children":[{"type":"text","value":"Viestien liukuhihnoitus"},{"type":"element","tagName":"a","properties":{"href":"#viestien-liukuhihnoitus","ariaLabel":"viestien liukuhihnoitus permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Edellä käytiin läpi luotettavan kuljetuspalvelun teoriaa äärellisten tila-automaattien avulla. Saimme niillä kuvattua hyvin yksinkertaisen järjestelmän, jossa lähettäjä lähettää yhden viestin ja pysähtyy odottamaan kuittausta tähän viestiin. Tällainen pysähdy-ja-odota (engl. stop-and-wait) -protokolla on liian hidas todelliseen käyttöön, koska lähettäjän ja vastaanottajan välisen tiedonsiirron keston ajan lähettäjä vain odottaa. Tämän odotuksen kesto on noin kaksi kertaa yhdensuuntaisen paketin siirron kesto, koska sanoma kulkee lähettäjältä vastaanottajalle ja sitten kuittaus kulkee takaisinpäin. Tätä aikaa, joka viestin lähetyksessä kuluu viestin kulkuun edestakaisin, kutsutaan "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"kiertoviiveeksi"}]},{"type":"text","value":" (engl. roundtrip time, RTT)."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yksinkertaisessa järjestelmässä, kuten vuorottelevan bitin protokolla, lähettäjä pysähtyy jokaisen paketin jälkeen odottamaan vastausta. Jolloin kahden peräkkäisen viestin välissä kuluu noin yhden kiertoviiveen verran aikaa. Tiedonsiirtoa voidaan nopeuttaa vain, jos saamme kahden peräkkäisen viestin lähettämisten välistä aikaa lyhyemmäksi. Kun kurssin alussa tarkastelimme viipeitä, niin havaitsimme, että lähetettävän datan pilkkominen pienempiin osiin nopeuttaa sen kulkemista verkossa, jos voimme lähettää kaikki palaset liikkeelle peräkkäin. Tarvitaan siis monimutkaisempi toteutus kuin yksinkertainen pysähdy-ja-odota. Toki voisimme yhden viestin sijaan lähettää vaikkapa 10 viestiä ja sitten odottaa niille kaikille vastaukset ennen seuraavan purskeen lähettämistä. Tällä saadaan jo viestintää nopeutettua,kun yhtä kierrosta kohti lähetetään enemmän dataa. Mallinnuksen ja algoritmien kannalta kyseessä on kuitenkin edelleen pysähdy-ja-odota -tyyppinen käyttäytyminen, koska lähettäjä odottaa vastausviestin kaikkiin lähetettyihin viesteihin, ennen kuin se lähettää lisää viestejä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos viestien lähettäminen liukuhihnoitetaan (engl. pipeline) siten, että lähettäjällä voi olla N kappaletta viestejä odottamassa kuittausta ja lähettäjä voi aina lähettää yhden uuden viestin, kun se saa kuittauksen vanhimpaan lähetettyyn viestiin, niin päästään käyttämään liukuvan ikkunan mallia. Ikkuna kattaa täsmälleen ne viestit, jotka on lähetetty, mutta joille ei vielä ole saapunut kuittausta. Kun kuittaus saapuu, niin ikkuna siirtyy ja lähettäjä pääsee lähettämään uuden viestin. Tässä on tärkeää huomata, että järjestyksessä ensimmäinen (pienin numero, vanhin lähetetty) kuittaamaton viesti on aina ikkunan reunassa. Jo kuitatut viestit eivät siis enää ole ikkunassa, koska niistä lähettäjä tietää, että vastaanottaja on ne varmasti saanut."}]},{"type":"element","tagName":"img","properties":{"src":"/17584d1978fe64a1042f9a91691bc688/3-3-ikkuna1.svg","alt":"Lähetettävä data, joka on siis kolmessa ryhmässä. 1) Jo lähetetyt ja kuitatut viestin, 2) lähetetty, mutta ei vielä kuitatut ja 3) lähettämättömät viestit. Näistä tuo ryhmä 2 on se, joka on ikkunassa."},"children":[]},{"type":"text","value":"\nKUVA: Lähetettävä data, joka on siis kolmessa ryhmässä. 1) Jo lähetetyt ja kuitatut viestin, 2) lähetetyt, mutta ei vielä kuitatut ja 3) lähettämättömät viestit. Näistä ryhmä 2 on se, joka on ikkunassa."},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Liukuvan ikkunan (engl. sliding window) mallissa tavoitteena on, että lähettäjän ja vastaanottajan välillä on koko ajan liikkeellä viestejä ja kuittauksia siten, että lähettäjän ei tarvitsisi koskaan erikseen pysähtyä odottamaan kuittauksia. Luotettavan kuljetuspalvelun toteutus edellytti, että viestit menevät perille ja että ne menevät perille oikeassa järjestyksessä. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nyt kun matkalla on useita viestejä, on tärkeää numeroida viestit siten, että vastaanottaja voi tarvittaessa järjestää saapuvat viestit oikeaan järjestykseen. Vastaanottajan pitää siis voida havaita, jos joku viesti puuttuu välistä. Numeroimme viestejä äsken tuossa vuorottelevan bitin protokollassa, mutta meillä oli käytössä vain numerot 0 ja 1. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Protokollien kanssa meillä on käytössä vain äärellinen määrä numeroita, joita sitten kierrätetään. Tässä on taustalla kaksi erilaista seikkaa jotka tähän johtavat. Protokollan toiminnan analyysissä äärellinen määrä tiloja on toivottavaa ja se johtaa äärelliseen numeroavaruuteen. Toinen ihan yhtä merkittävä seikka on se, että viestin numero on tyypillisesti osa otsaketietoja ja otsakkeessa selle voidaan varata vain äärellinen tila, mikä rajoittaa käytettävää numeroavaruutta. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Esimerkiksi, kun meillä on käytettävissä vain kolmen bitin mittainen alue numerolle, niin voimme käyttää vain numeroita 0,1,..7 (eli meillä on 8 erilaista numeroa). Kun juuri lähetetyn viestin numero oli 7, niin seuraavan viestin numero on 0. Matemaattisesti käytämme siis "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Modulaarinen_aritmetiikka","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"modulaariaritmetiikkaa"}]},{"type":"text","value":" eli luvun 8 jakojäännöksiä. Tätä merkitään usein mod 8."}]},{"type":"element","tagName":"h2","properties":{"id":"liukuvan-ikkunan-toimintaperiaate","style":"position:relative;"},"children":[{"type":"text","value":"Liukuvan ikkunan toimintaperiaate"},{"type":"element","tagName":"a","properties":{"href":"#liukuvan-ikkunan-toimintaperiaate","ariaLabel":"liukuvan ikkunan toimintaperiaate permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ikkunan koko määrää sen, kuinka monta kuittaamatonta viestiä voi olla yhtä aikaa matkalla lähettäjältä vastaanottajalle. Lähettäjän ei ole pakko lähettää niitä kaikkia, mutta enempää se ei saa lähettää."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ikkunan ulkopuolella voi jonossa olla lähetysvuoroa odottavia viestejä. Näitä ei ole vieä lähetetty, joten ne vasta odottavat lähetysvuoroa. Lähettäjä ottaa niitä järjestyksessä käsittelyyn sitä mukaan, kun lähetysikkunaan mahtuu. Tätä kuvataan myös ikkunan siirtymisellä näiden viestien kohdalle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ikkunasta jo poistuneista viesteistä ei olla enää kiinnostuneita, koska ne kuljetuspalvelu on saanut onnistuneesti siirrettyä lähettäjältä vastaanottajalle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kiinnostavin viesti on ikkunasta seuraavaksi poistuva viesti. Se on siis ikkunan reunassa ja sen lähettämisestä on kulunut pisin aika. Sitä ei ole vielä kuitattu, joten lähettäjällä ei ole tietoa, onko vastaanottaja saanut sen. Vasta kun kuittaus saapuu lähettäjälle voi kuljetuspalvelu olla varma siitä, että kyseinen viesti on onnistuneesti toimitettu perille ja vasta silloin ikkuna voi liikkua sen ohi."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yksinkertaisella äärellisellä tila-automaatilla emme voi enää mallintaa liukuvan ikkunan -algoritmin toimintaa, koska tarvitsisimme juoksevan numeroinnin viesteille ja yksinkertaiset automaatit eivät osaa parametrisoituja viestejä. Siksi äskeisessä vuorottelevan bitin mallissakin meillä oli kaksi eri viestiä m0 ja m1. Sellaisen automaatin laatiminen, jossa olisi paljon enemmän viestejä ja paljon enemmän tiloja, on toki mahdollista, mutta ei ole enää mielekästä.  Vuorottelevan bitin mallia voidaan pitää yksinkertaisimpana mahdollisena liukuvan ikkunan järjestelmänä. Siinä ikkunan koko on yksi eli ikkuna on juuri sen viestin kohdalla, joka on lähetetty ja jonka kuittausta odotetaan saapuvaksi. Viestit on myös numeroitu moduloaritmetiikan mukaisesti numeroilla 0 ja 1 (mod 2), ja ne muodostavat ketjun 0,1,0,1,0,1,0,1, jne."}]},{"type":"element","tagName":"h2","properties":{"id":"viestin-katoamisesta-toipuminen","style":"position:relative;"},"children":[{"type":"text","value":"Viestin katoamisesta toipuminen"},{"type":"element","tagName":"a","properties":{"href":"#viestin-katoamisesta-toipuminen","ariaLabel":"viestin katoamisesta toipuminen permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Luotettavan kuljetuspalvelun ongelma on se, että sen käyttämä kanava on epäluotettava ja voi siis kadottaa viestejä, järjestää viestejä, vaurioittaa viestejä ja jopa monistaa yksittäisen viestin. Kuljetuspalvelun pitää selvitä näistä kaikista ongelmista."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Monistunut viesti on helppo, se pitää vain tunnistaa ja myöhemmin saapunut kopio jättää huomioimatta. Vastaanottajan pitää huomata viestien järjestyksen vaihtuminen. Kuljetuspalvelun vastaanottopään pitää antaa viestit eteenpäin oikeassa (lähetys)järjestyksessä, ei siis saapumisjärjestyksessä. Jos vastaanottajalla ei ole puskuria tallentaa väärässä välissä 'liian aikaisin' saapuneita viestejä, niin se joutuu ne kadottamaan, jolloin päädytäänkin kadonneen viestin ongelmaan. Vaurioitunut viesti voidaan käsitellä kadonneena viestinä, koska sisällön oikeellisuuteen ei enää voi luottaa. Kadonneen viestin osalta toipuminen edellyttää aina viestin uudelleenlähetystä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lähettäjähän voi havaita kadonneen viestin vain siitä, että siihen liittyvää kuittausviestiä ei tule. Tähän käytetään yleensä ajastinta, jolloin kuittausviestiä odotetaan vain tietty aika, tyypillisesti noin kaksi kertaa kiertoviiveen arvioitu kesto. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ajastimen laukeamisen jälkeen lähettäjä lähettää tämän kadonneeksi toteamansa viestin uudelleen. Mutta mitä pitäisi tehdä muille ikkunassa oleville jo lähetetyille viesteille? Lähettää nekin uudelleen, vai olettaa, että ne olisivat päässet perille ja vastaanottajalla on riittävä puskuri niiden säilyttämiseen odottamassa toimitusvuoroaan? Tähän ei ole yhtä ja ainoaa oikeaa vastausta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Liukuvan ikkunan protokollassa uudelleenlähetys voidaan toteuttaa joko valikoivana uudelleenlähetyksenä (engl. selective repeat) tai koko ikkunan uudelleenlähetyksenä. Tätä koko ikkunan uudelleenlähetystä kutsutaan usein nimellä Paluu-N:ään (engl. Go-Back-N), koska ajatellaan, että meillä on lähetyskohdan ilmaiseva osoitin, joka siirretään, eli palautetaan, taaksepäin tuohon kohtaan N, josta lähettämistä jatketaan."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Menetelmän valinta voi riippua esimerkiksi siitä, kuinka iso ikkuna on, onko vastaanottajalla puskuria vai ei, tai siitä kuinka suuri kiertoviive on. Valinnassa pyritään aina löytämään optimiratkaisu eri seikkojen suhteen. Myös tietoliikenteen maksuperuste saattaa vaikuttaa asiaan. Jos jokaisesta siirretystä tavusta maksetaan, niin silloin kannattaa pitää siirrettävän tiedon määrä mahdollisimman pienenä. Jos maksetaan siirtoajasta, niin silloin sitä pitäisi yrittää minimoida. Lähettäjällä ja vastaanottajalla voi olla erilainen kustannus. Kiinteä maksu, joka ei ole suoraan sidottu siirrettävään datamäärään tai yhteyden kestoon, ei vaikuta uudelleenlähetysten kustannuksiin, jolloin liikennöintikustannusta ei tarvitse ottaa huomioon. Koska kiinteät kuukausimaksut ovat nykyisin hyvin tyypillinen tapa, niin jatkossa tietoliikenteen kustannuksia ei käytetä valintaperusteena. On kuitenkin hyvä muistaa, että tietyissä erikoistilanteissa silläkin voi olla merkitystä."}]},{"type":"element","tagName":"h3","properties":{"id":"paluu-naan-go-back-n","style":"position:relative;"},"children":[{"type":"text","value":"Paluu-N:ään (Go-Back-N)"},{"type":"element","tagName":"a","properties":{"href":"#paluu-naan-go-back-n","ariaLabel":"paluu naan go back n permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Paluu-N:ään on toiminnallisesti hyvin yksinkertainen. Kun vanhimpaan viestiin liittyvää kuittausta ei tule ajoissa, ajastin laukeaa ja lähettäjä lähettää kaikki ikkunassa olevat viestit uudelleen. Vastaanottaja lähettää kuittausviestin jokaisesta saapuvasta paketista, mutta kuitattavan viestin numero voi olla eri kuin saapuneen viestin numero."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jokainen kuittaus kertoo lähettäjälle, että vastaanottaja on saanut kyseisen paketin lisäksi kaikki sitä edeltävät paketit. Tätä kutsutaan kumulatiiviseksi kuittaukseksi (engl. cumulative acknowledgement). Näin yksittäinen katoava kuittausviesti ei pääse aiheuttamaan massiivista uudelleenlähetystä. Huomaa, että kumulatiivisessa kuittauksessa yksi saapuva kuittaus voi kuitata useita paketteja. Tämän vuoksi vastaanottaja ei aina voi kuitata saapuvaa pakettia paketin omalla kuittausnumerolla vaan joutuu käyttämään viimeisimmän yhtenäisessä ketjussa aiemmin saapuneen paketin kuittausnumeroa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lähettäjän toiminnallisuus = tapahtumat, joihin pitää reagoida"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Viesti sovelluskerrokselta: Oletetaan, että meillä on ääretön puskuri, joten viesti lisätään lähetysjonoon. Tarkista, onko ikkuna täynnä (eli onko jo N kuittaamatonta viestiä). Jos ikkuna ei ole vielä täynnä, lähetä viesti vastaanottajalle. Jos ikkuna on täynnä, viestiä ei voi vielä lähettää."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Kuittausviesti saapuu: Jos kuittaa jo aiemmin kuitattuja viestejä, niin älä tee mitään. Jos kuittaa uusia kuittaamattomia viestejä, niin siirrä ikkunan reuna ensimmäiseen kuittaamattomaan. Jos lähetysjonossa on lähetettävää, niin lähetä ne yksitellen, kunnes ikkuna on täynnä tai ei enää lähetettävää."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Ajastin laukeaa: Oletetaan, että ajastimen laukeaminen liittyy aina ikkunan vanhimpaan viestiin, joten lähetä ikkunan sisältö eli kaikki aiemmin lähetetyt kuittaamattomat viestit uudelleen."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vastaanottajan toiminnallisuus = tapahtumat, joihin pitää reagoida"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Vastaanottaja odottaa seuraavaksi viestiä, jonka järjestysnumero on N+1, koska se on jo toimittanut sovelluskerrokselle ja kuitannut kaikki viestit järjestysnumeroon N asti."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Saapuu viesti, jonka järjestysnumero on oikein eli N+1: Lähetä kuittaus N+1 ja toimita viesti sovelluskerrokselle. (Kasvata odotettavan viestin järjestysnumeroa yhdellä.)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Saapuu viesti, jonka järjestysnumero on väärin eli ei ole N+1: Lähetä kuittaus N. Viestin voi kadottaa."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vastaanottajan on tärkeä kuitata kaikki saapuvat viestit, vaikka niillä olisi 'väärä järjestysnumero'. Tämä on tärkeää, koska vastaanottaja ei voi olla varma omien aiempien kuittaustensa perillemenosta. Näiden kuittausten tavoitteena on varmistaa, että lähettäjä saisi tiedon siitä, mihin asti vastaanottajalla on katkeamaton ketju jo toimitettuja viestejä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Miksi vastaanottaja voi kadottaa väärässä järjestyksessä saapuvan viestin? Se voi luottaa siihen, että lähettäjä kuitenkin lähettää viestin uudelleen, jos ja kun edeltävä viesti on kadonnut. Näin sen ei tarvitse tallettaa puskuriin liian aikaisin saapuneita paketteja ja vastaanottajan toiminta on paljon yksinkertaisempaa. Se pitää tallessa vain tietoa siitä, mikä on seuraavaksi odotetun oikean paketin järjestysnumero. Toki on mahdollista, että vastaanottaja puskuroi paketteja, mutta silloin oikean paketin saavuttua sen pitää tutkia puskuria ja selvittää, kuinka monta pakettia se voi toimittaa sovelluskerrokselle puskurista. Kuittausviestissä menevä järjestysnumero muuttuu sitten tämän tiedon mukaisesti."}]},{"type":"element","tagName":"img","properties":{"src":"/9de82e18cc54b5487d45d7b4b1cac6de/go-back-n.svg","alt":"Kuvassa lähettäjän ja vastaanottajan välinen viestintä. Kuvassa on aikajanalla Paluu-N:ään toiminta, kun ikkunan koko on 4 ja paketti 2 katoaa. Kuvaan on piirretty se mitkä viestit kulloinkin ovat ikkunassa ja mitä viestejä lähettäjään ja vastaanottajan välillä kulkee. Viestit on numeroitu 0:sta alkaen.  Lähettäjä(jatkossa vain L): -viesti0 (ikkunassa 0); L: -viesti1 (ikk. 0,1); Vastaanottaja (jatkossa vain V):+viesti0,-ack0; L:-viesti2 (Tämä katoaa!) (ikkuna 0,1,2); L: -viesti3 (ikkkuna 0,1,2,3); V: +viesti1,-ack1; L:+ack0, -viesti4 (ikkuna 1,2,3,4); L:+ack1,-viesti5 (ikkuna 2,3,4,5); V:+viesti3, ack1 (odotti 2:sta, joten siksi kuittaus ack1); V:+viesti4,ack1; L:+ack1 (on tullut jo, joten ei tee muuta); L:+ack1; V:+viesti5, ack1; L: Ajastin laukeaa, -viesti2; L:-viesti3; L:+ack1; V:+viesti2,-ack2; L:-viesti4; L:-viesti5; L:+ack2,-viesti6 (ikkuna 3,4,5,6); ..."},"children":[]},{"type":"text","value":"\nKUVA: Kuvassa on aikajanalla Paluu-N:ään toiminta, kun ikkunan koko on 4 ja paketti 2 katoaa. Kuvaan on piirretty se, mitkä viestit kulloinkin ovat ikkunassa ja mitä viestejä lähettäjän ja vastaanottajan välillä kulkee. Viestit on numeroitu 0:sta alkaen."},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"ffa8911b-7006-5b1c-9cbe-500bbfa4bf47"},"children":[{"type":"text","value":"  "}]}]},{"type":"element","tagName":"h3","properties":{"id":"valikoiva-uudelleenlahetys-selective-repeat","style":"position:relative;"},"children":[{"type":"text","value":"Valikoiva uudelleenlähetys (selective repeat)"},{"type":"element","tagName":"a","properties":{"href":"#valikoiva-uudelleenlahetys-selective-repeat","ariaLabel":"valikoiva uudelleenlahetys selective repeat permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Toinen vaihtoehto katoavien pakettien uudelleenlähetyksiin on lähettää vain kadonnut paketti uudelleen. Näin katoamistapauksessa lähetetään vähemmän paketteja, mutta pakettien ja niiden kuittausten hallinta on monimutkaisempaa kuin tuossa Paluu-N:ään vaihtoehdossa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lähettäjä lähettää yhden paketin uudelleen aina, kun kyseiseen pakettiin liittyvä ajastin laukeaa. Tällöin joko paketti on kadonnut tai kuittaus on kadonnut. Ajastin on protokollissa ainoa tapa, jolla lähettäjä voi havaita, että paketti täytyy lähettää uudelleen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun käytetään valikoivaa kuittausta, niin lähettäjän saama kuittausviesti kuittaa aina vain kyseisen paketin. Vastaanottajan on siis kuitattava jokainen yksittäinen saapunut paketti silloinkin, kun se saapuu väärässä järjestyksessä. Vastaanottajan täytyy siis kuitata aina kaikki saapuvat paketit, myös sellaiset, jotka se on jo saanut aiemmin. Niiden kohdalla vastaanottaja olettaa kuittauksen kadonneen, joten sen täytyy lähettää kuittaus, vaikka se on sellaisen jo lähettänyt aiemmin."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Valikoivassa uudelleenlähetyksessa vastaanottajan on välttämätöntä puskuroida kaikki saapuvat paketit, koska lähettäjä ei välttämättä lähetä niitä enää uudelleen. Paluu-N:än kanssa puskurointi on vapaaehtoinen lisäpiirre, mutta tässä vaihtoehdossa siis pakollinen toiminnallisuus."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Puskurista muodostuu vastaanottajalle oma 'liukuvan ikkunan' näkymä saapuvien viestien jonoon. Vastaanottajan ikkunan reunassa on aina ensimmäinen puuttuva viesti. Ikkunassa voi pidemmällä olla jo saapuneita ja kuitattuja viestejä odottamassa tuon ensimmäisen viestin saapumista. Kun sitten ikkunan reunassa oleva odotettu viesti saapuu, niin ikkuna pääsee liikkumaan. Vastaanottajaa antaa saapuneita viestejä ikkunan reunasta sovelluskerrokselle ja ikkuna liikkuu kaikkien annettujen viestien ohi. Se pysähtyy taas, kun ikkunan reunassa on sellainen paketti, joka ei ole vielä saapunut. Huomaa, että tämä on enemmänkin meille ihmisille sopiva havainnollistamiskeino. Vastaanottajalla viestien puskurointi voi lisäksi vaikeuttaa se, että se ei etukäteen välttämättä tiedä, minkä kokoisia saapuvat paketit ovat. Se voi toimia vain jo saapuneen tiedon varassa. Numeroinnin avulla se havaitsee, että paketteja puuttuu."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lähettäjän toiminnallisuus:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Viesti sovelluskerrokselta: Oletaan, että lähetyspuskuriin mahtuu jonottamaan äärettömän monta viestiä. Jos ikkunassa on tilaa, niin viesti saa järjestysnumeron ja se lähetetään vastaanottajalle. Jos ikkuna on täynnä, niin viesti jää lähetyspuskuriin odottamaan lähetysikkunaan pääsyä."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Ajastin laukeaa: Jokaisella viestillä on oma aikaraja ja ne tarvitsevat oman ajastimen. Ajastimen lauetessa vain kyseinen viesti lähetetään uudelleen. (Huom: jos laitteisto tulee vain yhtä ajastinta laitetasolla, niin sen avulla on kuitenkin mahdollista toteuttaa useita loogisia ajastimia ohjelmallisesti)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Kuittausviesti saapuu: Kun kuittausviesti saapuu, kyseinen viesti merkitään kuitatuksi. Jos tämä on ikkunan reunimmainen, vanhin, viesti, niin siirrä ikkunaa eteenpäin  niin paljon, että ikkunan reunassa on taas ensimmäinen kuittaamaton viesti. Jos ikkunaan mahtuu ja jos lähetysjonossa on lähetettävää, niin lähetä ne yksitellen, kunnes ikkuna on täynnä tai ei enää lähetettävää."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vastaanottajan toiminnallisuus:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Huomaa, että vastaanottajan omassa ikkunassa on reunimmaisena pienin järjestysnumero, jonka saapumista vielä odotetaan. Merkitään tätä nimellä vastaanottaja-odottaa"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Saapuu viesti, jonka järjestysnumero on vastaanottajan ikkunassa eli suurempi tai yhtäsuuri kuin vastaanottaja-odottaa: Kuittaa viesti. Jos viesti oli ikkunan reunassa (eli juuri vastaanottaja-odottaa), niin siirrä vastaanottajan omaa ikkunaa ensimmäiseen puuttuvaan viestiin.  Toimita ikkunasta näin poistuvat viestit sovelluskerrokselle."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Saapuu viesti, jonka järjestysnumero ei enää ole vastaaottajan ikkunassa, eli sen järjestynumero on pienempi kuin vastaanottaja-odottaa: Lähetä kuittaus. Itse viesti on jo käsitelty ja kuitattu aiemmin, mutta lähettäjä ei ilmeisesti tiedä sitä."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"img","properties":{"src":"/cb285cfc8d8d4c67397c26a6155d0a5b/valikoiva-toisto.svg","alt":"Kuvassa lähettäjän ja vastaanottajan välinen viestintä, sekä molempien ikkunat. Kuvassa on valikoivan uudelleen lähetyksen toiminta tilanteessa, jossa ikkunan koko on 4 ja viesteistä katoaa järjestysnumerolla 2 varustettu viesti. V: ikkunan reunassa 0; L:-v0 (ikk. 0); L:-v1 (ikk. 0,1); V:+v0,-ack0 (ikk. reuna 1); L-v2 (katoaa) (ikk 0,1,2); L:-v3 (ikk 0,1,2,3 - täynnä); V:+v1,-ack1 (ikk. reuna 2); L:+ack0,-v4 (ikk 1,2,3,4); V:+v3;-ack3 (ikk. od.2, on 3); L: +ack1, -v5 (ikk 2,3,4,5); V: +v4,-ack4 (ikk od2, on 3,4); L:+ack3 (merkitse), (ikk 2,3,4,5); L:+ack4 (merkitse) (ikk 2,3,4,5); V:+5,-ack5 (ikk od 2, on 3,4,5); L: Ajastin (viesti2) -v2; L:+ack5 (merkitse), ikk(2,3,4,5); V:+v2, ack2 (ikkuna siirtyy, uusi ikk.reuna 6); L:+ack2, -v6 (ikk 6); L:-v7 (ikk 6,7,); ..."},"children":[]},{"type":"text","value":"\nKUVA: Kuvassa on valikoivan uudelleen lähetyksen toiminta tilanteessa, jossa ikkunan koko on 4 ja viesteistä katoaa järjestysnumerolla 2 varustettu viesti."},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"6f276783-1e98-5fd7-8df2-a08042d7442e"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tagName":"h2","properties":{"id":"viestien-numeroinnista","style":"position:relative;"},"children":[{"type":"text","value":"Viestien numeroinnista"},{"type":"element","tagName":"a","properties":{"href":"#viestien-numeroinnista","ariaLabel":"viestien numeroinnista permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Liukuvan ikkunan protokollassa viestit täytyy numeroida siten, että tiedämme viestien järjestyksen ja kaksi viestiä ei voi koskaan mennä sekaisin. Kuten vuorottelevan bitin protokollasta huomasimme, tämän erottelun voi tehdä jopa vain yhdellä bitillä. Tietoliikenneprotokollien kanssa meillä on aina käytettävissä vain äärellinen numeroavaruus, koska yleensä protokollien otsakkeessa on varattu kiinteän kokoinen kenttä viestin numerolle. Jos kentän pituus on n bittiä, niin voimme erotella toisistaan 2"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"n"}]},{"type":"text","value":" viestiä, joiden numerot ovat 0,1,2,3,... 2"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"n"}]},{"type":"text","value":"-1."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oletetaan esimerkiksi tilanne, jossa meillä on 4 erilaista numeroa eli 0,1,2 ja 3. Mikä voi silloin olla ikkunan maksimikoko, jotta emme voi sekoittaa viestejä? Missään tapauksessa se ei voi olla suurempi kuin 4, mutta voiko se olla edes 4? Jos ikkunan koko olisi suurempi kuin käytettävissä oleva numeroavaruus, niin ikkunassa olisi sama numero useampaan kertaan eikä lähettäjällä tai vastaanottajalla olisi keinoa erottaa näitä kahta viestiä toisistaan. Tarvittaessa piirrä itsellesi kuva ikkunasta tällaisella tilanteessa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Itse asiassa pakettien numerointi, ikkunan koko ja protokollan yksityiskohtainen toiminta liittyvät läheisesti toisiinsa. Jos käytämme kadonneen paketin kohdalla toipumiseen Paluu-N:ään, niin silloin riittää, että ikkunassa olevat paketit voidaan erotella toisistaan ja juuri ikkunasta poistuneesta viestistä (jota vielä käytetään kuittausnumerona), koska lähettäjä lähettää aina kadonneen viestin lisäksi kaikki sitä seuraavat viestit uudelleen. Näin eri 'kierrosten' pakettinumerot eivät voi sekaantua toisiinsa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Valikoivan toiston kanssa sekaantumisen vaara on merkittävä, jos meillä ei ole riittävää turvamarginaalia ikkunan ympärillä. Valikoivan toiston kanssa itse asiassa suurin sallittu ikkunankoko on korkeintaan puolet käytettävästä numeroavaruudesta. Tämä johtuu siitä, että toisaalta lähettäjä lähettää vain yksittäisiä puuttuviksi olettamiaan viestejä ja toisaalta vastaanottaja puskuroi aiemmin saapuneita viestejä. Nyt on mahdollista, että vastaanottaja on saanut viestin jo aiemmin, mutta kuittaus katosi. Tällöin lähettäjän pitää lähettää kyseinen viesti uudelleen. Jos nyt vastaanottajan ikkuna on liikahtanut eteenpäin, niin ilman tuota turvamarginaalia olisi mahdollista, että vastaanottaja olettaisi saapuvan viestin kuuluvan jo seuraavaan sarjaan.  Tarvittaessa piirrä itsellesi tapahtumakuvaus, jossa tällainen sekaantuminen pääsee tapahtumaan, kun ikkunan koko vastaa numerointia. Piirrä sen jälkeen vastaava tapahtumasarja tilanteessa, jossa ikkunan koko on puolet numeroavaruudesta ja vakuuta itsesi, miksi tässä tilanteessa ei vastaavaa voi tapahtua."}]}]},"html":"<div><text-box variant='learningObjectives' name='Oppimistavoitteet'><ul>\n<li>Osaat yleisellä tasolla kuvata liukuvan ikkunan periaatteen.</li>\n<li>Osaat perustella miksi liukuvan ikkunan käyttäminen tiedon siirrossa nopeuttaa sitä yksinkertaiseen pysähdy-ja-odota -malliin verrattuna.</li>\n<li>Osaat kuvata miten liukuvan ikkunan kanssa voidaan toipua viestien katoamisesta.</li>\n</ul></text-box><h2 id=\"viestien-liukuhihnoitus\" style=\"position:relative;\">Viestien liukuhihnoitus<a href=\"#viestien-liukuhihnoitus\" aria-label=\"viestien liukuhihnoitus permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Edellä käytiin läpi luotettavan kuljetuspalvelun teoriaa äärellisten tila-automaattien avulla. Saimme niillä kuvattua hyvin yksinkertaisen järjestelmän, jossa lähettäjä lähettää yhden viestin ja pysähtyy odottamaan kuittausta tähän viestiin. Tällainen pysähdy-ja-odota (engl. stop-and-wait) -protokolla on liian hidas todelliseen käyttöön, koska lähettäjän ja vastaanottajan välisen tiedonsiirron keston ajan lähettäjä vain odottaa. Tämän odotuksen kesto on noin kaksi kertaa yhdensuuntaisen paketin siirron kesto, koska sanoma kulkee lähettäjältä vastaanottajalle ja sitten kuittaus kulkee takaisinpäin. Tätä aikaa, joka viestin lähetyksessä kuluu viestin kulkuun edestakaisin, kutsutaan <strong>kiertoviiveeksi</strong> (engl. roundtrip time, RTT).</p><p>Yksinkertaisessa järjestelmässä, kuten vuorottelevan bitin protokolla, lähettäjä pysähtyy jokaisen paketin jälkeen odottamaan vastausta. Jolloin kahden peräkkäisen viestin välissä kuluu noin yhden kiertoviiveen verran aikaa. Tiedonsiirtoa voidaan nopeuttaa vain, jos saamme kahden peräkkäisen viestin lähettämisten välistä aikaa lyhyemmäksi. Kun kurssin alussa tarkastelimme viipeitä, niin havaitsimme, että lähetettävän datan pilkkominen pienempiin osiin nopeuttaa sen kulkemista verkossa, jos voimme lähettää kaikki palaset liikkeelle peräkkäin. Tarvitaan siis monimutkaisempi toteutus kuin yksinkertainen pysähdy-ja-odota. Toki voisimme yhden viestin sijaan lähettää vaikkapa 10 viestiä ja sitten odottaa niille kaikille vastaukset ennen seuraavan purskeen lähettämistä. Tällä saadaan jo viestintää nopeutettua,kun yhtä kierrosta kohti lähetetään enemmän dataa. Mallinnuksen ja algoritmien kannalta kyseessä on kuitenkin edelleen pysähdy-ja-odota -tyyppinen käyttäytyminen, koska lähettäjä odottaa vastausviestin kaikkiin lähetettyihin viesteihin, ennen kuin se lähettää lisää viestejä.</p><p>Jos viestien lähettäminen liukuhihnoitetaan (engl. pipeline) siten, että lähettäjällä voi olla N kappaletta viestejä odottamassa kuittausta ja lähettäjä voi aina lähettää yhden uuden viestin, kun se saa kuittauksen vanhimpaan lähetettyyn viestiin, niin päästään käyttämään liukuvan ikkunan mallia. Ikkuna kattaa täsmälleen ne viestit, jotka on lähetetty, mutta joille ei vielä ole saapunut kuittausta. Kun kuittaus saapuu, niin ikkuna siirtyy ja lähettäjä pääsee lähettämään uuden viestin. Tässä on tärkeää huomata, että järjestyksessä ensimmäinen (pienin numero, vanhin lähetetty) kuittaamaton viesti on aina ikkunan reunassa. Jo kuitatut viestit eivät siis enää ole ikkunassa, koska niistä lähettäjä tietää, että vastaanottaja on ne varmasti saanut.</p><img src=\"/17584d1978fe64a1042f9a91691bc688/3-3-ikkuna1.svg\" alt=\"Lähetettävä data, joka on siis kolmessa ryhmässä. 1) Jo lähetetyt ja kuitatut viestin, 2) lähetetty, mutta ei vielä kuitatut ja 3) lähettämättömät viestit. Näistä tuo ryhmä 2 on se, joka on ikkunassa.\">\nKUVA: Lähetettävä data, joka on siis kolmessa ryhmässä. 1) Jo lähetetyt ja kuitatut viestin, 2) lähetetyt, mutta ei vielä kuitatut ja 3) lähettämättömät viestit. Näistä ryhmä 2 on se, joka on ikkunassa.<p>Liukuvan ikkunan (engl. sliding window) mallissa tavoitteena on, että lähettäjän ja vastaanottajan välillä on koko ajan liikkeellä viestejä ja kuittauksia siten, että lähettäjän ei tarvitsisi koskaan erikseen pysähtyä odottamaan kuittauksia. Luotettavan kuljetuspalvelun toteutus edellytti, että viestit menevät perille ja että ne menevät perille oikeassa järjestyksessä. </p><p>Nyt kun matkalla on useita viestejä, on tärkeää numeroida viestit siten, että vastaanottaja voi tarvittaessa järjestää saapuvat viestit oikeaan järjestykseen. Vastaanottajan pitää siis voida havaita, jos joku viesti puuttuu välistä. Numeroimme viestejä äsken tuossa vuorottelevan bitin protokollassa, mutta meillä oli käytössä vain numerot 0 ja 1. </p><p>Protokollien kanssa meillä on käytössä vain äärellinen määrä numeroita, joita sitten kierrätetään. Tässä on taustalla kaksi erilaista seikkaa jotka tähän johtavat. Protokollan toiminnan analyysissä äärellinen määrä tiloja on toivottavaa ja se johtaa äärelliseen numeroavaruuteen. Toinen ihan yhtä merkittävä seikka on se, että viestin numero on tyypillisesti osa otsaketietoja ja otsakkeessa selle voidaan varata vain äärellinen tila, mikä rajoittaa käytettävää numeroavaruutta. </p><p>Esimerkiksi, kun meillä on käytettävissä vain kolmen bitin mittainen alue numerolle, niin voimme käyttää vain numeroita 0,1,..7 (eli meillä on 8 erilaista numeroa). Kun juuri lähetetyn viestin numero oli 7, niin seuraavan viestin numero on 0. Matemaattisesti käytämme siis <a href=\"https://fi.wikipedia.org/wiki/Modulaarinen_aritmetiikka\" target=\"_blank\" rel=\"noopener noreferrer\">modulaariaritmetiikkaa</a> eli luvun 8 jakojäännöksiä. Tätä merkitään usein mod 8.</p><h2 id=\"liukuvan-ikkunan-toimintaperiaate\" style=\"position:relative;\">Liukuvan ikkunan toimintaperiaate<a href=\"#liukuvan-ikkunan-toimintaperiaate\" aria-label=\"liukuvan ikkunan toimintaperiaate permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Ikkunan koko määrää sen, kuinka monta kuittaamatonta viestiä voi olla yhtä aikaa matkalla lähettäjältä vastaanottajalle. Lähettäjän ei ole pakko lähettää niitä kaikkia, mutta enempää se ei saa lähettää.</p><p>Ikkunan ulkopuolella voi jonossa olla lähetysvuoroa odottavia viestejä. Näitä ei ole vieä lähetetty, joten ne vasta odottavat lähetysvuoroa. Lähettäjä ottaa niitä järjestyksessä käsittelyyn sitä mukaan, kun lähetysikkunaan mahtuu. Tätä kuvataan myös ikkunan siirtymisellä näiden viestien kohdalle.</p><p>Ikkunasta jo poistuneista viesteistä ei olla enää kiinnostuneita, koska ne kuljetuspalvelu on saanut onnistuneesti siirrettyä lähettäjältä vastaanottajalle.</p><p>Kiinnostavin viesti on ikkunasta seuraavaksi poistuva viesti. Se on siis ikkunan reunassa ja sen lähettämisestä on kulunut pisin aika. Sitä ei ole vielä kuitattu, joten lähettäjällä ei ole tietoa, onko vastaanottaja saanut sen. Vasta kun kuittaus saapuu lähettäjälle voi kuljetuspalvelu olla varma siitä, että kyseinen viesti on onnistuneesti toimitettu perille ja vasta silloin ikkuna voi liikkua sen ohi.</p><p>Yksinkertaisella äärellisellä tila-automaatilla emme voi enää mallintaa liukuvan ikkunan -algoritmin toimintaa, koska tarvitsisimme juoksevan numeroinnin viesteille ja yksinkertaiset automaatit eivät osaa parametrisoituja viestejä. Siksi äskeisessä vuorottelevan bitin mallissakin meillä oli kaksi eri viestiä m0 ja m1. Sellaisen automaatin laatiminen, jossa olisi paljon enemmän viestejä ja paljon enemmän tiloja, on toki mahdollista, mutta ei ole enää mielekästä.  Vuorottelevan bitin mallia voidaan pitää yksinkertaisimpana mahdollisena liukuvan ikkunan järjestelmänä. Siinä ikkunan koko on yksi eli ikkuna on juuri sen viestin kohdalla, joka on lähetetty ja jonka kuittausta odotetaan saapuvaksi. Viestit on myös numeroitu moduloaritmetiikan mukaisesti numeroilla 0 ja 1 (mod 2), ja ne muodostavat ketjun 0,1,0,1,0,1,0,1, jne.</p><h2 id=\"viestin-katoamisesta-toipuminen\" style=\"position:relative;\">Viestin katoamisesta toipuminen<a href=\"#viestin-katoamisesta-toipuminen\" aria-label=\"viestin katoamisesta toipuminen permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Luotettavan kuljetuspalvelun ongelma on se, että sen käyttämä kanava on epäluotettava ja voi siis kadottaa viestejä, järjestää viestejä, vaurioittaa viestejä ja jopa monistaa yksittäisen viestin. Kuljetuspalvelun pitää selvitä näistä kaikista ongelmista.</p><p>Monistunut viesti on helppo, se pitää vain tunnistaa ja myöhemmin saapunut kopio jättää huomioimatta. Vastaanottajan pitää huomata viestien järjestyksen vaihtuminen. Kuljetuspalvelun vastaanottopään pitää antaa viestit eteenpäin oikeassa (lähetys)järjestyksessä, ei siis saapumisjärjestyksessä. Jos vastaanottajalla ei ole puskuria tallentaa väärässä välissä 'liian aikaisin' saapuneita viestejä, niin se joutuu ne kadottamaan, jolloin päädytäänkin kadonneen viestin ongelmaan. Vaurioitunut viesti voidaan käsitellä kadonneena viestinä, koska sisällön oikeellisuuteen ei enää voi luottaa. Kadonneen viestin osalta toipuminen edellyttää aina viestin uudelleenlähetystä.</p><p>Lähettäjähän voi havaita kadonneen viestin vain siitä, että siihen liittyvää kuittausviestiä ei tule. Tähän käytetään yleensä ajastinta, jolloin kuittausviestiä odotetaan vain tietty aika, tyypillisesti noin kaksi kertaa kiertoviiveen arvioitu kesto. </p><p>Ajastimen laukeamisen jälkeen lähettäjä lähettää tämän kadonneeksi toteamansa viestin uudelleen. Mutta mitä pitäisi tehdä muille ikkunassa oleville jo lähetetyille viesteille? Lähettää nekin uudelleen, vai olettaa, että ne olisivat päässet perille ja vastaanottajalla on riittävä puskuri niiden säilyttämiseen odottamassa toimitusvuoroaan? Tähän ei ole yhtä ja ainoaa oikeaa vastausta.</p><p>Liukuvan ikkunan protokollassa uudelleenlähetys voidaan toteuttaa joko valikoivana uudelleenlähetyksenä (engl. selective repeat) tai koko ikkunan uudelleenlähetyksenä. Tätä koko ikkunan uudelleenlähetystä kutsutaan usein nimellä Paluu-N:ään (engl. Go-Back-N), koska ajatellaan, että meillä on lähetyskohdan ilmaiseva osoitin, joka siirretään, eli palautetaan, taaksepäin tuohon kohtaan N, josta lähettämistä jatketaan.</p><p>Menetelmän valinta voi riippua esimerkiksi siitä, kuinka iso ikkuna on, onko vastaanottajalla puskuria vai ei, tai siitä kuinka suuri kiertoviive on. Valinnassa pyritään aina löytämään optimiratkaisu eri seikkojen suhteen. Myös tietoliikenteen maksuperuste saattaa vaikuttaa asiaan. Jos jokaisesta siirretystä tavusta maksetaan, niin silloin kannattaa pitää siirrettävän tiedon määrä mahdollisimman pienenä. Jos maksetaan siirtoajasta, niin silloin sitä pitäisi yrittää minimoida. Lähettäjällä ja vastaanottajalla voi olla erilainen kustannus. Kiinteä maksu, joka ei ole suoraan sidottu siirrettävään datamäärään tai yhteyden kestoon, ei vaikuta uudelleenlähetysten kustannuksiin, jolloin liikennöintikustannusta ei tarvitse ottaa huomioon. Koska kiinteät kuukausimaksut ovat nykyisin hyvin tyypillinen tapa, niin jatkossa tietoliikenteen kustannuksia ei käytetä valintaperusteena. On kuitenkin hyvä muistaa, että tietyissä erikoistilanteissa silläkin voi olla merkitystä.</p><h3 id=\"paluu-naan-go-back-n\" style=\"position:relative;\">Paluu-N:ään (Go-Back-N)<a href=\"#paluu-naan-go-back-n\" aria-label=\"paluu naan go back n permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Paluu-N:ään on toiminnallisesti hyvin yksinkertainen. Kun vanhimpaan viestiin liittyvää kuittausta ei tule ajoissa, ajastin laukeaa ja lähettäjä lähettää kaikki ikkunassa olevat viestit uudelleen. Vastaanottaja lähettää kuittausviestin jokaisesta saapuvasta paketista, mutta kuitattavan viestin numero voi olla eri kuin saapuneen viestin numero.</p><p>Jokainen kuittaus kertoo lähettäjälle, että vastaanottaja on saanut kyseisen paketin lisäksi kaikki sitä edeltävät paketit. Tätä kutsutaan kumulatiiviseksi kuittaukseksi (engl. cumulative acknowledgement). Näin yksittäinen katoava kuittausviesti ei pääse aiheuttamaan massiivista uudelleenlähetystä. Huomaa, että kumulatiivisessa kuittauksessa yksi saapuva kuittaus voi kuitata useita paketteja. Tämän vuoksi vastaanottaja ei aina voi kuitata saapuvaa pakettia paketin omalla kuittausnumerolla vaan joutuu käyttämään viimeisimmän yhtenäisessä ketjussa aiemmin saapuneen paketin kuittausnumeroa.</p><p>Lähettäjän toiminnallisuus = tapahtumat, joihin pitää reagoida</p><ul>\n<li>Viesti sovelluskerrokselta: Oletetaan, että meillä on ääretön puskuri, joten viesti lisätään lähetysjonoon. Tarkista, onko ikkuna täynnä (eli onko jo N kuittaamatonta viestiä). Jos ikkuna ei ole vielä täynnä, lähetä viesti vastaanottajalle. Jos ikkuna on täynnä, viestiä ei voi vielä lähettää.</li>\n<li>Kuittausviesti saapuu: Jos kuittaa jo aiemmin kuitattuja viestejä, niin älä tee mitään. Jos kuittaa uusia kuittaamattomia viestejä, niin siirrä ikkunan reuna ensimmäiseen kuittaamattomaan. Jos lähetysjonossa on lähetettävää, niin lähetä ne yksitellen, kunnes ikkuna on täynnä tai ei enää lähetettävää.</li>\n<li>Ajastin laukeaa: Oletetaan, että ajastimen laukeaminen liittyy aina ikkunan vanhimpaan viestiin, joten lähetä ikkunan sisältö eli kaikki aiemmin lähetetyt kuittaamattomat viestit uudelleen.</li>\n</ul><p>Vastaanottajan toiminnallisuus = tapahtumat, joihin pitää reagoida</p><ul>\n<li>Vastaanottaja odottaa seuraavaksi viestiä, jonka järjestysnumero on N+1, koska se on jo toimittanut sovelluskerrokselle ja kuitannut kaikki viestit järjestysnumeroon N asti.</li>\n<li>Saapuu viesti, jonka järjestysnumero on oikein eli N+1: Lähetä kuittaus N+1 ja toimita viesti sovelluskerrokselle. (Kasvata odotettavan viestin järjestysnumeroa yhdellä.)</li>\n<li>Saapuu viesti, jonka järjestysnumero on väärin eli ei ole N+1: Lähetä kuittaus N. Viestin voi kadottaa.</li>\n</ul><p>Vastaanottajan on tärkeä kuitata kaikki saapuvat viestit, vaikka niillä olisi 'väärä järjestysnumero'. Tämä on tärkeää, koska vastaanottaja ei voi olla varma omien aiempien kuittaustensa perillemenosta. Näiden kuittausten tavoitteena on varmistaa, että lähettäjä saisi tiedon siitä, mihin asti vastaanottajalla on katkeamaton ketju jo toimitettuja viestejä.</p><p>Miksi vastaanottaja voi kadottaa väärässä järjestyksessä saapuvan viestin? Se voi luottaa siihen, että lähettäjä kuitenkin lähettää viestin uudelleen, jos ja kun edeltävä viesti on kadonnut. Näin sen ei tarvitse tallettaa puskuriin liian aikaisin saapuneita paketteja ja vastaanottajan toiminta on paljon yksinkertaisempaa. Se pitää tallessa vain tietoa siitä, mikä on seuraavaksi odotetun oikean paketin järjestysnumero. Toki on mahdollista, että vastaanottaja puskuroi paketteja, mutta silloin oikean paketin saavuttua sen pitää tutkia puskuria ja selvittää, kuinka monta pakettia se voi toimittaa sovelluskerrokselle puskurista. Kuittausviestissä menevä järjestysnumero muuttuu sitten tämän tiedon mukaisesti.</p><img src=\"/9de82e18cc54b5487d45d7b4b1cac6de/go-back-n.svg\" alt=\"Kuvassa lähettäjän ja vastaanottajan välinen viestintä. Kuvassa on aikajanalla Paluu-N:ään toiminta, kun ikkunan koko on 4 ja paketti 2 katoaa. Kuvaan on piirretty se mitkä viestit kulloinkin ovat ikkunassa ja mitä viestejä lähettäjään ja vastaanottajan välillä kulkee. Viestit on numeroitu 0:sta alkaen.  Lähettäjä(jatkossa vain L): -viesti0 (ikkunassa 0); L: -viesti1 (ikk. 0,1); Vastaanottaja (jatkossa vain V):+viesti0,-ack0; L:-viesti2 (Tämä katoaa!) (ikkuna 0,1,2); L: -viesti3 (ikkkuna 0,1,2,3); V: +viesti1,-ack1; L:+ack0, -viesti4 (ikkuna 1,2,3,4); L:+ack1,-viesti5 (ikkuna 2,3,4,5); V:+viesti3, ack1 (odotti 2:sta, joten siksi kuittaus ack1); V:+viesti4,ack1; L:+ack1 (on tullut jo, joten ei tee muuta); L:+ack1; V:+viesti5, ack1; L: Ajastin laukeaa, -viesti2; L:-viesti3; L:+ack1; V:+viesti2,-ack2; L:-viesti4; L:-viesti5; L:+ack2,-viesti6 (ikkuna 3,4,5,6); ...\">\nKUVA: Kuvassa on aikajanalla Paluu-N:ään toiminta, kun ikkunan koko on 4 ja paketti 2 katoaa. Kuvaan on piirretty se, mitkä viestit kulloinkin ovat ikkunassa ja mitä viestejä lähettäjän ja vastaanottajan välillä kulkee. Viestit on numeroitu 0:sta alkaen.<div><quiz id=\"ffa8911b-7006-5b1c-9cbe-500bbfa4bf47\">  </quiz></div><h3 id=\"valikoiva-uudelleenlahetys-selective-repeat\" style=\"position:relative;\">Valikoiva uudelleenlähetys (selective repeat)<a href=\"#valikoiva-uudelleenlahetys-selective-repeat\" aria-label=\"valikoiva uudelleenlahetys selective repeat permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Toinen vaihtoehto katoavien pakettien uudelleenlähetyksiin on lähettää vain kadonnut paketti uudelleen. Näin katoamistapauksessa lähetetään vähemmän paketteja, mutta pakettien ja niiden kuittausten hallinta on monimutkaisempaa kuin tuossa Paluu-N:ään vaihtoehdossa.</p><p>Lähettäjä lähettää yhden paketin uudelleen aina, kun kyseiseen pakettiin liittyvä ajastin laukeaa. Tällöin joko paketti on kadonnut tai kuittaus on kadonnut. Ajastin on protokollissa ainoa tapa, jolla lähettäjä voi havaita, että paketti täytyy lähettää uudelleen.</p><p>Kun käytetään valikoivaa kuittausta, niin lähettäjän saama kuittausviesti kuittaa aina vain kyseisen paketin. Vastaanottajan on siis kuitattava jokainen yksittäinen saapunut paketti silloinkin, kun se saapuu väärässä järjestyksessä. Vastaanottajan täytyy siis kuitata aina kaikki saapuvat paketit, myös sellaiset, jotka se on jo saanut aiemmin. Niiden kohdalla vastaanottaja olettaa kuittauksen kadonneen, joten sen täytyy lähettää kuittaus, vaikka se on sellaisen jo lähettänyt aiemmin.</p><p>Valikoivassa uudelleenlähetyksessa vastaanottajan on välttämätöntä puskuroida kaikki saapuvat paketit, koska lähettäjä ei välttämättä lähetä niitä enää uudelleen. Paluu-N:än kanssa puskurointi on vapaaehtoinen lisäpiirre, mutta tässä vaihtoehdossa siis pakollinen toiminnallisuus.</p><p>Puskurista muodostuu vastaanottajalle oma 'liukuvan ikkunan' näkymä saapuvien viestien jonoon. Vastaanottajan ikkunan reunassa on aina ensimmäinen puuttuva viesti. Ikkunassa voi pidemmällä olla jo saapuneita ja kuitattuja viestejä odottamassa tuon ensimmäisen viestin saapumista. Kun sitten ikkunan reunassa oleva odotettu viesti saapuu, niin ikkuna pääsee liikkumaan. Vastaanottajaa antaa saapuneita viestejä ikkunan reunasta sovelluskerrokselle ja ikkuna liikkuu kaikkien annettujen viestien ohi. Se pysähtyy taas, kun ikkunan reunassa on sellainen paketti, joka ei ole vielä saapunut. Huomaa, että tämä on enemmänkin meille ihmisille sopiva havainnollistamiskeino. Vastaanottajalla viestien puskurointi voi lisäksi vaikeuttaa se, että se ei etukäteen välttämättä tiedä, minkä kokoisia saapuvat paketit ovat. Se voi toimia vain jo saapuneen tiedon varassa. Numeroinnin avulla se havaitsee, että paketteja puuttuu.</p><p>Lähettäjän toiminnallisuus:</p><ul>\n<li>Viesti sovelluskerrokselta: Oletaan, että lähetyspuskuriin mahtuu jonottamaan äärettömän monta viestiä. Jos ikkunassa on tilaa, niin viesti saa järjestysnumeron ja se lähetetään vastaanottajalle. Jos ikkuna on täynnä, niin viesti jää lähetyspuskuriin odottamaan lähetysikkunaan pääsyä.</li>\n<li>Ajastin laukeaa: Jokaisella viestillä on oma aikaraja ja ne tarvitsevat oman ajastimen. Ajastimen lauetessa vain kyseinen viesti lähetetään uudelleen. (Huom: jos laitteisto tulee vain yhtä ajastinta laitetasolla, niin sen avulla on kuitenkin mahdollista toteuttaa useita loogisia ajastimia ohjelmallisesti)</li>\n<li>Kuittausviesti saapuu: Kun kuittausviesti saapuu, kyseinen viesti merkitään kuitatuksi. Jos tämä on ikkunan reunimmainen, vanhin, viesti, niin siirrä ikkunaa eteenpäin  niin paljon, että ikkunan reunassa on taas ensimmäinen kuittaamaton viesti. Jos ikkunaan mahtuu ja jos lähetysjonossa on lähetettävää, niin lähetä ne yksitellen, kunnes ikkuna on täynnä tai ei enää lähetettävää.</li>\n</ul><p>Vastaanottajan toiminnallisuus:</p><ul>\n<li>Huomaa, että vastaanottajan omassa ikkunassa on reunimmaisena pienin järjestysnumero, jonka saapumista vielä odotetaan. Merkitään tätä nimellä vastaanottaja-odottaa</li>\n<li>Saapuu viesti, jonka järjestysnumero on vastaanottajan ikkunassa eli suurempi tai yhtäsuuri kuin vastaanottaja-odottaa: Kuittaa viesti. Jos viesti oli ikkunan reunassa (eli juuri vastaanottaja-odottaa), niin siirrä vastaanottajan omaa ikkunaa ensimmäiseen puuttuvaan viestiin.  Toimita ikkunasta näin poistuvat viestit sovelluskerrokselle.</li>\n<li>Saapuu viesti, jonka järjestysnumero ei enää ole vastaaottajan ikkunassa, eli sen järjestynumero on pienempi kuin vastaanottaja-odottaa: Lähetä kuittaus. Itse viesti on jo käsitelty ja kuitattu aiemmin, mutta lähettäjä ei ilmeisesti tiedä sitä.</li>\n</ul><img src=\"/cb285cfc8d8d4c67397c26a6155d0a5b/valikoiva-toisto.svg\" alt=\"Kuvassa lähettäjän ja vastaanottajan välinen viestintä, sekä molempien ikkunat. Kuvassa on valikoivan uudelleen lähetyksen toiminta tilanteessa, jossa ikkunan koko on 4 ja viesteistä katoaa järjestysnumerolla 2 varustettu viesti. V: ikkunan reunassa 0; L:-v0 (ikk. 0); L:-v1 (ikk. 0,1); V:+v0,-ack0 (ikk. reuna 1); L-v2 (katoaa) (ikk 0,1,2); L:-v3 (ikk 0,1,2,3 - täynnä); V:+v1,-ack1 (ikk. reuna 2); L:+ack0,-v4 (ikk 1,2,3,4); V:+v3;-ack3 (ikk. od.2, on 3); L: +ack1, -v5 (ikk 2,3,4,5); V: +v4,-ack4 (ikk od2, on 3,4); L:+ack3 (merkitse), (ikk 2,3,4,5); L:+ack4 (merkitse) (ikk 2,3,4,5); V:+5,-ack5 (ikk od 2, on 3,4,5); L: Ajastin (viesti2) -v2; L:+ack5 (merkitse), ikk(2,3,4,5); V:+v2, ack2 (ikkuna siirtyy, uusi ikk.reuna 6); L:+ack2, -v6 (ikk 6); L:-v7 (ikk 6,7,); ...\">\nKUVA: Kuvassa on valikoivan uudelleen lähetyksen toiminta tilanteessa, jossa ikkunan koko on 4 ja viesteistä katoaa järjestysnumerolla 2 varustettu viesti.<div><quiz id=\"6f276783-1e98-5fd7-8df2-a08042d7442e\"> </quiz></div><h2 id=\"viestien-numeroinnista\" style=\"position:relative;\">Viestien numeroinnista<a href=\"#viestien-numeroinnista\" aria-label=\"viestien numeroinnista permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><div>Liukuvan ikkunan protokollassa viestit täytyy numeroida siten, että tiedämme viestien järjestyksen ja kaksi viestiä ei voi koskaan mennä sekaisin. Kuten vuorottelevan bitin protokollasta huomasimme, tämän erottelun voi tehdä jopa vain yhdellä bitillä. Tietoliikenneprotokollien kanssa meillä on aina käytettävissä vain äärellinen numeroavaruus, koska yleensä protokollien otsakkeessa on varattu kiinteän kokoinen kenttä viestin numerolle. Jos kentän pituus on n bittiä, niin voimme erotella toisistaan 2<sup>n</sup> viestiä, joiden numerot ovat 0,1,2,3,... 2<sup>n</sup>-1.</div><p>Oletetaan esimerkiksi tilanne, jossa meillä on 4 erilaista numeroa eli 0,1,2 ja 3. Mikä voi silloin olla ikkunan maksimikoko, jotta emme voi sekoittaa viestejä? Missään tapauksessa se ei voi olla suurempi kuin 4, mutta voiko se olla edes 4? Jos ikkunan koko olisi suurempi kuin käytettävissä oleva numeroavaruus, niin ikkunassa olisi sama numero useampaan kertaan eikä lähettäjällä tai vastaanottajalla olisi keinoa erottaa näitä kahta viestiä toisistaan. Tarvittaessa piirrä itsellesi kuva ikkunasta tällaisella tilanteessa.</p><p>Itse asiassa pakettien numerointi, ikkunan koko ja protokollan yksityiskohtainen toiminta liittyvät läheisesti toisiinsa. Jos käytämme kadonneen paketin kohdalla toipumiseen Paluu-N:ään, niin silloin riittää, että ikkunassa olevat paketit voidaan erotella toisistaan ja juuri ikkunasta poistuneesta viestistä (jota vielä käytetään kuittausnumerona), koska lähettäjä lähettää aina kadonneen viestin lisäksi kaikki sitä seuraavat viestit uudelleen. Näin eri 'kierrosten' pakettinumerot eivät voi sekaantua toisiinsa.</p><p>Valikoivan toiston kanssa sekaantumisen vaara on merkittävä, jos meillä ei ole riittävää turvamarginaalia ikkunan ympärillä. Valikoivan toiston kanssa itse asiassa suurin sallittu ikkunankoko on korkeintaan puolet käytettävästä numeroavaruudesta. Tämä johtuu siitä, että toisaalta lähettäjä lähettää vain yksittäisiä puuttuviksi olettamiaan viestejä ja toisaalta vastaanottaja puskuroi aiemmin saapuneita viestejä. Nyt on mahdollista, että vastaanottaja on saanut viestin jo aiemmin, mutta kuittaus katosi. Tällöin lähettäjän pitää lähettää kyseinen viesti uudelleen. Jos nyt vastaanottajan ikkuna on liikahtanut eteenpäin, niin ilman tuota turvamarginaalia olisi mahdollista, että vastaanottaja olettaisi saapuvan viestin kuuluvan jo seuraavaan sarjaan.  Tarvittaessa piirrä itsellesi tapahtumakuvaus, jossa tällainen sekaantuminen pääsee tapahtumaan, kun ikkunan koko vastaa numerointia. Piirrä sen jälkeen vastaava tapahtumasarja tilanteessa, jossa ikkunan koko on puolet numeroavaruudesta ja vakuuta itsesi, miksi tässä tilanteessa ei vastaavaa voi tapahtua.</p></div>","frontmatter":{"path":"/osa-3/3-liukuvaikkuna","title":"Liukuva ikkuna"},"fileAbsolutePath":"/home/runner/work/tietoliikenteen-perusteet-2-21/tietoliikenteen-perusteet-2-21/data/osa-3/3-liukuvaikkuna.md"},"allPages":{"edges":[{"node":{"id":"f94770ac-b87c-5b6d-aea7-87e3206ebc1a","frontmatter":{"path":"/","title":"Tietoa kurssista"}}},{"node":{"id":"07fbca84-2996-5ef5-91f4-80c8d67b1f6d","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"5dc284ce-33b0-5641-92d3-f3cbd298ae3e","frontmatter":{"path":"/opettajille","title":"Opettajille ja opinto-ohjaajille"}}},{"node":{"id":"72f0d3aa-a615-5485-927a-1d9efa922a6d","frontmatter":{"path":"/kurssin-suorittaminen","title":"Kurssin suorittaminen"}}},{"node":{"id":"71ffb689-39cd-54e4-afb1-10639d37b540","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"92902113-bd4d-54cb-8e4c-2d914a94a43b","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"73d38dec-d739-5d94-b391-abef8e5373b6","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"18912f50-4c07-571f-9704-91752a0bc432","frontmatter":{"path":"/osa-1/1-johdanto","title":"Johdanto"}}},{"node":{"id":"451f39f3-eecd-5fe0-a231-f701dbb224ea","frontmatter":{"path":"/osa-1/2-kertausta","title":"Kertausta"}}},{"node":{"id":"0148ecbb-fcfc-575a-ad8c-63788d56b585","frontmatter":{"path":"/osa-1/3-viipeet-ja-läpäisy","title":"Viipeet ja läpäisy"}}},{"node":{"id":"dbfac743-cc99-5393-83ad-23546879a4ff","frontmatter":{"path":"/osa-1/4-piirikytkentä","title":"Pakettikytkentä vs piirikytkentä"}}},{"node":{"id":"caab8edd-cf17-5b21-bfcd-4f30373615af","frontmatter":{"path":"/osa-1/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"2edd2121-da28-5faa-a44c-8f2d579fdc83","frontmatter":{"path":"/osa-1","title":"Osa 1: Yleistä"}}},{"node":{"id":"6a6f50c9-6751-5805-b191-0dc5ea90c487","frontmatter":{"path":"/osa-2/1-periaatteita","title":"Verkkosovelluksen toimintaperiaatteita"}}},{"node":{"id":"ccab9cf4-3881-552b-a03c-8cc97041dc82","frontmatter":{"path":"/osa-2/2-laki-ja-kuuntelu","title":"Verkon kuuntelu ja lainsäädäntö"}}},{"node":{"id":"4d9b998c-1b33-541d-a142-0f0cad57da54","frontmatter":{"path":"/osa-2/3-nimipalvelu","title":"Nimipalvelu"}}},{"node":{"id":"6309357c-886a-5e4d-88c1-399099c965ab","frontmatter":{"path":"/osa-2/4-sahkoposti","title":"Sähköposti"}}},{"node":{"id":"54075fab-cf7e-59f3-aad5-1a2fbfbc549a","frontmatter":{"path":"/osa-2/5-verkko-ohjelmointi-rajapinta","title":"Verkko-ohjelmointi ja sovelluksen rajapinta"}}},{"node":{"id":"c18adde4-4460-569a-819b-fc93ea16b497","frontmatter":{"path":"/osa-2/6-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"38f09292-8ebb-55a2-aeb0-9efba1ccc739","frontmatter":{"path":"/osa-2","title":"Osa 2: Sovelluskerros"}}},{"node":{"id":"13a24d8f-bc56-5d8a-8aa4-1e6f602af95e","frontmatter":{"path":"/osa-3/1-kuljetuspalvelu","title":"Kuljetuspalvelun toiminta"}}},{"node":{"id":"ef3093c1-baa2-56e7-a495-6cf6fcafdda7","frontmatter":{"path":"/osa-3/2-periaatteet","title":"Luotettavan kuljetuspalvelun periaatteet"}}},{"node":{"id":"b955b25c-822f-56a2-a571-d0ed4227e4ef","frontmatter":{"path":"/osa-3/4-suunnitteluperiaatteita","title":"Suunnitteluperiaatteita"}}},{"node":{"id":"4da3b549-a94d-5a7a-91dd-71b2d6a1e4d1","frontmatter":{"path":"/osa-3/3-liukuvaikkuna","title":"Liukuva ikkuna"}}},{"node":{"id":"a9f3b554-3a38-5f0f-99a9-8375816fd4cb","frontmatter":{"path":"/osa-3/6-udp","title":"UDP"}}},{"node":{"id":"0be5b703-d205-501e-b174-e8d33e95c832","frontmatter":{"path":"/osa-3/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"7b424c06-2601-5402-bc43-c2959d121643","frontmatter":{"path":"/osa-3","title":"Osa 3: Kuljetuskerros"}}},{"node":{"id":"b20703a9-2d0a-5467-a824-c86ac6579e1d","frontmatter":{"path":"/osa-4/1-IPv4-IPv6","title":"IPv4 ja IPv6 osoitteet"}}},{"node":{"id":"80365dff-896c-5368-896e-eec79b5129b0","frontmatter":{"path":"/osa-4/2-IP-protokolla","title":"IP-protokolla"}}},{"node":{"id":"55d42f0f-65fe-5038-8b60-67f6fc4bff83","frontmatter":{"path":"/osa-4/3-reititys","title":"Reititys"}}},{"node":{"id":"724b3cc2-dd79-5872-a0e6-706fece0415a","frontmatter":{"path":"/osa-3/5-tcp","title":"TCP"}}},{"node":{"id":"77442160-5292-5d91-b03f-c12f326017ca","frontmatter":{"path":"/osa-4/5-muita-verkkokerroksen-protokollia.md","title":"Muita verkkokerroksen protokollia"}}},{"node":{"id":"0c4f9075-9058-5109-8b3e-33cf37e05e05","frontmatter":{"path":"/osa-4/4-reititin","title":"Reititin"}}},{"node":{"id":"bb679c1b-fa88-5f1a-bcb5-5c7e4e0fb566","frontmatter":{"path":"/osa-4/6-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"a251821d-10ca-5d3c-8e2e-486145b750bb","frontmatter":{"path":"/osa-4","title":"Osa 4: Verkkokerros"}}},{"node":{"id":"4006d9b8-5c45-5f82-84c4-ec932ff6cca4","frontmatter":{"path":"/osa-5/2-virheidenhavaitseminen","title":"Virheiden havaitseminen ja korjaaminen"}}},{"node":{"id":"5e45a11a-8de3-5284-a686-5fbd5828cc39","frontmatter":{"path":"/osa-5/1-linkki-toiminta","title":"Yleistä linkkikerroksen toiminnasta"}}},{"node":{"id":"ccba763f-0ffa-5398-a9c2-6f9e23b97270","frontmatter":{"path":"/osa-5/4-kytkin","title":"Kytkin"}}},{"node":{"id":"54ca89a6-0d64-515e-8101-498fdcee037f","frontmatter":{"path":"/osa-5/3-vuorojen-jakelu","title":"Lähetysvuorojen jakelu"}}},{"node":{"id":"116b10b0-2f44-5011-a169-593eecfe6d50","frontmatter":{"path":"/osa-5/5-toiseen-verkkoon","title":"Lähettäminen toiseen verkkoon"}}},{"node":{"id":"ba6c210e-c87f-5f21-95af-f5e66c293f36","frontmatter":{"path":"/osa-5/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"f9c4a320-75ad-58cf-a44a-6f76b761e08f","frontmatter":{"path":"/osa-5/6-langaton","title":"Langaton verkko"}}},{"node":{"id":"a7407bc4-70d0-5174-9953-3860b86f2863","frontmatter":{"path":"/osa-6/1-kaikki-yhteen","title":"Kaikki yhteen"}}},{"node":{"id":"5daae54a-eb34-5ed0-b5a7-93b1d4ba1a68","frontmatter":{"path":"/osa-6","title":"Osa 6: Kaikki yhteen"}}},{"node":{"id":"830def90-4428-575f-99a5-c9231b692dcd","frontmatter":{"path":"/osa-5","title":"Osa 5: Linkkikerros"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}