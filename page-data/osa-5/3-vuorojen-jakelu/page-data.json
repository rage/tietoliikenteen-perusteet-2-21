{"componentChunkName":"component---src-templates-course-content-template-js","path":"/osa-5/3-vuorojen-jakelu","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Oppimistavoitteet"},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat kuvata yleisellä tasolla, miten kanavan jakaminen ja lähetysvuorojen jakelu voidaan tehdä."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat esitellä erilaisia lähetysvuorojen jakeluun liittyviä periaatteellisia ongelmia sekä joitakin niihin liittyviä ratkaisuja"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tunnistat mm. lyhenteet TDMA, FDMA, CDMA, CSMA/CD, CSMA/CA, jne."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat simuloida Ethernetin käyttämää lähetysvuorojen jakelumenetelmää erilaisissa tilanteissa."}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"yhteiskayttoinen-kanava-ja-lahetysvuorojen-jakelu","style":"position:relative;"},"children":[{"type":"text","value":"Yhteiskäyttöinen kanava ja lähetysvuorojen jakelu"},{"type":"element","tagName":"a","properties":{"href":"#yhteiskayttoinen-kanava-ja-lahetysvuorojen-jakelu","ariaLabel":"yhteiskayttoinen kanava ja lahetysvuorojen jakelu permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kanava, jolla lähettäjän ja vastaanottajan välinen viesti kulkee, voi olla joko oma tai jaettu. Omaa kanavaa kutsutaan kaksipisteyhteydeksi (engl. point-to-point), koska siinä on vain kaksi päätä, lähettäjä ja vastaanottaja. Jos kanava on jaettu, niin silloin se on yleislähetysyhteys (engl. broadcast), jossa voi olla useita lähettäjiä ja vastaanottajia. Kaksipisteyhteys on esimerkiksi tähtiverkon yksi haara ei parikaapeli kytkimen ja isäntäkoneen (engl. host) välillä. Myös puhelinverkossa esimerkiksi kahden modeemin välinen yhteys on kaksipisteyhteys. "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/PPP_(tiedonsiirtoprotokolla)","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Point-to-Point Protocol (PPP)"}]},{"type":"text","value":" on suunniteltu nimeomaan käytettäväksi tällaisilla yhteyksillä. Nykyisin ethernet on paljolti syrjäyttänyt sen, koska modeemien käyttö on vähentynyt ja ethernet-pohjaisten laajakaistayhteyksien käyttö lisääntynyt."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Langaton verkko, väylätopologia ja toisinaan myös tähtitopologia ovat yleislähetysyhteyksiä, koska kaikki voivat lähettää ja kaikki vastaanottajat kuulevat kaiken tai lähes kaiken kanavassa kulkevan liikenteen. Yleislähetysyhteydessä meillä on yksi jaettu kanava, jota kaikki kuuntelevat. Lähetys onnistuu virheettömästi vain jos yksi lähettäjä lähettää kerrallaan. Jos useampi lähettäjä lähettää samanaikaisesti, niin syntyy yhteentörmäys, jolloin viestien signaalit sekoittuvat ja vastaanottajalle saapuu epämääräistä \"bittimössöä\". Vastaanottaja ei pysty tästä mössöstä enää erottamaan yhtään yksittäistä virheetöntä viestiä, vaan kaikki törmänneet viestit tuhoutuvat ja ne täytyy lähettää uudelleen. Meidän täytyy siis rakentaa mekanismi, jolla varmistetaan, että vain yksi lähettäjä kerrallaan lähettää."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kanavan lähetysvuorojen jakelusta käytetään useita erilaisia englanninkielisiä termejä, ainakin channel access method, multiple-access protocol ja media access control (eli MAC). Niminä ne korostavat vuoronjaon eri ominaisuuksia. Suomen kielen termi 'lähetysvuorojen jakelu' on muuten kuvaava, mutta se ei valitettavasti kerro, että usein kyse on nimenomaan lähettäjällä tapahtuvasta päätöksenteosta. Englanninkieliset termit korostavat nimenomaan siitä, että kyse on lähettäjän tai viestin pääsystä (access) kanavalle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vuoronjakomenetelmää suunniteltaessa on siis päätettävä, miten solmu päättelee voiko se lähettää ja kuinka solmun on toimittava törmäystilanteessa. Huomaa, että tietoliikenteessä meillä on käytettävissä vain tämä yksi kanava, jolloin kaikki tarvittava neuvottelu lähetysvuoroista käydään tässä yhdessä ja samassa kanavassa, jossa myös dataviestit kulkevat. Neuvotteluissakin lähetetään ja vastaanotetaan viestejä, joiden lähetysvuoroista pitäisi sopia. Tässä siis sekä kontrolli- että dataviestit kulkevat yhdessä ja samassa kanavassa. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yhteiskäyttöisen kanavan vuoronjakomenetelmä valitaan siten, että saamme mahdollisimman suuren osa kanavasta hyötykäyttöön. Tällöin menetelmän aiheuttama yleisrasite on pieni ja lähetysvuoroista sopiminen tehdään kustannustehokkaasti. Menetelmä on tällöin yleensä myös yksinkertainen ja halpa toteuttaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun kanavassa on vain yksi lähettäjä kerrallaan, se pystyy hyödyntämään kanavan koko siirtonopeuden eli siirtämään tietoa kanavan 'maksiminopeudella' R bittiä sekunnissa. Pidemmällä aikavälillä tarkasteltuna, kun meillä on M lähettäjää, niin tavoite on että jokainen niistä saa keskimäärin saman osuuden linjan siirtonopeudesta eli R/M bittiä sekunnissa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vuoronjakomenetelmän keskeinen ongelma onkin se, että miten voimme varmistaa, että yksi lähettäjä ei voi kaapata kanavaa itselleen, vaan että kaikilla lähettäjillä on tasapuolisesti mahdollisuus saada kanava käyttöön ja lähettää viesti sitä pitkin. Haluamme siis välttää yksittäisen lähettäjän nälkiintymisen (engl. starvation). Tietojenkäsittelytieteessä yleisesti nälkiintyminen tarkoittaa, että kyseinen entiteetti (tässä sanoman lähettäjä) ei saa koskaan tarvitsemaansa resurssia (tässä kanava). Jotta nälkiintymistä ei tapahdu, niin kanavanjakomenetelmän täytyy olla tasapuolinen. Toisaalta myöskään lukkiutumista (engl. deadlock), eli että mikään lähettäjä ei voisi enää lähettää, ei saa esiintyä. Menetelmän pitää siis olla kaikilta ominaisuuksiltaan hyvin toimintavarma."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lähetysvuorojen jakaminen yhdellä kanavalla voidaan tehdä usealla eri tavalla. Kanavanjakoprotokollilla (engl. channel partitioning protocols) voimme jakaa kanavan osiin ja antaa yhden osan yhden lähettäjän käyttöön. Vuorotteluprotokollilla (engl. taking-turns protocols) voimme jakaa käyttövuorot ennalta sovitun periaatteen mukaisesti vuoronperään eri lähettäjille. Kilpailuprotokollilla (engl. random access protocols) lähettäjät joutuvat kilpailemaan lähetysvuorosta. Vuorot jakautuvat niille satunnaisemmin ja lähetysvuoron odottamiseen kuluva aika on vaikeammin ennustettava."}]},{"type":"element","tagName":"h3","properties":{"id":"kanavanjakoprotokollat","style":"position:relative;"},"children":[{"type":"text","value":"Kanavanjakoprotokollat"},{"type":"element","tagName":"a","properties":{"href":"#kanavanjakoprotokollat","ariaLabel":"kanavanjakoprotokollat permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kanavan jaolla annetaan jokaiselle lähettäjälle oma pala kanavasta. Lähettäjä saa tässä palasessa lähettää omia viestejä ilman, että muiden lähettäjien viestien signaalit häiritsevät lähetystä. Näin kukin solmu saa oman viipaleensa. Voimme jakaa kanavan paloihin ajan tai taajuuden perusteella. Lisäksi on mahdollista käyttää erilaisia bittien koodaustapoja, jolloin samassa kanavassa voidaan samanaikaisesti lähettää useita eri viestejä, jotka vastaaottaja pystyy edelleen erottamaan toisistaan."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tässä siis oleellista on se, että lähettäjän käyttäessä sille varattua osaa kanavasta, ei yhteentörmäyksiä tapahdu, jolloin kyseinen osa kanavasta on aina lähettäjän käytettävissä. Näin kyseinen osa kanavasta on varattuna tälle lähettäjälle silloinkin, kun se ei sitä tarvitse. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Aikaviipaloidussa kanavassa, ns. "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/TDMA","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"aikajakokanavointi"}]},{"type":"text","value":" (engl. time-division multiple access, TDMA), jaetaan tietty aikajakso vakiokokoisiin aikaviipaleisiin siten, että aikaviipaleen pituus on yhden kehyksen lähetysaika ja jokainen lähettäjä saa (yhden) aikaviipaleen kerran tämän pidemmän aikajakson kuluessa."}]},{"type":"element","tagName":"img","properties":{"src":"/fd73584918d78eda397032f1cd903fa0/5-3-taajuusjako-aikajako.svg","alt":"Kuvassa on graafinen esitys taajuusjako ja aikajako kanavoinnista. Y-akelilla on taajuus ja x-akselilla aika. Taajuusjaossa meillä on alue jaettuna korkeussuunnassa yhtä suuriin, eri värisiin, suorakaiteisiin. Aikajaossa alue on jaettu vaakasuunnaa suorakaiteisiin, jotka ovat koko taajuusalueen korkuisia, mutta ajallisesti kapeita. Nämä suorakaiteet on väritetty samoila väreillä kuin taajuusjaossa, mutta nyt värit vuorottelevat jaksoissa."},"children":[]},{"type":"text","value":"\nKUVA:  Kanava jaettu taajuusalueittain eri lähettäjille. Huomaa, että taajuusalueiden määrä rajoittaa samanaikaisten lähettäjien määrää. Vieressä sama kanava jaettuna aikaviipaleisiin samoille lähettäjille. Huomaa nyt, että lähettäjät vuorottelevat, mutta käyttävät lähettäessään kanavan koko taajuusaluetta."},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/FDMA","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Taajuusjakokanavoinnissa"}]},{"type":"text","value":" (eng. Frequency division multiple access, FDMA) jaetaan ajan sijasta käytettävää taajuusaluetta. Tämä muistuttaa esimerkiksi radio- tai tv-kanavien jakoperustetta, kun kyseessä on radiosignaalia käyttävä lähetys. Tässä jokaiselle lähettäjälle varataan kiinteä taajuusalue (fixed frequency band), joka on vain osa koko kanavan taajuusalueesta. Koska taajuusalue varataan yhdelle lähettäjälle, niin sitä eivät muut voi käyttää sinä aikana kun varaus on voimassa. Näin, jos lähetettävää ei kyseisellä lähettäjällä ole, niin se osa kanavan kapasiteetistä jää käyttämättä, vaikka muilla olisikin lähetettävää."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sekä aikajaossa että taajuusjaossa lähettävä solmu (tai asema) saa käyttöönsä vain osan kanavan kapasiteetista. Jos kanavan kapasiteetti R bittiä sekunnissa jaetaan tasan kaikille M:lle lähettäjälle niin jokainen voi lähettää keskimäärin R/M bittiä sekunnissa, jos se käyttää kaikki sille varatut osat kanavasta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/CDMA","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Koodijakokanavoinnissa"}]},{"type":"text","value":" (engl. code division multiple access, CDMA) voidaan koko kanavan kapasiteetti antaa kaikkien lähettäjien käyttöön samanaikaisesti. Tätä käytetään lähinnä radiotiellä, joissa jokaisella asemalla on yksilöllinen (ja muiden kanssa ortogonaalinen) tapa koodata bitit 1 ja 0. Nyt kaikkien asemien lähettämät signaalit voivat vapaasti sekoittua radioaalloilla. Vastaanottajan pitää vain tietää, millä koodauksella sille tulevat viestit on koodattu ja se voi tämän avulla erotella saapuvasta yhteissignaalista tämän koodauksen mukaiset bitit, joista sitten muodostuu saapuva sanoma."}]},{"type":"element","tagName":"h3","properties":{"id":"vuorotteluprotokollat","style":"position:relative;"},"children":[{"type":"text","value":"Vuorotteluprotokollat"},{"type":"element","tagName":"a","properties":{"href":"#vuorotteluprotokollat","ariaLabel":"vuorotteluprotokollat permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vuorotteluprotokollia (engl. taking-turns protocols) kutsutaan myös vuoronantoprotokolliksi, koska niille on tyypillistä se, että kanavan käyttövuorot jaetaan jollakin etukäteen sovitulla tavalla (kuten vuorokysely tai vuoromerkki), mutta vain niille, joilla on jotain lähetettävää. Näin vältetään kanavan pitäminen turhaan varattuna. Toisaalta, kun lähettäjällä on lähetysvuoro, niin kaikki tietävät sen, eikä viestien yhteentörmäyksiä kanavassa pääse syntymään."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vuorokyselyssä erityinen isäntäsolmu kyselee vuorotellen (engl. polling) jokaiselta solmulta, onko sillä lähetettävää. Jos solmulla on lähetettävää se voi kyselyn saatuaan lähettää yhden viestin. Isäntä kuuntelee signaalia ja osaa päätellä milloin lähetys loppui. Sitten se kysyy seuraavalta vuorossa olevalta solmulta, onko sillä lähetettävää. Näin lähetysvuoro kiertää solmulta toiselle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vuoromerkkiä (engl. token) voidaan käyttää vuoroja jakavan isäntäsolmun sijaan. Se soveltuu erityisesti rengastopologiaan. Kun solmulla on vuoromerkki, se saa lähettää viestin, jonka jälkeen se antaa vuoromerkin renkaassa seuraavana olevalle solmulle. Jos solmulla ei ole lähetettävää, kun se saa vuoromerkin, se antaa merkin välittömästä eteenpäin. Näin kanavan kapasiteetti tulee käyttöön tehokkaammin kuin kanavanjakoon perustuvissa menetelmissä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Näistä on olemassa erilaisia versioita, joissa voidaan määritellä tarkemmin esimerkiksi, miten kauan vuoromerkkiä saa pitää, kuinka monta kehystä yhdessä vuorossa voi lähettää, jne. Esimerkiksi "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Token_Ring","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Token Ring"}]},{"type":"text","value":" on vuorottelua käyttävä verkko."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Näissä vuorottelumenetelmissä on yksi iso ongelma, ns. 'single point of failure'. Menetelmä toimii hyvin vain niin kauan kuin vuoromerkki tai kyselyjä hoitava isäntäkone ei katoa.  Jos tällainen vikaantuminen kuitenkin tapahtuu, niin mikään solmu ei voi lähettää kanavassa ja päädytään lukkiutuneeseen tilaan. Tästä voidaan toipua vain ensin havaitsemalla tilanne ja sitten joko valitsemalla uusi isäntäsolmu tai ottamalla käyttöön uusi vuoromerkki. Tällainen toipuminen on hidasta ja sen aikana viestit eivät kulje. Jätämme tämän yleisemminkin hajautettujen järjestelmien yhteistoimintaan liittyvän ongelman tarkemman käsittelyn myöhemmille kursseille."}]},{"type":"element","tagName":"h3","properties":{"id":"kilpailuprotokollat","style":"position:relative;"},"children":[{"type":"text","value":"Kilpailuprotokollat"},{"type":"element","tagName":"a","properties":{"href":"#kilpailuprotokollat","ariaLabel":"kilpailuprotokollat permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kilpailuprotokollista (engl. random access protocols) käytetään englanniksi myös termiä multiple access protocols. Lähettäjiä on useita ja ne kilpailevat lähetysvuoroista. Lähettäessään niiden pitää noudattaa tiettyjä sääntöjä, mutta etukäteen ei ole tiedossa milloin ja missä järjestyksessä lähettäjät voivat toimia. Periaatteena on siis yksinkertaisesti \"kuka ensin ehtii\". "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Koska mitään keskitettyä jakoa tai vuorottelua ei ole, niin jokaisen solmun pitää itsenäisesti, pelkästään sen hetkisen paikallisen tiedon varassa, tehdä päätös viestin lähettämisestä tai lähetyksen viivästämisestä. Kun solmu haluaa lähettää, niin se ensin kuuntelee, onko joku muu solmu jo lähettämässä. Jos ei ole, niin solmu aloittaa oman lähetyksensä. Kaikki lähetykset tehdään aina kanavan täydellä nopeudella. Jos joku muu jo lähettää, niin solmu viivästää omaa lähetystään ja odottaa kanavan vapautumista."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Koska lähettäjät kilpailevat kanavasta, niin on mahdollista, että kaksi lähettäjää yrittää lähettää samaan aikaan ja tapahtuu yhteentörmäys. Mikäli kahden lähettäjän viestit ovat kanavassa samaan aikaan, niin kumpikin viesti tuhoutuu, koska niiden signaaleja ei voi sekoittumisen jälkeen enää erottaa. Kun tällainen viestien törmäys tapahtuu, niin molemmat lähettäjät joutuvat lähettämään omat viestinsä myöhemmin uudelleen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Solmun pitää tavalla tai toisella havaita törmäys. Tässä suhteessa eri protokollat toimivat eri tavalla. Niissä on myös eroja siinä, miten törmäyksestä toivutaan eli miten ja milloin uudelleenlähetys tapahtuu. Tyypillisesti törmäyksen jälkeen solmu odottaa satunnaisen (engl. random) ajan ja yrittää sitten uudelleen. "}]},{"type":"element","tagName":"h4","properties":{"id":"aloha-ja-viipaloitu-aloha","style":"position:relative;"},"children":[{"type":"text","value":"Aloha ja viipaloitu aloha"},{"type":"element","tagName":"a","properties":{"href":"#aloha-ja-viipaloitu-aloha","ariaLabel":"aloha ja viipaloitu aloha permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Aloitetaan historiasta ja ihan ensimmäisestä langattoman verkon lähetysvuorojen jakoprotokollasta, jonka nimi on "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/ALOHAnet","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ALOHA"}]},{"type":"text","value":". Vaikka ALOHA kehitettiin nimenomaan langatonta radioteitse tapahtuvaa viestintää varten 1971 Havaijilla, niin sitä käytettiin myös kaapeliyhteyksillä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Alkuperäinen ALOHA ei ollut kovin tehokas, koska jokainen solmu sai lähettää viestin heti, kun sillä oli lähetettävää. Se ei siis  etukäteen kuunnellut onko radiotiellä jo viesti kulkemassa. Solmu kuunteli vasta lähetyksen jälkeen onnistuiko lähetys. Jos törmäys tapahtui, niin solmun piti odottaa satunnainen aika ja yrittää sitten uudelleen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Koska solmut eivät kuunnelleet etukäteen ja koska viestien pituutta ei ollut rajoitettu, niin alkuperäisessä ALOHAssa törmäyksen todennäköisyys oli niin suuri, että vain noin 18% kanavan koko kapasiteetista saatiin käyttöön. Suurin osa kanavan kapasiteetista kului siis tärmäysten vuoksi hukkaan. Katso englanninkielisestä wikipediasta "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/ALOHAnet","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ALOHAnet-sivulta"}]},{"type":"text","value":" kuvia, joista selviää miksi yhteentörmäykset vievät noin suuren osan kanavan kapasiteetista."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"3c8523f2-c26c-5ce3-85eb-541b5c2e272d"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ALOHAsta tehtiin paranneltu versio, jossa karsittiin osittain päällekkäiset yhteentörmäykset pois. Viipaloidussa ALOHAssa (engl. slotted ALOHA) kaikki siirrettävät kehykset ovat keskenään samankokoisia. Lisäksi kanava jaettiin aikaviipaleisiin siten, että yhdessä aikaviipaleessa voi lähettää yhden kehyksen. Nyt kaikki solmut aloittavat lähetyksensä aina aikaviipaleen alusta eikä kesken toisen solmun lähetystä. Tämä onnistui, kun solmut ja niiden kellot saatiin synkronoitua. Kaikki (lähettävät) solmut havaitsevat yhteentörmäykset."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun siirtokehys on valmis, niin solmu lähettää sen heti seuraavassa aikaviipaleessa. Jos ei tullut yhteentörmäystä, niin solmu voi lähettää seuraavan kehyksen heti seuraavassa aikaviipaleessa. Jos lähetyksessä tuli yhteentörmäys, niin solmu yrittää lähetystä uudelleen seuraavassa aikaviipaleessa jollakin todennäköisyydellä p."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Viipaloidussa ALOHAssa saadaan kanavan kapasiteetista käyttöön noin 37%, mikä on kaksinkertainen määrä alkuperäiseen ALOHAan verrattuna. Englanninkielisessä wikipediassa on hyvin kuvattu matemaattinen päättelyketju tämän tehokkuusluvun laskennassa. "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Viipaloitua ALOHAa käytetään edelleen tietyissä erikoistilanteissa, koska se on toteutukseltaan ja toiminnaltaan hyvin yksinkertainen ja koska se sallii yhden lähettäjän lähettää täydellä nopeudella, jos muita lähettäjiä ei samanaikaisesti ole."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Wikipedian englanninkielisellä "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/ALOHAnet","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ALOHAnet"}]},{"type":"text","value":" sivulla on hyvä kuva viipaloidun ALOHAn toiminnasta useamman lähettäjän kanssa. Kuvassa on sekä yhteentörmäyksiä että onnistuneita lähetyksiä."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"f974745d-fb04-594c-a0b6-cc6c10deb640"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tagName":"h3","properties":{"id":"lahetyskanavan-kuuntelu-csma","style":"position:relative;"},"children":[{"type":"text","value":"Lähetyskanavan kuuntelu CSMA"},{"type":"element","tagName":"a","properties":{"href":"#lahetyskanavan-kuuntelu-csma","ariaLabel":"lahetyskanavan kuuntelu csma permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Carrier-sense_multiple_access","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Lähetyskanavan kuuntelu"}]},{"type":"text","value":" (engl. Carrier Sense Multiple Access, CSMA) on ALOHAn jälkeen kehitetty menetelmä, jossa keskeistä on, että lähettäjän täytyy ennen omaan lähetystään varmistaa, että kanava on tyhjä. Ajatus on siis, että solmu kuuntelee kanavaa ennen kuin lähettää ja lähettää vain, jos kanava on tyhjä. Jos kanava on tyhjä, niin voi lähettää samantien. Jos kanava on varattuna, niin solmun ei voi lähettää vaan sen pitää odottaa. Odotuksen kesto riippuu CSMAn toteutusvaihtoehdosta. Aika tavallista on odottaa satunnainen aika ja sitten tarkistaa uudelleen, onko kanava vapaa. Odottaminen voi myös olla aktiivista, jolloin solmu aktiivisesti kuuntelee kanavan vapautumista ja lähettää heti, kun kanava on vapaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Etukäteen tapahtuvalla kanavan kuuntelulla ei kuitenkaan voi havaita kaikkia muiden lähetyksiä ainakaan riittävän nopeasti, joten yhteentörmäykset ovat edelleen mahdollisia. Esimerkiksi kaapelissa etenemisviiveen takia kaksi lähettäjää voivat molemmat havaita kanavan tyhjäksi ja aloittaa lähetyksen samaanaikaan. Langattomassa lähiverkossa lähettäjän ympäristön kuuntelu ei kerro, onko vastaanottaja saamassa sanomia muilta, joita lähettäjä ei voi etäisyyden takia kuulla. Vastaavasti satelliittikanavan kuuntelu ei paljasta, onko jonkin muu maa-asema jo aloittanut lähetyksen. Huomaathan, että satelliittien kautta tapahtuvassa viestinnässä etenemisviiveet voivat olla merkittäviä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Mikäli yhteentörmäys tapahtuu, niin molempien (tai kaikkien törmänneiden) pakettien lähetykset epäonnistuvat ja ne joudutaan lähettämään uudelleen. Tällöin paketin lähettämiseen käytetty aika menee hukkaan. Solmujen väliset etäisyydet ja etenemisviiveet vaikuttavat yhteentörmäysten todennäköisyyteen, koska jos solmu ei voi havaita toisen solmun jo aloittamaa lähetystä, niin se voi aloittaa oman lähetyksensä samaan aikaan tuon toisen solmun kanssa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"CSMA:sta on useita erilaisia versioita törmäysten hallintaan. Esimerkiksi CSMA/CA (engl. Collision Avoidance, CA) pyrkii ensisijaisesti välttämään törmäyksiä. Sitä käytetään mm. WLANien käyttämässä standardissa "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/IEEE_802.11","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"IEEE 802.11"}]},{"type":"text","value":". Langattomassa viestinnässä solmun on teknisesti vaikea samaan aikaan sekä lähettää että kuunnella mahdollista yhteentörmäystä. Sen takia pyritäänkin ensisijaisesti välttämään törmäyksiä. Tämä voidaan tehdä esim. lähettämällä varaussignaali ennen varsinaista kehystä tai kuten IEEE 802.11:ssä odottamalla satunnainen aika vapaata kanavaa seuraten ennen varsinaista lähetystä. Näin, jos kaksi solmua haluaa lähettää samaan aikaan, on todennäköistä, että toinen niistä aloittaa ensin ja toinen havaitsee lähetyksen eikä yritä lähettää päälle, vaan joutuu odottamaan pidempään."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ethernetissä käytetään "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/CSMA/CD","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"CSMA/CD:tä"}]},{"type":"text","value":" (engl. Collision Detection). Siinä solmu voi aloittaa lähettämisen heti, kun se havaitsee kanavan olevan vapaana, mutta sen täytyy samanaikaisesti kuunnella kanavaa, jotta se voi havaita yhteentörmäyksen. Koska liikennöinti tapahtuu kaapelissa, niin voimme olla varmoja, että solmu voi havaita yhteentörmäyksen. Havaitseminen voidaan tehdä esimerkiksi signaalin voimakkuuden muutoksesta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"CSMA/CD:ssä solmun pitää keskeyttää kehyksen lähettäminen heti (minimipituuden jälkeen), jos se havaitsee törmäyksen. Tällä nopealla keskeytyksellä pienennetään törmäyksen aiheuttamaa hukka-aikaa ja lyhennetään kanavan varauksen kestoa. Näin yhteentörmäyksestä toivutaan hiukan nopeammin, kuin jos solmut lähettäisivät kehykset kokonaan. Tämä on CSMA/CD:n keskeinen ero perus-CSMA:han, jossa solmu saa lähettää koko kehyksen, vaikka se olisi havainnut törmäyksen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos kehyksen lähetys epäonnistui törmäyksen vuoksi, niin solmu odottaa satunnaisen ajan ja yrittää lähettämistä sen jälkeen uudelleen. Tällöinkin se voi lähettää vasta, kun kanava on vapaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Iso kysymys erityisesti CSMA/CD:ssä on, että kuinka paljon pitää vähintään lähettää ja toisaalta, kuinka kauan on kuunneltava oman lähetyksen aloituksen jälkeen. Ajatellaan, että A:n ja B:n etäisyys on kyseisessä kaapelissa mahdollisimman suuri eli ne ovat kaapelin eri päissä. Vaikka A on jo aloittanut lähettämisen, niin B kuulee vielä hetken aikaa tyhjän kanavan ja voi aloittaa oman lähetyksensä. Tämä aika on etenemisviive A:lta B:lle. Jotta A voi havaita törmäyksen, niin sen pitää kuulla B:n lähetys, johon menee vielä toinen etenemisviive. Näin ollen pisin aika, jonka kuluessa mikä tahansa solmu voi havaita törmäyksen on 2 * etenemisviive solmujen välillä.  Varmistaakseen yhteentörmäyksen havaitsemisen solmu ei saa lopettaa omaa lähetystään ennen kuin törmäyssignaali on varmasti ehtinyt tulla. Näin ollen pienin sallittu lähetettävän kehyksen koko on se, jonka lähettäminen kestää vähintään 2 kertaa kaukaisimpien laitteiden välisen maksimietenemisviiveen verran. Näin ethernet-kehyksen minimikoko rajoittaa yhden linkkivälin ethernet-kaapelin pituutta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Solmun, tai oikeammin sen verkkosovittimen (verkkokortti ja sen laiteohjain), toimenpiteet kehyksen lähetyksessä, kun noudatetaan CSMA/CD:tä:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Verkkosovitin saa kehyksen välitettäväksi."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Jos verkkosovitin havaitsee, että kanava on tyhjä, niin se aloittaa kehyksen lähetyksen samantien. Jos se havaitsee, että kanava on käytössä, niin se odottaa, kunnes kanava on tyhjä ja aloittaa sitten kehyksen lähetyksen."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Kun kehyksen lähetys on käynnissä, verkkosovitin kuuntelee kanavaa ja pyrkii havaitsemaan jonkun muun lähettämän signaalin."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Jos verkkosovitin havaitsee signaalin, niin se lopettaa kehyksen lähettämisen (vaaditun minimikoon jälkeen)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Jos kehyksen lähetys päättyy, eikä muiden signaaleja ole kuultu, niin kehyksen lähetys on onnistunut. "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Jos kehyksen lähetys päättyi keskeytykseen, niin verkkosovitin odottaa satunnaisen ajan ja jatkaa kohdasta 2."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tuo verkkosovittimien satunnainen odotusaika kasvaa jokaisen peräkkäisen yhteentörmäyksen yhteydessä. Tästä käytetään englanninkielistä termiä binary exponential backoff. Odotusaika valitaan satunnaisesti kokonaislukujen joukosta {0,1,2,... (2^n)-1}, missä n on peräkkäisten yhteentörmäysten määrä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Huomaathan, että verkkosovittimien toiminta on täysin riippumatonta aiempien viestien onnistumisesta ja muiden verkkosovittimien toiminnasta. Tällöin on täysin mahdollista, että verkkosovitin, joka juuri sai kehyksen välitettäväksi, saa kehyksensä välitettyä sillä aikaa, kun muut yhteentörmäysten jälkeen odottavat seuraavaa lähetysyritystä."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"655b26e6-ddfc-5380-84e0-a55a9fd4d090"},"children":[{"type":"text","value":" "}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Oppimistavoitteet'><ul>\n<li>Osaat kuvata yleisellä tasolla, miten kanavan jakaminen ja lähetysvuorojen jakelu voidaan tehdä.</li>\n<li>Osaat esitellä erilaisia lähetysvuorojen jakeluun liittyviä periaatteellisia ongelmia sekä joitakin niihin liittyviä ratkaisuja</li>\n<li>Tunnistat mm. lyhenteet TDMA, FDMA, CDMA, CSMA/CD, CSMA/CA, jne.</li>\n<li>Osaat simuloida Ethernetin käyttämää lähetysvuorojen jakelumenetelmää erilaisissa tilanteissa.</li>\n</ul></text-box><h2 id=\"yhteiskayttoinen-kanava-ja-lahetysvuorojen-jakelu\" style=\"position:relative;\">Yhteiskäyttöinen kanava ja lähetysvuorojen jakelu<a href=\"#yhteiskayttoinen-kanava-ja-lahetysvuorojen-jakelu\" aria-label=\"yhteiskayttoinen kanava ja lahetysvuorojen jakelu permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Kanava, jolla lähettäjän ja vastaanottajan välinen viesti kulkee, voi olla joko oma tai jaettu. Omaa kanavaa kutsutaan kaksipisteyhteydeksi (engl. point-to-point), koska siinä on vain kaksi päätä, lähettäjä ja vastaanottaja. Jos kanava on jaettu, niin silloin se on yleislähetysyhteys (engl. broadcast), jossa voi olla useita lähettäjiä ja vastaanottajia. Kaksipisteyhteys on esimerkiksi tähtiverkon yksi haara ei parikaapeli kytkimen ja isäntäkoneen (engl. host) välillä. Myös puhelinverkossa esimerkiksi kahden modeemin välinen yhteys on kaksipisteyhteys. <a href=\"https://fi.wikipedia.org/wiki/PPP_(tiedonsiirtoprotokolla)\" target=\"_blank\" rel=\"noopener noreferrer\">Point-to-Point Protocol (PPP)</a> on suunniteltu nimeomaan käytettäväksi tällaisilla yhteyksillä. Nykyisin ethernet on paljolti syrjäyttänyt sen, koska modeemien käyttö on vähentynyt ja ethernet-pohjaisten laajakaistayhteyksien käyttö lisääntynyt.</p><p>Langaton verkko, väylätopologia ja toisinaan myös tähtitopologia ovat yleislähetysyhteyksiä, koska kaikki voivat lähettää ja kaikki vastaanottajat kuulevat kaiken tai lähes kaiken kanavassa kulkevan liikenteen. Yleislähetysyhteydessä meillä on yksi jaettu kanava, jota kaikki kuuntelevat. Lähetys onnistuu virheettömästi vain jos yksi lähettäjä lähettää kerrallaan. Jos useampi lähettäjä lähettää samanaikaisesti, niin syntyy yhteentörmäys, jolloin viestien signaalit sekoittuvat ja vastaanottajalle saapuu epämääräistä \"bittimössöä\". Vastaanottaja ei pysty tästä mössöstä enää erottamaan yhtään yksittäistä virheetöntä viestiä, vaan kaikki törmänneet viestit tuhoutuvat ja ne täytyy lähettää uudelleen. Meidän täytyy siis rakentaa mekanismi, jolla varmistetaan, että vain yksi lähettäjä kerrallaan lähettää.</p><p>Kanavan lähetysvuorojen jakelusta käytetään useita erilaisia englanninkielisiä termejä, ainakin channel access method, multiple-access protocol ja media access control (eli MAC). Niminä ne korostavat vuoronjaon eri ominaisuuksia. Suomen kielen termi 'lähetysvuorojen jakelu' on muuten kuvaava, mutta se ei valitettavasti kerro, että usein kyse on nimenomaan lähettäjällä tapahtuvasta päätöksenteosta. Englanninkieliset termit korostavat nimenomaan siitä, että kyse on lähettäjän tai viestin pääsystä (access) kanavalle.</p><p>Vuoronjakomenetelmää suunniteltaessa on siis päätettävä, miten solmu päättelee voiko se lähettää ja kuinka solmun on toimittava törmäystilanteessa. Huomaa, että tietoliikenteessä meillä on käytettävissä vain tämä yksi kanava, jolloin kaikki tarvittava neuvottelu lähetysvuoroista käydään tässä yhdessä ja samassa kanavassa, jossa myös dataviestit kulkevat. Neuvotteluissakin lähetetään ja vastaanotetaan viestejä, joiden lähetysvuoroista pitäisi sopia. Tässä siis sekä kontrolli- että dataviestit kulkevat yhdessä ja samassa kanavassa. </p><p>Yhteiskäyttöisen kanavan vuoronjakomenetelmä valitaan siten, että saamme mahdollisimman suuren osa kanavasta hyötykäyttöön. Tällöin menetelmän aiheuttama yleisrasite on pieni ja lähetysvuoroista sopiminen tehdään kustannustehokkaasti. Menetelmä on tällöin yleensä myös yksinkertainen ja halpa toteuttaa.</p><p>Kun kanavassa on vain yksi lähettäjä kerrallaan, se pystyy hyödyntämään kanavan koko siirtonopeuden eli siirtämään tietoa kanavan 'maksiminopeudella' R bittiä sekunnissa. Pidemmällä aikavälillä tarkasteltuna, kun meillä on M lähettäjää, niin tavoite on että jokainen niistä saa keskimäärin saman osuuden linjan siirtonopeudesta eli R/M bittiä sekunnissa.</p><p>Vuoronjakomenetelmän keskeinen ongelma onkin se, että miten voimme varmistaa, että yksi lähettäjä ei voi kaapata kanavaa itselleen, vaan että kaikilla lähettäjillä on tasapuolisesti mahdollisuus saada kanava käyttöön ja lähettää viesti sitä pitkin. Haluamme siis välttää yksittäisen lähettäjän nälkiintymisen (engl. starvation). Tietojenkäsittelytieteessä yleisesti nälkiintyminen tarkoittaa, että kyseinen entiteetti (tässä sanoman lähettäjä) ei saa koskaan tarvitsemaansa resurssia (tässä kanava). Jotta nälkiintymistä ei tapahdu, niin kanavanjakomenetelmän täytyy olla tasapuolinen. Toisaalta myöskään lukkiutumista (engl. deadlock), eli että mikään lähettäjä ei voisi enää lähettää, ei saa esiintyä. Menetelmän pitää siis olla kaikilta ominaisuuksiltaan hyvin toimintavarma.</p><p>Lähetysvuorojen jakaminen yhdellä kanavalla voidaan tehdä usealla eri tavalla. Kanavanjakoprotokollilla (engl. channel partitioning protocols) voimme jakaa kanavan osiin ja antaa yhden osan yhden lähettäjän käyttöön. Vuorotteluprotokollilla (engl. taking-turns protocols) voimme jakaa käyttövuorot ennalta sovitun periaatteen mukaisesti vuoronperään eri lähettäjille. Kilpailuprotokollilla (engl. random access protocols) lähettäjät joutuvat kilpailemaan lähetysvuorosta. Vuorot jakautuvat niille satunnaisemmin ja lähetysvuoron odottamiseen kuluva aika on vaikeammin ennustettava.</p><h3 id=\"kanavanjakoprotokollat\" style=\"position:relative;\">Kanavanjakoprotokollat<a href=\"#kanavanjakoprotokollat\" aria-label=\"kanavanjakoprotokollat permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Kanavan jaolla annetaan jokaiselle lähettäjälle oma pala kanavasta. Lähettäjä saa tässä palasessa lähettää omia viestejä ilman, että muiden lähettäjien viestien signaalit häiritsevät lähetystä. Näin kukin solmu saa oman viipaleensa. Voimme jakaa kanavan paloihin ajan tai taajuuden perusteella. Lisäksi on mahdollista käyttää erilaisia bittien koodaustapoja, jolloin samassa kanavassa voidaan samanaikaisesti lähettää useita eri viestejä, jotka vastaaottaja pystyy edelleen erottamaan toisistaan.</p><p>Tässä siis oleellista on se, että lähettäjän käyttäessä sille varattua osaa kanavasta, ei yhteentörmäyksiä tapahdu, jolloin kyseinen osa kanavasta on aina lähettäjän käytettävissä. Näin kyseinen osa kanavasta on varattuna tälle lähettäjälle silloinkin, kun se ei sitä tarvitse. </p><p>Aikaviipaloidussa kanavassa, ns. <a href=\"https://fi.wikipedia.org/wiki/TDMA\" target=\"_blank\" rel=\"noopener noreferrer\">aikajakokanavointi</a> (engl. time-division multiple access, TDMA), jaetaan tietty aikajakso vakiokokoisiin aikaviipaleisiin siten, että aikaviipaleen pituus on yhden kehyksen lähetysaika ja jokainen lähettäjä saa (yhden) aikaviipaleen kerran tämän pidemmän aikajakson kuluessa.</p><img src=\"/fd73584918d78eda397032f1cd903fa0/5-3-taajuusjako-aikajako.svg\" alt=\"Kuvassa on graafinen esitys taajuusjako ja aikajako kanavoinnista. Y-akelilla on taajuus ja x-akselilla aika. Taajuusjaossa meillä on alue jaettuna korkeussuunnassa yhtä suuriin, eri värisiin, suorakaiteisiin. Aikajaossa alue on jaettu vaakasuunnaa suorakaiteisiin, jotka ovat koko taajuusalueen korkuisia, mutta ajallisesti kapeita. Nämä suorakaiteet on väritetty samoila väreillä kuin taajuusjaossa, mutta nyt värit vuorottelevat jaksoissa.\">\nKUVA:  Kanava jaettu taajuusalueittain eri lähettäjille. Huomaa, että taajuusalueiden määrä rajoittaa samanaikaisten lähettäjien määrää. Vieressä sama kanava jaettuna aikaviipaleisiin samoille lähettäjille. Huomaa nyt, että lähettäjät vuorottelevat, mutta käyttävät lähettäessään kanavan koko taajuusaluetta.<p><a href=\"https://fi.wikipedia.org/wiki/FDMA\" target=\"_blank\" rel=\"noopener noreferrer\">Taajuusjakokanavoinnissa</a> (eng. Frequency division multiple access, FDMA) jaetaan ajan sijasta käytettävää taajuusaluetta. Tämä muistuttaa esimerkiksi radio- tai tv-kanavien jakoperustetta, kun kyseessä on radiosignaalia käyttävä lähetys. Tässä jokaiselle lähettäjälle varataan kiinteä taajuusalue (fixed frequency band), joka on vain osa koko kanavan taajuusalueesta. Koska taajuusalue varataan yhdelle lähettäjälle, niin sitä eivät muut voi käyttää sinä aikana kun varaus on voimassa. Näin, jos lähetettävää ei kyseisellä lähettäjällä ole, niin se osa kanavan kapasiteetistä jää käyttämättä, vaikka muilla olisikin lähetettävää.</p><p>Sekä aikajaossa että taajuusjaossa lähettävä solmu (tai asema) saa käyttöönsä vain osan kanavan kapasiteetista. Jos kanavan kapasiteetti R bittiä sekunnissa jaetaan tasan kaikille M:lle lähettäjälle niin jokainen voi lähettää keskimäärin R/M bittiä sekunnissa, jos se käyttää kaikki sille varatut osat kanavasta.</p><p><a href=\"https://fi.wikipedia.org/wiki/CDMA\" target=\"_blank\" rel=\"noopener noreferrer\">Koodijakokanavoinnissa</a> (engl. code division multiple access, CDMA) voidaan koko kanavan kapasiteetti antaa kaikkien lähettäjien käyttöön samanaikaisesti. Tätä käytetään lähinnä radiotiellä, joissa jokaisella asemalla on yksilöllinen (ja muiden kanssa ortogonaalinen) tapa koodata bitit 1 ja 0. Nyt kaikkien asemien lähettämät signaalit voivat vapaasti sekoittua radioaalloilla. Vastaanottajan pitää vain tietää, millä koodauksella sille tulevat viestit on koodattu ja se voi tämän avulla erotella saapuvasta yhteissignaalista tämän koodauksen mukaiset bitit, joista sitten muodostuu saapuva sanoma.</p><h3 id=\"vuorotteluprotokollat\" style=\"position:relative;\">Vuorotteluprotokollat<a href=\"#vuorotteluprotokollat\" aria-label=\"vuorotteluprotokollat permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Vuorotteluprotokollia (engl. taking-turns protocols) kutsutaan myös vuoronantoprotokolliksi, koska niille on tyypillistä se, että kanavan käyttövuorot jaetaan jollakin etukäteen sovitulla tavalla (kuten vuorokysely tai vuoromerkki), mutta vain niille, joilla on jotain lähetettävää. Näin vältetään kanavan pitäminen turhaan varattuna. Toisaalta, kun lähettäjällä on lähetysvuoro, niin kaikki tietävät sen, eikä viestien yhteentörmäyksiä kanavassa pääse syntymään.</p><p>Vuorokyselyssä erityinen isäntäsolmu kyselee vuorotellen (engl. polling) jokaiselta solmulta, onko sillä lähetettävää. Jos solmulla on lähetettävää se voi kyselyn saatuaan lähettää yhden viestin. Isäntä kuuntelee signaalia ja osaa päätellä milloin lähetys loppui. Sitten se kysyy seuraavalta vuorossa olevalta solmulta, onko sillä lähetettävää. Näin lähetysvuoro kiertää solmulta toiselle.</p><p>Vuoromerkkiä (engl. token) voidaan käyttää vuoroja jakavan isäntäsolmun sijaan. Se soveltuu erityisesti rengastopologiaan. Kun solmulla on vuoromerkki, se saa lähettää viestin, jonka jälkeen se antaa vuoromerkin renkaassa seuraavana olevalle solmulle. Jos solmulla ei ole lähetettävää, kun se saa vuoromerkin, se antaa merkin välittömästä eteenpäin. Näin kanavan kapasiteetti tulee käyttöön tehokkaammin kuin kanavanjakoon perustuvissa menetelmissä.</p><p>Näistä on olemassa erilaisia versioita, joissa voidaan määritellä tarkemmin esimerkiksi, miten kauan vuoromerkkiä saa pitää, kuinka monta kehystä yhdessä vuorossa voi lähettää, jne. Esimerkiksi <a href=\"https://fi.wikipedia.org/wiki/Token_Ring\" target=\"_blank\" rel=\"noopener noreferrer\">Token Ring</a> on vuorottelua käyttävä verkko.</p><p>Näissä vuorottelumenetelmissä on yksi iso ongelma, ns. 'single point of failure'. Menetelmä toimii hyvin vain niin kauan kuin vuoromerkki tai kyselyjä hoitava isäntäkone ei katoa.  Jos tällainen vikaantuminen kuitenkin tapahtuu, niin mikään solmu ei voi lähettää kanavassa ja päädytään lukkiutuneeseen tilaan. Tästä voidaan toipua vain ensin havaitsemalla tilanne ja sitten joko valitsemalla uusi isäntäsolmu tai ottamalla käyttöön uusi vuoromerkki. Tällainen toipuminen on hidasta ja sen aikana viestit eivät kulje. Jätämme tämän yleisemminkin hajautettujen järjestelmien yhteistoimintaan liittyvän ongelman tarkemman käsittelyn myöhemmille kursseille.</p><h3 id=\"kilpailuprotokollat\" style=\"position:relative;\">Kilpailuprotokollat<a href=\"#kilpailuprotokollat\" aria-label=\"kilpailuprotokollat permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Kilpailuprotokollista (engl. random access protocols) käytetään englanniksi myös termiä multiple access protocols. Lähettäjiä on useita ja ne kilpailevat lähetysvuoroista. Lähettäessään niiden pitää noudattaa tiettyjä sääntöjä, mutta etukäteen ei ole tiedossa milloin ja missä järjestyksessä lähettäjät voivat toimia. Periaatteena on siis yksinkertaisesti \"kuka ensin ehtii\". </p><p>Koska mitään keskitettyä jakoa tai vuorottelua ei ole, niin jokaisen solmun pitää itsenäisesti, pelkästään sen hetkisen paikallisen tiedon varassa, tehdä päätös viestin lähettämisestä tai lähetyksen viivästämisestä. Kun solmu haluaa lähettää, niin se ensin kuuntelee, onko joku muu solmu jo lähettämässä. Jos ei ole, niin solmu aloittaa oman lähetyksensä. Kaikki lähetykset tehdään aina kanavan täydellä nopeudella. Jos joku muu jo lähettää, niin solmu viivästää omaa lähetystään ja odottaa kanavan vapautumista.</p><p>Koska lähettäjät kilpailevat kanavasta, niin on mahdollista, että kaksi lähettäjää yrittää lähettää samaan aikaan ja tapahtuu yhteentörmäys. Mikäli kahden lähettäjän viestit ovat kanavassa samaan aikaan, niin kumpikin viesti tuhoutuu, koska niiden signaaleja ei voi sekoittumisen jälkeen enää erottaa. Kun tällainen viestien törmäys tapahtuu, niin molemmat lähettäjät joutuvat lähettämään omat viestinsä myöhemmin uudelleen.</p><p>Solmun pitää tavalla tai toisella havaita törmäys. Tässä suhteessa eri protokollat toimivat eri tavalla. Niissä on myös eroja siinä, miten törmäyksestä toivutaan eli miten ja milloin uudelleenlähetys tapahtuu. Tyypillisesti törmäyksen jälkeen solmu odottaa satunnaisen (engl. random) ajan ja yrittää sitten uudelleen. </p><h4 id=\"aloha-ja-viipaloitu-aloha\" style=\"position:relative;\">Aloha ja viipaloitu aloha<a href=\"#aloha-ja-viipaloitu-aloha\" aria-label=\"aloha ja viipaloitu aloha permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>Aloitetaan historiasta ja ihan ensimmäisestä langattoman verkon lähetysvuorojen jakoprotokollasta, jonka nimi on <a href=\"https://en.wikipedia.org/wiki/ALOHAnet\" target=\"_blank\" rel=\"noopener noreferrer\">ALOHA</a>. Vaikka ALOHA kehitettiin nimenomaan langatonta radioteitse tapahtuvaa viestintää varten 1971 Havaijilla, niin sitä käytettiin myös kaapeliyhteyksillä.</p><p>Alkuperäinen ALOHA ei ollut kovin tehokas, koska jokainen solmu sai lähettää viestin heti, kun sillä oli lähetettävää. Se ei siis  etukäteen kuunnellut onko radiotiellä jo viesti kulkemassa. Solmu kuunteli vasta lähetyksen jälkeen onnistuiko lähetys. Jos törmäys tapahtui, niin solmun piti odottaa satunnainen aika ja yrittää sitten uudelleen.</p><p>Koska solmut eivät kuunnelleet etukäteen ja koska viestien pituutta ei ollut rajoitettu, niin alkuperäisessä ALOHAssa törmäyksen todennäköisyys oli niin suuri, että vain noin 18% kanavan koko kapasiteetista saatiin käyttöön. Suurin osa kanavan kapasiteetista kului siis tärmäysten vuoksi hukkaan. Katso englanninkielisestä wikipediasta <a href=\"https://en.wikipedia.org/wiki/ALOHAnet\" target=\"_blank\" rel=\"noopener noreferrer\">ALOHAnet-sivulta</a> kuvia, joista selviää miksi yhteentörmäykset vievät noin suuren osan kanavan kapasiteetista.</p><div><quiz id=\"3c8523f2-c26c-5ce3-85eb-541b5c2e272d\"> </quiz></div><p>ALOHAsta tehtiin paranneltu versio, jossa karsittiin osittain päällekkäiset yhteentörmäykset pois. Viipaloidussa ALOHAssa (engl. slotted ALOHA) kaikki siirrettävät kehykset ovat keskenään samankokoisia. Lisäksi kanava jaettiin aikaviipaleisiin siten, että yhdessä aikaviipaleessa voi lähettää yhden kehyksen. Nyt kaikki solmut aloittavat lähetyksensä aina aikaviipaleen alusta eikä kesken toisen solmun lähetystä. Tämä onnistui, kun solmut ja niiden kellot saatiin synkronoitua. Kaikki (lähettävät) solmut havaitsevat yhteentörmäykset.</p><p>Kun siirtokehys on valmis, niin solmu lähettää sen heti seuraavassa aikaviipaleessa. Jos ei tullut yhteentörmäystä, niin solmu voi lähettää seuraavan kehyksen heti seuraavassa aikaviipaleessa. Jos lähetyksessä tuli yhteentörmäys, niin solmu yrittää lähetystä uudelleen seuraavassa aikaviipaleessa jollakin todennäköisyydellä p.</p><p>Viipaloidussa ALOHAssa saadaan kanavan kapasiteetista käyttöön noin 37%, mikä on kaksinkertainen määrä alkuperäiseen ALOHAan verrattuna. Englanninkielisessä wikipediassa on hyvin kuvattu matemaattinen päättelyketju tämän tehokkuusluvun laskennassa. </p><p>Viipaloitua ALOHAa käytetään edelleen tietyissä erikoistilanteissa, koska se on toteutukseltaan ja toiminnaltaan hyvin yksinkertainen ja koska se sallii yhden lähettäjän lähettää täydellä nopeudella, jos muita lähettäjiä ei samanaikaisesti ole.</p><p>Wikipedian englanninkielisellä <a href=\"https://en.wikipedia.org/wiki/ALOHAnet\" target=\"_blank\" rel=\"noopener noreferrer\">ALOHAnet</a> sivulla on hyvä kuva viipaloidun ALOHAn toiminnasta useamman lähettäjän kanssa. Kuvassa on sekä yhteentörmäyksiä että onnistuneita lähetyksiä.</p><div><quiz id=\"f974745d-fb04-594c-a0b6-cc6c10deb640\"> </quiz></div><h3 id=\"lahetyskanavan-kuuntelu-csma\" style=\"position:relative;\">Lähetyskanavan kuuntelu CSMA<a href=\"#lahetyskanavan-kuuntelu-csma\" aria-label=\"lahetyskanavan kuuntelu csma permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p><a href=\"https://en.wikipedia.org/wiki/Carrier-sense_multiple_access\" target=\"_blank\" rel=\"noopener noreferrer\">Lähetyskanavan kuuntelu</a> (engl. Carrier Sense Multiple Access, CSMA) on ALOHAn jälkeen kehitetty menetelmä, jossa keskeistä on, että lähettäjän täytyy ennen omaan lähetystään varmistaa, että kanava on tyhjä. Ajatus on siis, että solmu kuuntelee kanavaa ennen kuin lähettää ja lähettää vain, jos kanava on tyhjä. Jos kanava on tyhjä, niin voi lähettää samantien. Jos kanava on varattuna, niin solmun ei voi lähettää vaan sen pitää odottaa. Odotuksen kesto riippuu CSMAn toteutusvaihtoehdosta. Aika tavallista on odottaa satunnainen aika ja sitten tarkistaa uudelleen, onko kanava vapaa. Odottaminen voi myös olla aktiivista, jolloin solmu aktiivisesti kuuntelee kanavan vapautumista ja lähettää heti, kun kanava on vapaa.</p><p>Etukäteen tapahtuvalla kanavan kuuntelulla ei kuitenkaan voi havaita kaikkia muiden lähetyksiä ainakaan riittävän nopeasti, joten yhteentörmäykset ovat edelleen mahdollisia. Esimerkiksi kaapelissa etenemisviiveen takia kaksi lähettäjää voivat molemmat havaita kanavan tyhjäksi ja aloittaa lähetyksen samaanaikaan. Langattomassa lähiverkossa lähettäjän ympäristön kuuntelu ei kerro, onko vastaanottaja saamassa sanomia muilta, joita lähettäjä ei voi etäisyyden takia kuulla. Vastaavasti satelliittikanavan kuuntelu ei paljasta, onko jonkin muu maa-asema jo aloittanut lähetyksen. Huomaathan, että satelliittien kautta tapahtuvassa viestinnässä etenemisviiveet voivat olla merkittäviä.</p><p>Mikäli yhteentörmäys tapahtuu, niin molempien (tai kaikkien törmänneiden) pakettien lähetykset epäonnistuvat ja ne joudutaan lähettämään uudelleen. Tällöin paketin lähettämiseen käytetty aika menee hukkaan. Solmujen väliset etäisyydet ja etenemisviiveet vaikuttavat yhteentörmäysten todennäköisyyteen, koska jos solmu ei voi havaita toisen solmun jo aloittamaa lähetystä, niin se voi aloittaa oman lähetyksensä samaan aikaan tuon toisen solmun kanssa.</p><p>CSMA:sta on useita erilaisia versioita törmäysten hallintaan. Esimerkiksi CSMA/CA (engl. Collision Avoidance, CA) pyrkii ensisijaisesti välttämään törmäyksiä. Sitä käytetään mm. WLANien käyttämässä standardissa <a href=\"https://fi.wikipedia.org/wiki/IEEE_802.11\" target=\"_blank\" rel=\"noopener noreferrer\">IEEE 802.11</a>. Langattomassa viestinnässä solmun on teknisesti vaikea samaan aikaan sekä lähettää että kuunnella mahdollista yhteentörmäystä. Sen takia pyritäänkin ensisijaisesti välttämään törmäyksiä. Tämä voidaan tehdä esim. lähettämällä varaussignaali ennen varsinaista kehystä tai kuten IEEE 802.11:ssä odottamalla satunnainen aika vapaata kanavaa seuraten ennen varsinaista lähetystä. Näin, jos kaksi solmua haluaa lähettää samaan aikaan, on todennäköistä, että toinen niistä aloittaa ensin ja toinen havaitsee lähetyksen eikä yritä lähettää päälle, vaan joutuu odottamaan pidempään.</p><p>Ethernetissä käytetään <a href=\"https://fi.wikipedia.org/wiki/CSMA/CD\" target=\"_blank\" rel=\"noopener noreferrer\">CSMA/CD:tä</a> (engl. Collision Detection). Siinä solmu voi aloittaa lähettämisen heti, kun se havaitsee kanavan olevan vapaana, mutta sen täytyy samanaikaisesti kuunnella kanavaa, jotta se voi havaita yhteentörmäyksen. Koska liikennöinti tapahtuu kaapelissa, niin voimme olla varmoja, että solmu voi havaita yhteentörmäyksen. Havaitseminen voidaan tehdä esimerkiksi signaalin voimakkuuden muutoksesta.</p><p>CSMA/CD:ssä solmun pitää keskeyttää kehyksen lähettäminen heti (minimipituuden jälkeen), jos se havaitsee törmäyksen. Tällä nopealla keskeytyksellä pienennetään törmäyksen aiheuttamaa hukka-aikaa ja lyhennetään kanavan varauksen kestoa. Näin yhteentörmäyksestä toivutaan hiukan nopeammin, kuin jos solmut lähettäisivät kehykset kokonaan. Tämä on CSMA/CD:n keskeinen ero perus-CSMA:han, jossa solmu saa lähettää koko kehyksen, vaikka se olisi havainnut törmäyksen.</p><p>Jos kehyksen lähetys epäonnistui törmäyksen vuoksi, niin solmu odottaa satunnaisen ajan ja yrittää lähettämistä sen jälkeen uudelleen. Tällöinkin se voi lähettää vasta, kun kanava on vapaa.</p><p>Iso kysymys erityisesti CSMA/CD:ssä on, että kuinka paljon pitää vähintään lähettää ja toisaalta, kuinka kauan on kuunneltava oman lähetyksen aloituksen jälkeen. Ajatellaan, että A:n ja B:n etäisyys on kyseisessä kaapelissa mahdollisimman suuri eli ne ovat kaapelin eri päissä. Vaikka A on jo aloittanut lähettämisen, niin B kuulee vielä hetken aikaa tyhjän kanavan ja voi aloittaa oman lähetyksensä. Tämä aika on etenemisviive A:lta B:lle. Jotta A voi havaita törmäyksen, niin sen pitää kuulla B:n lähetys, johon menee vielä toinen etenemisviive. Näin ollen pisin aika, jonka kuluessa mikä tahansa solmu voi havaita törmäyksen on 2 * etenemisviive solmujen välillä.  Varmistaakseen yhteentörmäyksen havaitsemisen solmu ei saa lopettaa omaa lähetystään ennen kuin törmäyssignaali on varmasti ehtinyt tulla. Näin ollen pienin sallittu lähetettävän kehyksen koko on se, jonka lähettäminen kestää vähintään 2 kertaa kaukaisimpien laitteiden välisen maksimietenemisviiveen verran. Näin ethernet-kehyksen minimikoko rajoittaa yhden linkkivälin ethernet-kaapelin pituutta.</p><p>Solmun, tai oikeammin sen verkkosovittimen (verkkokortti ja sen laiteohjain), toimenpiteet kehyksen lähetyksessä, kun noudatetaan CSMA/CD:tä:</p><ol>\n<li>Verkkosovitin saa kehyksen välitettäväksi.</li>\n<li>Jos verkkosovitin havaitsee, että kanava on tyhjä, niin se aloittaa kehyksen lähetyksen samantien. Jos se havaitsee, että kanava on käytössä, niin se odottaa, kunnes kanava on tyhjä ja aloittaa sitten kehyksen lähetyksen.</li>\n<li>Kun kehyksen lähetys on käynnissä, verkkosovitin kuuntelee kanavaa ja pyrkii havaitsemaan jonkun muun lähettämän signaalin.</li>\n<li>Jos verkkosovitin havaitsee signaalin, niin se lopettaa kehyksen lähettämisen (vaaditun minimikoon jälkeen).</li>\n<li>Jos kehyksen lähetys päättyy, eikä muiden signaaleja ole kuultu, niin kehyksen lähetys on onnistunut. </li>\n<li>Jos kehyksen lähetys päättyi keskeytykseen, niin verkkosovitin odottaa satunnaisen ajan ja jatkaa kohdasta 2.</li>\n</ol><p>Tuo verkkosovittimien satunnainen odotusaika kasvaa jokaisen peräkkäisen yhteentörmäyksen yhteydessä. Tästä käytetään englanninkielistä termiä binary exponential backoff. Odotusaika valitaan satunnaisesti kokonaislukujen joukosta {0,1,2,... (2^n)-1}, missä n on peräkkäisten yhteentörmäysten määrä.</p><p>Huomaathan, että verkkosovittimien toiminta on täysin riippumatonta aiempien viestien onnistumisesta ja muiden verkkosovittimien toiminnasta. Tällöin on täysin mahdollista, että verkkosovitin, joka juuri sai kehyksen välitettäväksi, saa kehyksensä välitettyä sillä aikaa, kun muut yhteentörmäysten jälkeen odottavat seuraavaa lähetysyritystä.</p><div><quiz id=\"655b26e6-ddfc-5380-84e0-a55a9fd4d090\"> </quiz></div></div>","frontmatter":{"path":"/osa-5/3-vuorojen-jakelu","title":"Lähetysvuorojen jakelu"},"fileAbsolutePath":"/home/runner/work/tietoliikenteen-perusteet-2-21/tietoliikenteen-perusteet-2-21/data/osa-5/3-vuorojen-jakelu.md"},"allPages":{"edges":[{"node":{"id":"07fbca84-2996-5ef5-91f4-80c8d67b1f6d","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"f94770ac-b87c-5b6d-aea7-87e3206ebc1a","frontmatter":{"path":"/","title":"Tietoa kurssista"}}},{"node":{"id":"72f0d3aa-a615-5485-927a-1d9efa922a6d","frontmatter":{"path":"/kurssin-suorittaminen","title":"Kurssin suorittaminen"}}},{"node":{"id":"5dc284ce-33b0-5641-92d3-f3cbd298ae3e","frontmatter":{"path":"/opettajille","title":"Opettajille ja opinto-ohjaajille"}}},{"node":{"id":"71ffb689-39cd-54e4-afb1-10639d37b540","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"92902113-bd4d-54cb-8e4c-2d914a94a43b","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"73d38dec-d739-5d94-b391-abef8e5373b6","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"18912f50-4c07-571f-9704-91752a0bc432","frontmatter":{"path":"/osa-1/1-johdanto","title":"Johdanto"}}},{"node":{"id":"451f39f3-eecd-5fe0-a231-f701dbb224ea","frontmatter":{"path":"/osa-1/2-kertausta","title":"Kertausta"}}},{"node":{"id":"0148ecbb-fcfc-575a-ad8c-63788d56b585","frontmatter":{"path":"/osa-1/3-viipeet-ja-läpäisy","title":"Viipeet ja läpäisy"}}},{"node":{"id":"dbfac743-cc99-5393-83ad-23546879a4ff","frontmatter":{"path":"/osa-1/4-piirikytkentä","title":"Pakettikytkentä vs piirikytkentä"}}},{"node":{"id":"caab8edd-cf17-5b21-bfcd-4f30373615af","frontmatter":{"path":"/osa-1/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"2edd2121-da28-5faa-a44c-8f2d579fdc83","frontmatter":{"path":"/osa-1","title":"Osa 1: Yleistä"}}},{"node":{"id":"6a6f50c9-6751-5805-b191-0dc5ea90c487","frontmatter":{"path":"/osa-2/1-periaatteita","title":"Verkkosovelluksen toimintaperiaatteita"}}},{"node":{"id":"ccab9cf4-3881-552b-a03c-8cc97041dc82","frontmatter":{"path":"/osa-2/2-laki-ja-kuuntelu","title":"Verkon kuuntelu ja lainsäädäntö"}}},{"node":{"id":"4d9b998c-1b33-541d-a142-0f0cad57da54","frontmatter":{"path":"/osa-2/3-nimipalvelu","title":"Nimipalvelu"}}},{"node":{"id":"54075fab-cf7e-59f3-aad5-1a2fbfbc549a","frontmatter":{"path":"/osa-2/5-verkko-ohjelmointi-rajapinta","title":"Verkko-ohjelmointi ja sovelluksen rajapinta"}}},{"node":{"id":"6309357c-886a-5e4d-88c1-399099c965ab","frontmatter":{"path":"/osa-2/4-sahkoposti","title":"Sähköposti"}}},{"node":{"id":"c18adde4-4460-569a-819b-fc93ea16b497","frontmatter":{"path":"/osa-2/6-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"38f09292-8ebb-55a2-aeb0-9efba1ccc739","frontmatter":{"path":"/osa-2","title":"Osa 2: Sovelluskerros"}}},{"node":{"id":"13a24d8f-bc56-5d8a-8aa4-1e6f602af95e","frontmatter":{"path":"/osa-3/1-kuljetuspalvelu","title":"Kuljetuspalvelun toiminta"}}},{"node":{"id":"ef3093c1-baa2-56e7-a495-6cf6fcafdda7","frontmatter":{"path":"/osa-3/2-periaatteet","title":"Luotettavan kuljetuspalvelun periaatteet"}}},{"node":{"id":"b955b25c-822f-56a2-a571-d0ed4227e4ef","frontmatter":{"path":"/osa-3/4-suunnitteluperiaatteita","title":"Suunnitteluperiaatteita"}}},{"node":{"id":"4da3b549-a94d-5a7a-91dd-71b2d6a1e4d1","frontmatter":{"path":"/osa-3/3-liukuvaikkuna","title":"Liukuva ikkuna"}}},{"node":{"id":"a9f3b554-3a38-5f0f-99a9-8375816fd4cb","frontmatter":{"path":"/osa-3/6-udp","title":"UDP"}}},{"node":{"id":"0be5b703-d205-501e-b174-e8d33e95c832","frontmatter":{"path":"/osa-3/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"7b424c06-2601-5402-bc43-c2959d121643","frontmatter":{"path":"/osa-3","title":"Osa 3: Kuljetuskerros"}}},{"node":{"id":"b20703a9-2d0a-5467-a824-c86ac6579e1d","frontmatter":{"path":"/osa-4/1-IPv4-IPv6","title":"IPv4 ja IPv6 osoitteet"}}},{"node":{"id":"724b3cc2-dd79-5872-a0e6-706fece0415a","frontmatter":{"path":"/osa-3/5-tcp","title":"TCP"}}},{"node":{"id":"80365dff-896c-5368-896e-eec79b5129b0","frontmatter":{"path":"/osa-4/2-IP-protokolla","title":"IP-protokolla"}}},{"node":{"id":"55d42f0f-65fe-5038-8b60-67f6fc4bff83","frontmatter":{"path":"/osa-4/3-reititys","title":"Reititys"}}},{"node":{"id":"77442160-5292-5d91-b03f-c12f326017ca","frontmatter":{"path":"/osa-4/5-muita-verkkokerroksen-protokollia.md","title":"Muita verkkokerroksen protokollia"}}},{"node":{"id":"0c4f9075-9058-5109-8b3e-33cf37e05e05","frontmatter":{"path":"/osa-4/4-reititin","title":"Reititin"}}},{"node":{"id":"bb679c1b-fa88-5f1a-bcb5-5c7e4e0fb566","frontmatter":{"path":"/osa-4/6-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"a251821d-10ca-5d3c-8e2e-486145b750bb","frontmatter":{"path":"/osa-4","title":"Osa 4: Verkkokerros"}}},{"node":{"id":"5e45a11a-8de3-5284-a686-5fbd5828cc39","frontmatter":{"path":"/osa-5/1-linkki-toiminta","title":"Yleistä linkkikerroksen toiminnasta"}}},{"node":{"id":"4006d9b8-5c45-5f82-84c4-ec932ff6cca4","frontmatter":{"path":"/osa-5/2-virheidenhavaitseminen","title":"Virheiden havaitseminen ja korjaaminen"}}},{"node":{"id":"ccba763f-0ffa-5398-a9c2-6f9e23b97270","frontmatter":{"path":"/osa-5/4-kytkin","title":"Kytkin"}}},{"node":{"id":"116b10b0-2f44-5011-a169-593eecfe6d50","frontmatter":{"path":"/osa-5/5-toiseen-verkkoon","title":"Lähettäminen toiseen verkkoon"}}},{"node":{"id":"54ca89a6-0d64-515e-8101-498fdcee037f","frontmatter":{"path":"/osa-5/3-vuorojen-jakelu","title":"Lähetysvuorojen jakelu"}}},{"node":{"id":"ba6c210e-c87f-5f21-95af-f5e66c293f36","frontmatter":{"path":"/osa-5/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"830def90-4428-575f-99a5-c9231b692dcd","frontmatter":{"path":"/osa-5","title":"Osa 5: Linkkikerros"}}},{"node":{"id":"a7407bc4-70d0-5174-9953-3860b86f2863","frontmatter":{"path":"/osa-6/1-kaikki-yhteen","title":"Kaikki yhteen"}}},{"node":{"id":"8e65b949-f5a9-5dd4-926d-2a678606218d","frontmatter":{"path":"/osa-6/2-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"f9c4a320-75ad-58cf-a44a-6f76b761e08f","frontmatter":{"path":"/osa-5/6-langaton","title":"Langaton verkko"}}},{"node":{"id":"5daae54a-eb34-5ed0-b5a7-93b1d4ba1a68","frontmatter":{"path":"/osa-6","title":"Osa 6: Kaikki yhteen"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}